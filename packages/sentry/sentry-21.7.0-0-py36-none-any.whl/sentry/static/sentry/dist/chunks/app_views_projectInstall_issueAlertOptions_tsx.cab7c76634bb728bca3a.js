(self.webpackChunk=self.webpackChunk||[]).push([["app_views_projectInstall_issueAlertOptions_tsx"],{"./app/views/projectInstall/issueAlertOptions.tsx":function(e,t,n){"use strict";n.d(t,{r:function(){return U}}),n("../node_modules/core-js/modules/es.reflect.construct.js"),n("../node_modules/core-js/modules/es.object.keys.js"),n("../node_modules/core-js/modules/es.symbol.js"),n("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),n("../node_modules/core-js/modules/web.dom-collections.for-each.js"),n("../node_modules/core-js/modules/es.object.get-own-property-descriptors.js");var s,r,o,i=n("../node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),a=n("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),l=n("../node_modules/@babel/runtime/helpers/esm/createClass.js"),c=n("../node_modules/@babel/runtime/helpers/esm/get.js"),u=n("../node_modules/@babel/runtime/helpers/esm/inherits.js"),d=n("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),p=n("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),m=n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),h=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),f=(n("../node_modules/core-js/modules/es.array.map.js"),n("../node_modules/core-js/modules/es.object.to-string.js"),n("../node_modules/core-js/modules/es.regexp.to-string.js"),n("../node_modules/core-js/modules/es.array.filter.js"),n("../node_modules/core-js/modules/es.array.includes.js"),n("../node_modules/core-js/modules/es.string.includes.js"),n("../node_modules/core-js/modules/es.object.values.js"),n("../node_modules/react/index.js")),v=n("../node_modules/@sentry/minimal/esm/index.js"),g=n("../node_modules/lodash/isEqual.js"),E=n.n(g),y=n("./app/components/asyncComponent.tsx"),S=n("./app/components/forms/selectControl.tsx"),j=n("./app/components/pageHeading.tsx"),R=n("./app/locale.tsx"),_=n("./app/styles/space.tsx"),b=n("./app/utils/withOrganization.tsx"),A=n("./app/views/settings/components/forms/controls/input.tsx"),O=n("./app/views/settings/components/forms/controls/radioGroup.tsx"),Z=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(Object(n),!0).forEach((function(t){(0,m.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(e){e[e.ERRORS=0]="ERRORS",e[e.USERS=1]="USERS"}(r||(r={})),function(e){e[e.ALERT_ON_EVERY_ISSUE=0]="ALERT_ON_EVERY_ISSUE",e[e.CUSTOMIZED_ALERTS=1]="CUSTOMIZED_ALERTS",e[e.CREATE_ALERT_LATER=2]="CREATE_ALERT_LATER"}(o||(o={}));var T="sentry.rules.conditions.event_frequency.EventUniqueUserFrequencyCondition",x="sentry.rules.conditions.event_frequency.EventFrequencyCondition",U="sentry.rules.conditions.event_frequency.EventFrequencyPercentCondition",P=(s={},(0,m.Z)(s,r.ERRORS,x),(0,m.Z)(s,r.USERS,T),s);function k(e,t,n){var s;switch(t){case r.ERRORS:s=x;break;case r.USERS:s=T;break;default:throw new RangeError("Supplied metric value is not handled")}return{interval:e,id:s,value:n}}var L=function(e){(0,u.Z)(m,e);var t,n,s=(t=m,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,s=(0,p.Z)(t);if(n){var r=(0,p.Z)(this).constructor;e=Reflect.construct(s,arguments,r)}else e=s.apply(this,arguments);return(0,d.Z)(this,e)});function m(){return(0,a.Z)(this,m),s.apply(this,arguments)}return(0,l.Z)(m,[{key:"getDefaultState",value:function(){return w(w({},(0,c.Z)((0,p.Z)(m.prototype),"getDefaultState",this).call(this)),{},{conditions:[],intervalChoices:[],alertSetting:o.CREATE_ALERT_LATER.toString(),metric:r.ERRORS,interval:"",threshold:""})}},{key:"getAvailableMetricChoices",value:function(){var e=this;return[[r.ERRORS,(0,R.t)("occurrences of")],[r.USERS,(0,R.t)("users affected by")]].filter((function(t){var n,s,r=(0,i.Z)(t,1)[0];return null===(n=e.state.conditions)||void 0===n||null===(s=n.some)||void 0===s?void 0:s.call(n,(function(e){return(null==e?void 0:e.id)===P[r]}))}))}},{key:"getIssueAlertsChoices",value:function(e){var t=this,n=[[o.CREATE_ALERT_LATER.toString(),(0,R.t)("I'll create my own alerts later")],[o.ALERT_ON_EVERY_ISSUE.toString(),(0,R.t)("Alert me on every new issue")]];return e&&n.push([o.CUSTOMIZED_ALERTS.toString(),(0,Z.BX)(I,{onClick:function(e){e.preventDefault();var n=o.CUSTOMIZED_ALERTS.toString();t.setStateAndUpdateParents({alertSetting:n})},children:[(0,R.t)("When there are more than"),(0,Z.tZ)(q,{type:"number",min:"0",name:"",placeholder:"10",value:this.state.threshold,onChange:function(e){return t.setStateAndUpdateParents({threshold:e.target.value})},"data-test-id":"range-input"}),(0,Z.tZ)(D,{value:this.state.metric,choices:this.getAvailableMetricChoices(),onChange:function(e){return t.setStateAndUpdateParents({metric:e.value})},"data-test-id":"metric-select-control"}),(0,R.t)("a unique error in"),(0,Z.tZ)(D,{value:this.state.interval,choices:this.state.intervalChoices,onChange:function(e){return t.setStateAndUpdateParents({interval:e.value})},"data-test-id":"interval-select-control"})]},o.CUSTOMIZED_ALERTS)]),n.map((function(e){var t=(0,i.Z)(e,2),n=t[0],s=t[1];return[n,(0,Z.tZ)(F,{children:s},n)]}))}},{key:"getUpdatedData",value:function(){var e,t;switch(parseInt(this.state.alertSetting,10)){case o.ALERT_ON_EVERY_ISSUE:e=!0,t=!1;break;case o.CREATE_ALERT_LATER:e=!1,t=!1;break;case o.CUSTOMIZED_ALERTS:e=!1,t=!0;break;default:throw new RangeError("Supplied alert creation action is not handled")}return{defaultRules:e,shouldCreateCustomRule:t,name:"Send a notification for new issues",conditions:this.state.interval.length>0&&this.state.threshold.length>0?[k(this.state.interval,this.state.metric,this.state.threshold)]:void 0,actions:[{id:"sentry.rules.actions.notify_event.NotifyEventAction"}],actionMatch:"all",frequency:5}}},{key:"setStateAndUpdateParents",value:function(e,t){var n=this;this.setState(e,(function(){null==t||t(),n.props.onChange(n.getUpdatedData())}))}},{key:"getEndpoints",value:function(){return[["conditions","/projects/".concat(this.props.organization.slug,"/rule-conditions/")]]}},{key:"onLoadAllEndpointsSuccess",value:function(){var e,t,n=this,s=null===(e=this.state.conditions)||void 0===e||null===(t=e.filter)||void 0===t?void 0:t.call(e,(function(e){return Object.values(P).includes(null==e?void 0:e.id)}));if(s&&0!==s.length){var r=function(e){var t,n=e.map((function(e){var t,n;return null===(t=e.formFields)||void 0===t||null===(n=t.interval)||void 0===n?void 0:n.choices})).reduce((function(e,t){return e&&t&&E()(e,t)?e:null}));return{intervalChoices:n,interval:null==n||null===(t=n[0])||void 0===t?void 0:t[0]}}(s),o=r.intervalChoices,i=r.interval;if(!o||!i)return v.$e((function(e){e.setExtra("props",n.props),e.setExtra("state",n.state),v.Tb(new Error("Interval choices or sent from API endpoint is inconsistent or empty"))})),void this.setStateAndUpdateParents({conditions:void 0});this.setStateAndUpdateParents({conditions:s,intervalChoices:o,interval:i})}else this.setStateAndUpdateParents({conditions:void 0})}},{key:"renderBody",value:function(){var e,t=this,n=this.getIssueAlertsChoices((null===(e=this.state.conditions)||void 0===e?void 0:e.length)>0);return(0,Z.BX)(f.Fragment,{children:[(0,Z.tZ)(B,{withMargins:!0,children:(0,R.t)("Set your default alert settings")}),(0,Z.tZ)(M,{choices:n,label:(0,R.t)("Options for creating an alert"),onChange:function(e){return t.setStateAndUpdateParents({alertSetting:e})},value:this.state.alertSetting})]})}}]),m}(y.Z);t.Z=(0,b.Z)(L);var I=(0,h.Z)("div",{target:"e12p23qf5"})("display:grid;grid-template-columns:repeat(5, max-content);grid-gap:",(0,_.Z)(1),";align-items:center;"),q=(0,h.Z)(A.Z,{target:"e12p23qf4"})({name:"m0jwvv",styles:"width:80px"}),D=(0,h.Z)(S.Z,{target:"e12p23qf3"})({name:"efbx4f",styles:"width:160px"}),M=(0,h.Z)(O.Z,{target:"e12p23qf2"})("padding:",(0,_.Z)(3)," 0;margin-bottom:50px;box-shadow:0 -1px 0 rgba(0, 0, 0, 0.1);"),B=(0,h.Z)(j.Z,{target:"e12p23qf1"})({name:"1ojfw6c",styles:"margin-top:65px"}),F=(0,h.Z)("div",{target:"e12p23qf0"})({name:"p9mutn",styles:"min-height:35px;display:flex;flex-direction:column;justify-content:center"})}}]);
//# sourceMappingURL=../sourcemaps/app_views_projectInstall_issueAlertOptions_tsx.f58b9563215040ff2fca13f54256eb32.js.map
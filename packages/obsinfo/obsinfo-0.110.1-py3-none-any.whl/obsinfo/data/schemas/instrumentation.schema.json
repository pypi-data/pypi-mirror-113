{
	"$schema": "http://json-schema.org/draft-04/schema#",
	"title": "Instrumentation",
	"description": "OBS operator instruments and their components",
	"type": "object",
	"required": ["format_version", "revision", "instrumentation"],
	"properties": {
	    "format_version" : {"$ref" : "#/format_version"},
	    "revision" :       {"$ref" : "definitions.schema.json#/revision"},
        "yaml_anchors" :   {"$ref" : "definitions.schema.json#/yaml_anchors"},
        "notes" :                {"$ref": "definitions.schema.json#/note_list"},
		"instrumentation": {"$ref" : "#/definitions/instrumentation" }
	},
    "additionalProperties" : false,
    "format_version" : {
        "anyOf": [
            {"$ref" : "definitions.schema.json#/format_version"},
            {"type": "string","pattern": "^0\\.108$","comment":"version of last change to this schema"}
        ]
    },
	"definitions": {
        "instrumentation" : {
            "description" : "Generic instrument description",
            "type": "object",
            "required": [
                "equipment",
                "channels"
            ],
            "properties": {
		        "operator":       {"$ref" : "#/definitions/operator" },
                "equipment":      {"$ref": "definitions.schema.json#/equipmentType"},
                "channels":       {"$ref": "#/definitions/channels"}
            },
            "additionalProperties" : false
        },
        "operator": { 
            "type": "object",
            "description": "OBS operator/operator information",
            "required": [
                "reference_name",
                "full_name", 
                "email"
            ],
            "properties": {
                "reference_name": { "$ref" : "definitions.schema.json#/reference_name"},
                "full_name":      { "type": "string"},
                "contact_name":   { "$ref" : "definitions.schema.json#/contact_name"},
                "email":          { "$ref" : "definitions.schema.json#/email"},
                "website":        { "$ref" : "definitions.schema.json#/website" },
                "phone_number":   { "$ref": "definitions.schema.json#/phone" }
            },
            "additionalProperties" : false
        },
        "channels": { 
            "anyOf": [
                {  "type": "object",
                   "description": "default channel properties",
                   "patternProperties": {
                     "default": { "$ref": "#/definitions/channel_default"}
                }
             }, 
                {  "type": "object",
                   "description": "individual measurements specified by das channel",
                   "patternProperties": {
                     "^[A-Za-z0-9\\*]+$": { "$ref": "#/definitions/channel"}
                }
             }
          ]
        },
        "channel_default": {
            "type": "object",
            "description": "Description of one DAS channel (overwrites corresponding channel default for that channel)",
            "properties" : {
                "orientation_code" :   {"$ref": "#/definitions/orientation_code"},
                "datalogger" :         {"$ref": "datalogger.schema.json#/definitions/datalogger"},
                "preamplifier":        {"$ref": "preamplifier.schema.json#/definitions/preamplifier"},
                "sensor" :             {"$ref": "sensor.schema.json#/definitions/sensor"},
        	    "datalogger_configuration" :  { 
        		    "type": "string",
            	    "description": "configuration selector for datalogger, preamplifier or sensor"
        	    },
                "preamplifier_configuration":      {
        		    "type": "string",
            	    "description": "configuration selector for datalogger, preamplifier or sensor"
        	    },
                "sensor_configuration" :           {
        		    "type": "string",
            	    "description": "configuration selector for datalogger, preamplifier or sensor"
                },
                "location_code":      {"type": "string"},
	            "comments" :          {"$ref" : "definitions.schema.json#/note_list"},
	 	        "extras":             {"$ref" : "definitions.schema.json#/extras"}
            },
            "additionalProperties": false
        },
        "channel": {
            "type": "object",
            "description": "Description of one DAS channel (overwrites corresponding channel default for that channel)",
            "required": ["orientation_code"],
            "properties" : {
                "orientation_code" :   {"$ref": "#/definitions/orientation_code"},
                "datalogger" :         {"$ref": "datalogger.schema.json#/definitions/datalogger"},
                "preamplifier":        {"$ref": "preamplifier.schema.json#/definitions/preamplifier"},
                "sensor" :             {"$ref": "sensor.schema.json#/definitions/sensor"},
        	    "datalogger_configuration" :  { 
        		    "type": "string",
            	    "description": "configuration selector for datalogger, preamplifier or sensor"
        	    },
                "preamplifier_configuration":      {
        		    "type": "string",
            	    "description": "configuration selector for datalogger, preamplifier or sensor"
        	    },
                "sensor_configuration" :           {
        		    "type": "string",
            	    "description": "configuration selector for datalogger, preamplifier or sensor"
                },
                "location_code":      {"type": "string"},
	            "comments" :          {"$ref" : "definitions.schema.json#/note_list"},
	 	        "extras":             {"$ref" : "definitions.schema.json#/extras"}
            },
            "additionalProperties": false
        },  
        "orientation_code" : { 
	        "anyOf": [
	            {"type": "string", "pattern": "[N, E, Z]", "comment":"orientation codes without azimuth or dip"},
	            { 
	              "type" : "object",
	              "patternProperties": {
                      "^[1, 2, 3, H]$": { "$ref": "definitions.schema.json#/orientation_coordinates"}
                   }
                } 
	        ]                     
        }
	}
}

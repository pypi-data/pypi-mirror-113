{"version":3,"sources":["webpack:///./app/actionCreators/release.tsx","webpack:///./app/actions/releaseActions.tsx","webpack:///./app/actions/repositoryActions.tsx","webpack:///./app/components/lastCommit.tsx","webpack:///./app/components/repoLabel.tsx","webpack:///./app/utils/withRelease.tsx","webpack:///./app/components/versionHoverCard.tsx","webpack:///./app/stores/releaseStore.tsx","webpack:///./app/stores/repositoryStore.tsx","webpack:///./app/utils/withRepositories.tsx","webpack:///./app/actionCreators/repositories.tsx"],"names":["getProjectRelease","api","params","orgSlug","projectSlug","releaseVersion","path","encodeURIComponent","ReleaseStore","getReleaseStoreKey","ReleaseActions","requestPromise","method","then","res","catch","err","status","Sentry","scope","setLevel","setFingerprint","getReleaseDeploys","archiveRelease","addLoadingMessage","t","data","ReleaseStatus","projects","version","release","addSuccessMessage","error","addErrorMessage","responseJSON","detail","restoreRelease","Reflux","unknownUser","id","name","username","email","avatarUrl","avatar","avatarUuid","avatarType","ip_address","LastCommit","message","firstLine","split","length","truncated","substr","words","pop","join","this","props","commit","headerClass","commitAuthor","author","className","user","renderMessage","date","dateCreated","Component","p","theme","white","overflowEllipsis","gray200","fontSizeSmall","VersionHoverCard","visible","setState","organization","slug","header","body","ConnectRepo","href","priority","deploys","undefined","defined","lastCommit","recentDeploysByEnvironment","reduce","dbe","deploy","dateFinished","environment","hasOwnProperty","mostRecentDeploySlice","Object","keys","slice","HeaderWrapper","VersionWrapper","StyledVersion","truncate","anchor","value","ClipboardIconWrapper","size","newGroups","style","textAlign","commitCount","authors","users","avatarSize","tooltipOptions","container","typeMembers","map","env","idx","position","VersionRepoLabel","StyledTimeSince","deploysLoading","deploysError","releaseLoading","releaseError","repositories","repositoriesLoading","repositoriesError","loading","hasRepos","mini","renderObj","getBody","getRepoLink","children","React","WrappedComponent","WithRelease","withApi","withRepositories","context","onStoreUpdate","releaseData","state","fetchRelease","fetchDeploys","unsubscribe","getDisplayName","space","RepoLabel","TimeSince","gray300","Version","ReleaseStoreConfig","Map","listenables","init","listenTo","OrganizationActions","updateOrganization","reset","trigger","org","loadRelease","releaseKey","loadReleaseError","loadReleaseSuccess","loadDeploys","loadDeploysError","loadDeploysSuccess","get","RepositoryStoreConfig","RepoActions","resetRepositories","loadRepositories","loadRepositoriesError","loadRepositoriesSuccess","INITIAL_STATE","WithRepositories","RepositoryStore","repoData","RepositoryActions","fetchRepositories","getRepositories"],"mappings":"mlBAmBO,SAASA,EAAkBC,EAAaC,GAC7C,IAAOC,EAAwCD,EAAxCC,QAASC,EAA+BF,EAA/BE,YAAaC,EAAkBH,EAAlBG,eACvBC,EAAO,aAAH,OAAgBH,EAAhB,YAA2BC,EAA3B,qBAAmDG,mBAC3DF,GADQ,KAWV,OAJAG,0BAAkCC,OAAmBL,EAAaC,KAChE,EACFK,gBAA2BP,EAASC,EAAaC,GAE1CJ,EACJU,eAAeL,EAAM,CACpBM,OAAQ,QAETC,MAAK,SAACC,GACLJ,uBAAkCN,EAAaC,EAAgBS,MAEhEC,OAAM,SAAAC,GAEc,MAAfA,EAAIC,QAKRP,qBAAgCN,EAAaC,EAAgBW,GAC7DE,MAAiB,SAAAC,GACfA,EAAMC,SAASF,aACfC,EAAME,eAAe,CAAC,8BACtBH,KAAwBF,OARxBN,uBAAkCN,EAAaC,EAAgB,SAahE,SAASiB,EAAkBrB,EAAaC,GAC7C,IAAOC,EAAwCD,EAAxCC,QAASC,EAA+BF,EAA/BE,YAAaC,EAAkBH,EAAlBG,eACvBC,EAAO,kBAAH,OAAqBH,EAArB,qBAAyCI,mBACjDF,GADQ,aASV,OAJAG,0BAAkCC,OAAmBL,EAAaC,KAChE,EACFK,gBAA2BP,EAASC,EAAaC,GAE1CJ,EACJU,eAAeL,EAAM,CACpBM,OAAQ,QAETC,MAAK,SAACC,GACLJ,uBAAkCN,EAAaC,EAAgBS,MAEhEC,OAAM,SAAAC,GAEc,MAAfA,EAAIC,QAKRP,qBAAgCN,EAAaC,EAAgBW,GAC7DE,MAAiB,SAAAC,GACfA,EAAMC,SAASF,aACfC,EAAME,eAAe,CAAC,qCACtBH,KAAwBF,OARxBN,uBAAkCN,EAAaC,EAAgB,SAahE,SAASkB,EAAetB,EAAaC,GAC1C,IAAOC,EAAwCD,EAAxCC,QAASC,EAA+BF,EAA/BE,YAAaC,EAAkBH,EAAlBG,eAK7B,OAHAK,gBAA2BP,EAASC,EAAaC,IACjDmB,SAAkBC,OAAE,uBAEbxB,EACJU,eADI,yBAC6BR,EAD7B,cACkD,CACrDS,OAAQ,OACRc,KAAM,CACJT,OAAQU,cACRC,SAAU,GACVC,QAASxB,KAGZQ,MAAK,SAACiB,GACLpB,uBAAkCN,EAAaC,EAAgByB,IAC/DC,SAAkBN,OAAE,0CAErBV,OAAM,SAAAiB,GAAS,QAKd,MAJAtB,qBAAgCN,EAAaC,EAAgB2B,IAC7DC,QAAe,oBACbD,EAAME,oBADO,aACb,EAAoBC,cADP,SACiBV,OAAE,sCAE5BO,KAIL,SAASI,EAAenC,EAAaC,GAC1C,IAAOC,EAAwCD,EAAxCC,QAASC,EAA+BF,EAA/BE,YAAaC,EAAkBH,EAAlBG,eAK7B,OAHAK,gBAA2BP,EAASC,EAAaC,IACjDmB,SAAkBC,OAAE,uBAEbxB,EACJU,eADI,yBAC6BR,EAD7B,cACkD,CACrDS,OAAQ,OACRc,KAAM,CACJT,OAAQU,YACRC,SAAU,GACVC,QAASxB,KAGZQ,MAAK,SAACiB,GACLpB,uBAAkCN,EAAaC,EAAgByB,IAC/DC,SAAkBN,OAAE,0CAErBV,OAAM,SAAAiB,GAAS,QAKd,MAJAtB,qBAAgCN,EAAaC,EAAgB2B,IAC7DC,QAAe,oBACbD,EAAME,oBADO,aACb,EAAoBC,cADP,SACiBV,OAAE,sCAE5BO,O,wHC3IZ,IAAeK,kBAAqB,CAClC,cACA,mBACA,qBACA,cACA,mBACA,wB,2HCNF,IAAeA,kBAAqB,CAClC,oBACA,mBACA,wBACA,6B,u3DCMF,IAAMC,EAA0B,CAC9BC,GAAI,GACJC,KAAM,GACNC,SAAU,KACVC,MAAO,GACPC,UAAW,GACXC,OAAQ,CACNC,WAAY,GACZC,WAAY,iBAEdC,WAAY,IAGRC,E,+iBACJ,SAAcC,GACZ,IAAKA,EACH,OAAOxB,OAAE,uBAGX,IAAMyB,EAAYD,EAAQE,MAAM,MAAM,GACtC,GAAID,EAAUE,OAAS,IAAK,CAC1B,IAAIC,EAAYH,EAAUI,OAAO,EAAG,IAC9BC,EAAQF,EAAUF,MAAM,KAM9B,OAJII,EAAMH,OAAS,IACjBG,EAAMC,MACNH,EAAYE,EAAME,KAAK,MAElBJ,EAAY,MAErB,OAAOH,I,oBAGT,WACE,MAA8BQ,KAAKC,MAA5BC,EAAP,EAAOA,OAAQC,EAAf,EAAeA,YACTC,EAAeF,GAAUA,EAAOG,OACtC,OACE,0BACE,cAAIC,UAAWH,EAAf,0BACA,eAAKG,UAAU,SAAf,WACE,eAAKA,UAAU,gBAAf,UACE,QAAC,IAAD,CAAYC,KAAMH,GAAgBxB,OAEpC,eAAK0B,UAAU,0BAAf,SACGN,KAAKQ,cAAcN,EAAOX,YAE7B,eAAKe,UAAU,cAAf,WACE,2BAAUF,GAAgBA,EAAatB,OAASf,OAAE,oBADpD,KAGE,QAAC,IAAD,CAAW0C,KAAMP,EAAOQ,2B,GApCXC,aAAnBrB,E,yBA4CN,Q,+HC7CA,GApBkB,OAAO,OAAP,qBAAH,0BAGJ,SAAAsB,GAAC,OAAIA,EAAEC,MAAMC,QAHT,8DASXC,IATW,8EAcC,SAAAH,GAAC,OAAIA,EAAEC,MAAMG,UAdd,0CAiBA,SAAAJ,GAAC,OAAIA,EAAEC,MAAMI,gBAjBb,K,60BC2Ff,I,inBCnDMC,E,wnBACW,CACbC,SAAS,I,gDAGX,WACEnB,KAAKoB,SAAS,CACZD,SAAS,M,yBAIb,WACE,IACM1E,EADiBuD,KAAKC,MAArBoB,aACsBC,KAC7B,MAAO,CACLC,OAAQ,KACRC,MACE,QAACC,EAAD,YACE,wBAAK1D,OAAE,4CACP,uBACGA,OACC,uGAGJ,QAAC,KAAD,CAAQ2D,KAAI,yBAAoBjF,EAApB,WAAsCkF,SAAS,UAA3D,UACG5D,OAAE,gC,qBAOb,WACE,MAA2CiC,KAAKC,MAAzCtD,EAAP,EAAOA,eAAgByB,EAAvB,EAAuBA,QAASwD,EAAhC,EAAgCA,QAChC,QAAgBC,IAAZzD,KAA0B0D,QAAQF,GACpC,MAAO,CAACL,OAAQ,KAAMC,KAAM,MAG9B,IAAOO,EAAc3D,EAAd2D,WACDC,EAA6BJ,EAAQK,QAAO,SAAUC,EAAKC,GAC/D,IAAOC,EAA6BD,EAA7BC,aAAcC,EAAeF,EAAfE,YAKrB,OAJKH,EAAII,eAAeD,KACtBH,EAAIG,GAAeD,GAGdF,IACN,IACCK,EAAwBC,OAAOC,KAAKT,GAMxC,OAJIQ,OAAOC,KAAKT,GAA4BtC,OAAS,IACnD6C,EAAwBC,OAAOC,KAAKT,GAA4BU,MAAM,EAAG,IAGpE,CACLnB,QACE,QAACoB,EAAD,YACG5E,OAAE,YACH,QAAC6E,EAAD,YACE,QAACC,EAAD,CAAe1E,QAASxB,EAAgBmG,UAAQ,EAACC,QAAQ,KAEzD,QAAC,IAAD,CAAWC,MAAOrG,EAAlB,UACE,QAACsG,EAAD,WACE,QAAC,KAAD,CAAUC,KAAK,iBAMzB1B,MACE,0BACE,eAAKlB,UAAU,eAAf,WACE,eAAKA,UAAU,WAAf,WACE,wBAAKvC,OAAE,iBACP,eAAKuC,UAAU,cAAf,SAA8BlC,EAAQ+E,gBAExC,eAAK7C,UAAU,WAAf,WACE,cAAI8C,MAAO,CAACC,UAAW,SAAvB,UACGjF,EAAQkF,YAAa,IACG,IAAxBlF,EAAQkF,aAAoBvF,OAAE,aAAcA,OAAE,WAFjD,KAE8DA,OAAE,OAAQ,IACrEK,EAAQmF,QAAQ7D,OAAQ,IACG,IAA3BtB,EAAQmF,QAAQ7D,QAAe3B,OAAE,YAAaA,OAAE,UAAW,QAE9D,QAAC,IAAD,CACEyF,MAAOpF,EAAQmF,QACfE,WAAY,GACZC,eAAgB,CAACC,UAAW,QAC5BC,YAAY,kBAIjB7B,IAAc,QAAC,EAAD,CAAY7B,OAAQ6B,EAAY5B,YAAY,mBAC1DyB,EAAQlC,OAAS,IAChB,0BACE,eAAKY,UAAU,UAAf,UACE,cAAIA,UAAU,iBAAd,UAAgCvC,OAAE,eAEnCwE,EAAsBsB,KAAI,SAACC,EAAKC,GAC/B,IAAM3B,EAAeJ,EAA2B8B,GAChD,OACE,eAAKxD,UAAU,SAAf,UACE,eAAKA,UAAU,cAAc8C,MAAO,CAACY,SAAU,YAA/C,WACE,QAACC,EAAD,UAAmBH,IAClB1B,IAAgB,QAAC8B,EAAD,CAAiBzD,KAAM2B,QAHf2B,e,oBAe7C,WAAS,MACP,EASI/D,KAAKC,MARPkE,EADF,EACEA,eACAC,EAFF,EAEEA,aACAhG,EAHF,EAGEA,QACAiG,EAJF,EAIEA,eACAC,EALF,EAKEA,aACAC,EANF,EAMEA,aACAC,EAPF,EAOEA,oBACAC,EARF,EAQEA,kBAEElD,EAA0B,KAC1BC,EAAwB,KAEtBkD,KAAaP,GAAkBE,GAAkBG,GACjDlG,EAAK,UAAG8F,UAAgBE,SAAnB,QAAmCG,EACxCE,EAAWJ,GAAgBA,EAAa7E,OAAS,EAEvD,GAAIgF,EACFlD,GAAO,QAAC,IAAD,CAAkBoD,MAAI,SACxB,GAAItG,EACTkD,GAAO,QAAC,IAAD,QACF,CACL,IAAMqD,EACJF,GAAYvG,EAAU4B,KAAK8E,UAAY9E,KAAK+E,cAC9CxD,EAASsD,EAAUtD,OACnBC,EAAOqD,EAAUrD,KAGnB,OACE,QAAC,KAAD,OAAexB,KAAKC,OAApB,IAA2BsB,OAAQA,EAAQC,KAAMA,EAAjD,SACGxB,KAAKC,MAAM+E,gB,GAjJWC,aAAzB/D,E,+BAwJN,ID5K+CgE,EACvCC,EC2KR,GAAeC,QD5KgCF,GC4KZG,OAAiBnE,ID3K5CiE,EADiF,6B,IAAA,G,EAAA,E,gaAOrF,WAAYlF,EAAOqF,GAAS,sBAC1B,cAAMrF,EAAOqF,IADa,gCAiBdxI,YAAoB,kBAAM,EAAKyI,uBAAiB1D,IAd5D,MAAsC,EAAK5B,MAApCvD,EAAP,EAAOA,YAAaC,EAApB,EAAoBA,eACd6I,EAAc1I,QAAiBJ,EAAaC,GAJxB,OAK1B,EAAK8I,MAAL,KAAiBD,GALS,EAPyD,gDAerF,WACExF,KAAK0F,eACL1F,KAAK2F,iBAjB8E,kCAoBrF,WACE3F,KAAK4F,gBArB8E,0BA0BrF,WACE,MAAyD5F,KAAKC,MAAvD1D,EAAP,EAAOA,IAAK8E,EAAZ,EAAYA,aAAc3E,EAA1B,EAA0BA,YAAaC,EAAvC,EAAuCA,eACjC6I,EAAc1I,QAAiBJ,EAAaC,GAC5CF,EAAU4E,EAAaC,OAGzBkE,EAAYpH,UAAYoH,EAAYnB,gBACtCmB,EAAYlB,gBAEZhI,QAAkBC,EAAK,CAACE,UAASC,cAAaC,qBAnCmC,0BAuCrF,WACE,MAAyDqD,KAAKC,MAAvD1D,EAAP,EAAOA,IAAK8E,EAAZ,EAAYA,aAAc3E,EAA1B,EAA0BA,YAAaC,EAAvC,EAAuCA,eACjC6I,EAAc1I,QAAiBJ,EAAaC,GAC5CF,EAAU4E,EAAaC,OAGzBkE,EAAY5D,UAAY4D,EAAYrB,gBACtCqB,EAAYpB,gBAEZxG,QAAkBrB,EAAK,CAACE,UAASC,cAAaC,qBAhDmC,2BAoDrF,WACE,MAAsCqD,KAAKC,MAApCvD,EAAP,EAAOA,YAAaC,EAApB,EAAoBA,eACd6I,EAAc1I,QAAiBJ,EAAaC,GAElDqD,KAAKoB,SAAL,KAAkBoE,MAxDiE,oBA2DrF,WACE,OACE,QAACN,EAAD,OACOlF,KAAKC,OACLD,KAAKyF,YA/DqE,GAC7DR,cAD6D,kCACjFE,EADiF,qCAKjDU,OAAeX,GALkC,MAoEhFC,IC0GH1D,GAAc,OAAO,MAAP,qBAAH,YACJqE,OAAM,GADF,uBAKX7B,GAAmB,OAAO8B,EAAP,qBAAH,sCAIhB7B,GAAkB,OAAO8B,IAAP,qBAAH,UACV,SAAApF,GAAC,OAAIA,EAAEC,MAAMoF,UADH,yDAQftD,GAAgB,OAAO,MAAP,qBAAH,wFAKbC,GAAiB,OAAO,MAAP,qBAAH,0FAMdC,GAAgB,OAAOqD,IAAP,qBAAH,iBACDJ,OAAM,IADL,qBAIb7C,GAAuB,OAAO,OAAP,qBAAH,qD,84DC3LnB,IAAMlG,EAAqB,SAACL,EAAqBC,GAAtB,gBAC7BD,GAD6B,OACfC,IAEbwJ,EAAqE,CACzEV,MAAO,CACLhJ,aAASoF,EACTzD,QAAS,IAAIgI,IACb/B,eAAgB,IAAI+B,IACpB9B,aAAc,IAAI8B,IAClBxE,QAAS,IAAIwE,IACbjC,eAAgB,IAAIiC,IACpBhC,aAAc,IAAIgC,KAGpBC,YAAarJ,IAEbsJ,KAbyE,WAcvEtG,KAAKuG,SAASC,WAA4BxG,KAAKyG,oBAC/CzG,KAAK0G,SAGPA,MAlByE,WAmBvE1G,KAAKyF,MAAQ,CACXhJ,aAASoF,EACTzD,QAAS,IAAIgI,IACb/B,eAAgB,IAAI+B,IACpB9B,aAAc,IAAI8B,IAClBxE,QAAS,IAAIwE,IACbjC,eAAgB,IAAIiC,IACpBhC,aAAc,IAAIgC,KAEpBpG,KAAK2G,QAAQ3G,KAAKyF,QAGpBgB,mBA/ByE,SA+BtDG,GACjB5G,KAAK0G,QACL1G,KAAKyF,MAAMhJ,QAAUmK,EAAItF,KACzBtB,KAAK2G,QAAQ3G,KAAKyF,QAGpBoB,YArCyE,SAqC7DpK,EAAiBC,EAAqBC,GAE3CqD,KAAKvD,SAAWuD,KAAKvD,UAAYA,IACpCuD,KAAK0G,QACL1G,KAAKvD,QAAUA,GAGjB,IAAMqK,EAAa/J,EAAmBL,EAAaC,GACnD,EAAiDqD,KAAKyF,MAA/CpB,EAAP,EAAOA,eAAgBC,EAAvB,EAAuBA,aAAiBmB,GAAxC,YAEAzF,KAAKyF,MAAL,OACKA,GADL,IAEEpB,eAAgB,EAAF,KACTA,GADS,cAEXyC,GAAa,IAEhBxC,aAAc,EAAF,KACPA,GADO,cAETwC,OAAajF,MAGlB7B,KAAK2G,QAAQ3G,KAAKyF,QAGpBsB,iBA7DyE,SA6DxDrK,EAAqBC,EAAwB2B,GAC5D,IAAMwI,EAAa/J,EAAmBL,EAAaC,GACnD,EAAiDqD,KAAKyF,MAA/CpB,EAAP,EAAOA,eAAgBC,EAAvB,EAAuBA,aAAiBmB,GAAxC,YAEAzF,KAAKyF,MAAL,OACKA,GADL,IAEEpB,eAAgB,EAAF,KACTA,GADS,cAEXyC,GAAa,IAEhBxC,aAAc,EAAF,KACPA,GADO,cAETwC,EAAaxI,MAGlB0B,KAAK2G,QAAQ3G,KAAKyF,QAGpBuB,mBA/EyE,SA+EtDtK,EAAqBC,EAAwBqB,GAC9D,IAAM8I,EAAa/J,EAAmBL,EAAaC,GACnD,EAA0DqD,KAAKyF,MAAxDrH,EAAP,EAAOA,QAASiG,EAAhB,EAAgBA,eAAgBC,EAAhC,EAAgCA,aAAiBmB,GAAjD,YACAzF,KAAKyF,MAAL,OACKA,GADL,IAEErH,QAAS,EAAF,KACFA,GADE,cAEJ0I,EAAa9I,IAEhBqG,eAAgB,EAAF,KACTA,GADS,cAEXyC,GAAa,IAEhBxC,aAAc,EAAF,KACPA,GADO,cAETwC,OAAajF,MAGlB7B,KAAK2G,QAAQ3G,KAAKyF,QAGpBwB,YApGyE,SAoG7DxK,EAAiBC,EAAqBC,GAE3CqD,KAAKvD,SAAWuD,KAAKvD,UAAYA,IACpCuD,KAAK0G,QACL1G,KAAKvD,QAAUA,GAGjB,IAAMqK,EAAa/J,EAAmBL,EAAaC,GACnD,EAAiDqD,KAAKyF,MAA/CtB,EAAP,EAAOA,eAAgBC,EAAvB,EAAuBA,aAAiBqB,GAAxC,YAEAzF,KAAKyF,MAAL,OACKA,GADL,IAEEtB,eAAgB,EAAF,KACTA,GADS,cAEX2C,GAAa,IAEhB1C,aAAc,EAAF,KACPA,GADO,cAET0C,OAAajF,MAGlB7B,KAAK2G,QAAQ3G,KAAKyF,QAGpByB,iBA5HyE,SA4HxDxK,EAAqBC,EAAwB2B,GAC5D,IAAMwI,EAAa/J,EAAmBL,EAAaC,GACnD,EAAiDqD,KAAKyF,MAA/CtB,EAAP,EAAOA,eAAgBC,EAAvB,EAAuBA,aAAiBqB,GAAxC,YAEAzF,KAAKyF,MAAL,OACKA,GADL,IAEEtB,eAAgB,EAAF,KACTA,GADS,cAEX2C,GAAa,IAEhB1C,aAAc,EAAF,KACPA,GADO,cAET0C,EAAaxI,MAGlB0B,KAAK2G,QAAQ3G,KAAKyF,QAGpB0B,mBA9IyE,SA8ItDzK,EAAqBC,EAAwBqB,GAC9D,IAAM8I,EAAa/J,EAAmBL,EAAaC,GACnD,EAA0DqD,KAAKyF,MAAxD7D,EAAP,EAAOA,QAASuC,EAAhB,EAAgBA,eAAgBC,EAAhC,EAAgCA,aAAiBqB,GAAjD,YAEAzF,KAAKyF,MAAL,OACKA,GADL,IAEE7D,QAAS,EAAF,KACFA,GADE,cAEJkF,EAAa9I,IAEhBmG,eAAgB,EAAF,KACTA,GADS,cAEX2C,GAAa,IAEhB1C,aAAc,EAAF,KACPA,GADO,cAET0C,OAAajF,MAGlB7B,KAAK2G,QAAQ3G,KAAKyF,QAGpB2B,IApKyE,SAoKrE1K,EAAqBC,GACvB,IAAMmK,EAAa/J,EAAmBL,EAAaC,GAEnD,MAAO,CACLyB,QAAS4B,KAAKyF,MAAMrH,QAAQ0I,GAC5BzC,eAAgBrE,KAAKyF,MAAMpB,eAAeyC,GAC1CxC,aAActE,KAAKyF,MAAMnB,aAAawC,GACtClF,QAAS5B,KAAKyF,MAAM7D,QAAQkF,GAC5B3C,eAAgBnE,KAAKyF,MAAMtB,eAAe2C,GAC1C1C,aAAcpE,KAAKyF,MAAMrB,aAAa0C,MAOtChK,EAAe6B,gBAAmBwH,GAExC,O,4zDC3MO,IAAMkB,EAA2E,CACtFhB,YAAaiB,IACb7B,MAAO,CACLhJ,aAASoF,EACT0C,kBAAc1C,EACd2C,yBAAqB3C,EACrB4C,uBAAmB5C,GAGrByE,KATsF,WAUpFtG,KAAKuH,qBAGPA,kBAbsF,WAcpFvH,KAAKyF,MAAQ,CACXhJ,aAASoF,EACT0C,kBAAc1C,EACd2C,yBAAqB3C,EACrB4C,uBAAmB5C,GAErB7B,KAAK2G,QAAQ3G,KAAKyF,QAGpB+B,iBAvBsF,SAuBrE/K,GACfuD,KAAKyF,MAAQ,CACXhJ,UACA8H,aAAc9H,IAAYuD,KAAKyF,MAAMhJ,QAAUuD,KAAKyF,MAAMlB,kBAAe1C,EACzE2C,qBAAqB,EACrBC,uBAAmB5C,GAErB7B,KAAK2G,QAAQ3G,KAAKyF,QAGpBgC,sBAjCsF,SAiChEnK,GACpB0C,KAAKyF,MAAL,OACKzF,KAAKyF,OADV,IAEElB,kBAAc1C,EACd2C,qBAAqB,EACrBC,kBAAmBnH,IAErB0C,KAAK2G,QAAQ3G,KAAKyF,QAGpBiC,wBA3CsF,SA2C9D1J,GACtBgC,KAAKyF,MAAL,OACKzF,KAAKyF,OADV,IAEElB,aAAcvG,EACdwG,qBAAqB,EACrBC,uBAAmB5C,IAErB7B,KAAK2G,QAAQ3G,KAAKyF,QAGpB2B,IArDsF,WAsDpF,YAAWpH,KAAKyF,SAQpB,EAFwB9G,gBAAmB0I,G,2sBCjE3C,IAAMM,EAA+B,CACnCpD,kBAAc1C,EACd2C,yBAAqB3C,EACrB4C,uBAAmB5C,GAiErB,EA9DA,SACEqD,GACA,IACM0C,EADN,6B,IAAA,G,EAAA,E,gaAIE,WAAY3H,EAA2BqF,GAAc,sBACnD,cAAMrF,EAAOqF,IADsC,gCAyBvCuC,UAAuB,kBAAM,EAAKtC,uBAAiB1D,IAtB/D,IACMpF,EADiB,EAAKwD,MAArBoB,aACsBC,KACvBwG,EAAWD,QALkC,OAO/CC,EAASrL,UAAYA,GACvBsL,wBAGF,EAAKtC,MACHqC,EAASrL,UAAYA,EAArB,OACQkL,GAAkBG,GAD1B,KAEQH,GAdyC,EAJvD,gDAqBE,WAGE3H,KAAKgI,sBAxBT,kCA0BE,WACEhI,KAAK4F,gBA3BT,+BA+BE,WACE,MAA4B5F,KAAKC,MAA1B1D,EAAP,EAAOA,IACDE,EADN,EAAY4E,aACiBC,KACvBwG,EAAWD,UAMbC,EAASvD,eAAiBuD,EAAStD,qBACrCsD,EAASrD,oBC1DV,SAAyBlI,EAAaC,GAC3C,IAAOC,EAAWD,EAAXC,QACDG,EAAO,kBAAH,OAAqBH,EAArB,WAMVoL,6BAA4C,EAC5CE,qBAAmCtL,GAE5BF,EACJU,eAAeL,EAAM,CACpBM,OAAQ,QAETC,MAAK,SAACC,GACL2K,4BAA0C3K,MAE3CC,OAAM,SAAAC,GACLyK,0BAAwCzK,GACxCE,MAAiB,SAAAC,GACfA,EAAMC,SAASF,aACfC,EAAME,eAAe,CAAC,mCACtBH,KAAwBF,SDqCxB2K,CAAgB1L,EAAK,CAACE,cA3C5B,2BA+CE,WACE,IAAMqL,EAAWD,QACjB7H,KAAKoB,SAAL,KAAkB0G,MAjDtB,oBAoDE,WACE,OAAO,QAAC5C,EAAD,OAAsBlF,KAAKC,OAAWD,KAAKyF,YArDtD,GAC+BR,aAwD/B,OAxDM2C,EADN,uCACMA,EADN,0CAE2C/B,OAAeX,GAF1D,MAyDO0C","file":"chunks/app_components_versionHoverCard_tsx.xxxxxxxxxxxxxxxxxxxx.js","sourcesContent":["import * as Sentry from '@sentry/react';\n\nimport {\n  addErrorMessage,\n  addLoadingMessage,\n  addSuccessMessage,\n} from 'app/actionCreators/indicator';\nimport ReleaseActions from 'app/actions/releaseActions';\nimport {Client} from 'app/api';\nimport {t} from 'app/locale';\nimport ReleaseStore, {getReleaseStoreKey} from 'app/stores/releaseStore';\nimport {Deploy, Release, ReleaseStatus} from 'app/types';\n\ntype ParamsGet = {\n  orgSlug: string;\n  projectSlug: string;\n  releaseVersion: string;\n};\n\nexport function getProjectRelease(api: Client, params: ParamsGet) {\n  const {orgSlug, projectSlug, releaseVersion} = params;\n  const path = `/projects/${orgSlug}/${projectSlug}/releases/${encodeURIComponent(\n    releaseVersion\n  )}/`;\n  // HACK(leedongwei): Actions fired by the ActionCreators are queued to\n  // the back of the event loop, allowing another getRelease for the same\n  // release to be fired before the loading state is updated in store.\n  // This hack short-circuits that and update the state immediately.\n  ReleaseStore.state.releaseLoading[getReleaseStoreKey(projectSlug, releaseVersion)] =\n    true;\n  ReleaseActions.loadRelease(orgSlug, projectSlug, releaseVersion);\n\n  return api\n    .requestPromise(path, {\n      method: 'GET',\n    })\n    .then((res: Release) => {\n      ReleaseActions.loadReleaseSuccess(projectSlug, releaseVersion, res);\n    })\n    .catch(err => {\n      // This happens when a Project is not linked to a specific Release\n      if (err.status === 404) {\n        ReleaseActions.loadReleaseSuccess(projectSlug, releaseVersion, null);\n        return;\n      }\n\n      ReleaseActions.loadReleaseError(projectSlug, releaseVersion, err);\n      Sentry.withScope(scope => {\n        scope.setLevel(Sentry.Severity.Warning);\n        scope.setFingerprint(['getRelease-action-creator']);\n        Sentry.captureException(err);\n      });\n    });\n}\n\nexport function getReleaseDeploys(api: Client, params: ParamsGet) {\n  const {orgSlug, projectSlug, releaseVersion} = params;\n  const path = `/organizations/${orgSlug}/releases/${encodeURIComponent(\n    releaseVersion\n  )}/deploys/`;\n\n  // HACK(leedongwei): Same as above\n  ReleaseStore.state.deploysLoading[getReleaseStoreKey(projectSlug, releaseVersion)] =\n    true;\n  ReleaseActions.loadDeploys(orgSlug, projectSlug, releaseVersion);\n\n  return api\n    .requestPromise(path, {\n      method: 'GET',\n    })\n    .then((res: Deploy[]) => {\n      ReleaseActions.loadDeploysSuccess(projectSlug, releaseVersion, res);\n    })\n    .catch(err => {\n      // This happens when a Project is not linked to a specific Release\n      if (err.status === 404) {\n        ReleaseActions.loadDeploysSuccess(projectSlug, releaseVersion, null);\n        return;\n      }\n\n      ReleaseActions.loadDeploysError(projectSlug, releaseVersion, err);\n      Sentry.withScope(scope => {\n        scope.setLevel(Sentry.Severity.Warning);\n        scope.setFingerprint(['getReleaseDeploys-action-creator']);\n        Sentry.captureException(err);\n      });\n    });\n}\n\nexport function archiveRelease(api: Client, params: ParamsGet) {\n  const {orgSlug, projectSlug, releaseVersion} = params;\n\n  ReleaseActions.loadRelease(orgSlug, projectSlug, releaseVersion);\n  addLoadingMessage(t('Archiving Release\\u2026'));\n\n  return api\n    .requestPromise(`/organizations/${orgSlug}/releases/`, {\n      method: 'POST',\n      data: {\n        status: ReleaseStatus.Archived,\n        projects: [],\n        version: releaseVersion,\n      },\n    })\n    .then((release: Release) => {\n      ReleaseActions.loadReleaseSuccess(projectSlug, releaseVersion, release);\n      addSuccessMessage(t('Release was successfully archived.'));\n    })\n    .catch(error => {\n      ReleaseActions.loadReleaseError(projectSlug, releaseVersion, error);\n      addErrorMessage(\n        error.responseJSON?.detail ?? t('Release could not be be archived.')\n      );\n      throw error;\n    });\n}\n\nexport function restoreRelease(api: Client, params: ParamsGet) {\n  const {orgSlug, projectSlug, releaseVersion} = params;\n\n  ReleaseActions.loadRelease(orgSlug, projectSlug, releaseVersion);\n  addLoadingMessage(t('Restoring Release\\u2026'));\n\n  return api\n    .requestPromise(`/organizations/${orgSlug}/releases/`, {\n      method: 'POST',\n      data: {\n        status: ReleaseStatus.Active,\n        projects: [],\n        version: releaseVersion,\n      },\n    })\n    .then((release: Release) => {\n      ReleaseActions.loadReleaseSuccess(projectSlug, releaseVersion, release);\n      addSuccessMessage(t('Release was successfully restored.'));\n    })\n    .catch(error => {\n      ReleaseActions.loadReleaseError(projectSlug, releaseVersion, error);\n      addErrorMessage(\n        error.responseJSON?.detail ?? t('Release could not be be restored.')\n      );\n      throw error;\n    });\n}\n","import Reflux from 'reflux';\n\nexport default Reflux.createActions([\n  'loadRelease', // Singular as it loads 1 release\n  'loadReleaseError',\n  'loadReleaseSuccess',\n  'loadDeploys', // Plural as it loads all deploys related to a release\n  'loadDeploysError',\n  'loadDeploysSuccess',\n]);\n","import Reflux from 'reflux';\n\nexport default Reflux.createActions([\n  'resetRepositories',\n  'loadRepositories',\n  'loadRepositoriesError',\n  'loadRepositoriesSuccess',\n]);\n","import {Component} from 'react';\n\nimport UserAvatar from 'app/components/avatar/userAvatar';\nimport TimeSince from 'app/components/timeSince';\nimport {t} from 'app/locale';\nimport {AvatarUser, Commit} from 'app/types';\n\ntype Props = {\n  commit: Commit;\n  headerClass: string;\n};\n\nconst unknownUser: AvatarUser = {\n  id: '',\n  name: '',\n  username: '??',\n  email: '',\n  avatarUrl: '',\n  avatar: {\n    avatarUuid: '',\n    avatarType: 'letter_avatar',\n  },\n  ip_address: '',\n};\n\nclass LastCommit extends Component<Props> {\n  renderMessage(message: Commit['message']): string {\n    if (!message) {\n      return t('No message provided');\n    }\n\n    const firstLine = message.split(/\\n/)[0];\n    if (firstLine.length > 100) {\n      let truncated = firstLine.substr(0, 90);\n      const words = truncated.split(/ /);\n      // try to not have elipsis mid-word\n      if (words.length > 1) {\n        words.pop();\n        truncated = words.join(' ');\n      }\n      return truncated + '...';\n    }\n    return firstLine;\n  }\n\n  render() {\n    const {commit, headerClass} = this.props;\n    const commitAuthor = commit && commit.author;\n    return (\n      <div>\n        <h6 className={headerClass}>Last commit</h6>\n        <div className=\"commit\">\n          <div className=\"commit-avatar\">\n            <UserAvatar user={commitAuthor || unknownUser} />\n          </div>\n          <div className=\"commit-message truncate\">\n            {this.renderMessage(commit.message)}\n          </div>\n          <div className=\"commit-meta\">\n            <strong>{(commitAuthor && commitAuthor.name) || t('Unknown Author')}</strong>\n            &nbsp;\n            <TimeSince date={commit.dateCreated} />\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default LastCommit;\n","import styled from '@emotion/styled';\n\nimport overflowEllipsis from 'app/styles/overflowEllipsis';\n\nconst RepoLabel = styled('span')`\n  /* label mixin from bootstrap */\n  font-weight: 700;\n  color: ${p => p.theme.white};\n  text-align: center;\n  white-space: nowrap;\n  border-radius: 0.25em;\n  /* end of label mixin from bootstrap */\n\n  ${overflowEllipsis};\n\n  display: inline-block;\n  vertical-align: text-bottom;\n  line-height: 1;\n  background: ${p => p.theme.gray200};\n  padding: 3px;\n  max-width: 86px;\n  font-size: ${p => p.theme.fontSizeSmall};\n`;\n\nexport default RepoLabel;\n","import * as React from 'react';\n\nimport {getProjectRelease, getReleaseDeploys} from 'app/actionCreators/release';\nimport {Client} from 'app/api';\nimport ReleaseStore from 'app/stores/releaseStore';\nimport {Deploy, Organization, Release} from 'app/types';\nimport getDisplayName from 'app/utils/getDisplayName';\n\ntype DependentProps = {\n  api: Client;\n  organization: Organization;\n  projectSlug: string;\n  releaseVersion: string;\n};\n\ntype InjectedProps = {\n  release?: Release;\n  releaseLoading?: boolean;\n  releaseError?: Error;\n  deploys?: Array<Deploy>;\n  deploysLoading?: boolean;\n  deploysError?: Error;\n};\n\nfunction withRelease<P extends DependentProps>(WrappedComponent: React.ComponentType<P>) {\n  class WithRelease extends React.Component<\n    Omit<P, keyof InjectedProps> & Partial<InjectedProps> & DependentProps,\n    InjectedProps\n  > {\n    static displayName = `withRelease(${getDisplayName(WrappedComponent)})`;\n\n    constructor(props, context) {\n      super(props, context);\n\n      const {projectSlug, releaseVersion} = this.props;\n      const releaseData = ReleaseStore.get(projectSlug, releaseVersion);\n      this.state = {...releaseData};\n    }\n\n    componentDidMount() {\n      this.fetchRelease();\n      this.fetchDeploys();\n    }\n\n    componentWillUnmount() {\n      this.unsubscribe();\n    }\n\n    unsubscribe = ReleaseStore.listen(() => this.onStoreUpdate(), undefined);\n\n    fetchRelease() {\n      const {api, organization, projectSlug, releaseVersion} = this.props;\n      const releaseData = ReleaseStore.get(projectSlug, releaseVersion);\n      const orgSlug = organization.slug;\n\n      if (\n        (!releaseData.release && !releaseData.releaseLoading) ||\n        releaseData.releaseError\n      ) {\n        getProjectRelease(api, {orgSlug, projectSlug, releaseVersion});\n      }\n    }\n\n    fetchDeploys() {\n      const {api, organization, projectSlug, releaseVersion} = this.props;\n      const releaseData = ReleaseStore.get(projectSlug, releaseVersion);\n      const orgSlug = organization.slug;\n\n      if (\n        (!releaseData.deploys && !releaseData.deploysLoading) ||\n        releaseData.deploysError\n      ) {\n        getReleaseDeploys(api, {orgSlug, projectSlug, releaseVersion});\n      }\n    }\n\n    onStoreUpdate() {\n      const {projectSlug, releaseVersion} = this.props;\n      const releaseData = ReleaseStore.get(projectSlug, releaseVersion);\n\n      this.setState({...releaseData});\n    }\n\n    render() {\n      return (\n        <WrappedComponent\n          {...(this.props as P & DependentProps)}\n          {...(this.state as InjectedProps)}\n        />\n      );\n    }\n  }\n  return WithRelease;\n}\n\nexport default withRelease;\n","import * as React from 'react';\nimport styled from '@emotion/styled';\n\nimport {Client} from 'app/api';\nimport AvatarList from 'app/components/avatar/avatarList';\nimport Button from 'app/components/button';\nimport Clipboard from 'app/components/clipboard';\nimport Hovercard from 'app/components/hovercard';\nimport LastCommit from 'app/components/lastCommit';\nimport LoadingError from 'app/components/loadingError';\nimport LoadingIndicator from 'app/components/loadingIndicator';\nimport RepoLabel from 'app/components/repoLabel';\nimport TimeSince from 'app/components/timeSince';\nimport Version from 'app/components/version';\nimport {IconCopy} from 'app/icons';\nimport {t} from 'app/locale';\nimport space from 'app/styles/space';\nimport {Deploy, Organization, Release, Repository} from 'app/types';\nimport {defined} from 'app/utils';\nimport withApi from 'app/utils/withApi';\nimport withRelease from 'app/utils/withRelease';\nimport withRepositories from 'app/utils/withRepositories';\n\ntype Props = {\n  api: Client;\n  projectSlug: string;\n  releaseVersion: string;\n\n  organization: Organization;\n  release?: Release;\n  releaseLoading?: boolean;\n  releaseError?: Error;\n  deploys?: Array<Deploy>;\n  deploysLoading?: boolean;\n  deploysError?: Error;\n  repositories?: Array<Repository>;\n  repositoriesLoading?: boolean;\n  repositoriesError?: Error;\n};\n\ntype State = {\n  visible: boolean;\n};\n\nclass VersionHoverCard extends React.Component<Props, State> {\n  state: State = {\n    visible: false,\n  };\n\n  toggleHovercard() {\n    this.setState({\n      visible: true,\n    });\n  }\n\n  getRepoLink() {\n    const {organization} = this.props;\n    const orgSlug = organization.slug;\n    return {\n      header: null,\n      body: (\n        <ConnectRepo>\n          <h5>{t('Releases are better with commit data!')}</h5>\n          <p>\n            {t(\n              'Connect a repository to see commit info, files changed, and authors involved in future releases.'\n            )}\n          </p>\n          <Button href={`/organizations/${orgSlug}/repos/`} priority=\"primary\">\n            {t('Connect a repository')}\n          </Button>\n        </ConnectRepo>\n      ),\n    };\n  }\n\n  getBody() {\n    const {releaseVersion, release, deploys} = this.props;\n    if (release === undefined || !defined(deploys)) {\n      return {header: null, body: null};\n    }\n\n    const {lastCommit} = release;\n    const recentDeploysByEnvironment = deploys.reduce(function (dbe, deploy) {\n      const {dateFinished, environment} = deploy;\n      if (!dbe.hasOwnProperty(environment)) {\n        dbe[environment] = dateFinished;\n      }\n\n      return dbe;\n    }, {});\n    let mostRecentDeploySlice = Object.keys(recentDeploysByEnvironment);\n\n    if (Object.keys(recentDeploysByEnvironment).length > 3) {\n      mostRecentDeploySlice = Object.keys(recentDeploysByEnvironment).slice(0, 3);\n    }\n\n    return {\n      header: (\n        <HeaderWrapper>\n          {t('Release')}\n          <VersionWrapper>\n            <StyledVersion version={releaseVersion} truncate anchor={false} />\n\n            <Clipboard value={releaseVersion}>\n              <ClipboardIconWrapper>\n                <IconCopy size=\"xs\" />\n              </ClipboardIconWrapper>\n            </Clipboard>\n          </VersionWrapper>\n        </HeaderWrapper>\n      ),\n      body: (\n        <div>\n          <div className=\"row row-flex\">\n            <div className=\"col-xs-4\">\n              <h6>{t('New Issues')}</h6>\n              <div className=\"count-since\">{release.newGroups}</div>\n            </div>\n            <div className=\"col-xs-8\">\n              <h6 style={{textAlign: 'right'}}>\n                {release.commitCount}{' '}\n                {release.commitCount !== 1 ? t('commits ') : t('commit ')} {t('by ')}{' '}\n                {release.authors.length}{' '}\n                {release.authors.length !== 1 ? t('authors') : t('author')}{' '}\n              </h6>\n              <AvatarList\n                users={release.authors}\n                avatarSize={25}\n                tooltipOptions={{container: 'body'} as any}\n                typeMembers=\"authors\"\n              />\n            </div>\n          </div>\n          {lastCommit && <LastCommit commit={lastCommit} headerClass=\"commit-heading\" />}\n          {deploys.length > 0 && (\n            <div>\n              <div className=\"divider\">\n                <h6 className=\"deploy-heading\">{t('Deploys')}</h6>\n              </div>\n              {mostRecentDeploySlice.map((env, idx) => {\n                const dateFinished = recentDeploysByEnvironment[env];\n                return (\n                  <div className=\"deploy\" key={idx}>\n                    <div className=\"deploy-meta\" style={{position: 'relative'}}>\n                      <VersionRepoLabel>{env}</VersionRepoLabel>\n                      {dateFinished && <StyledTimeSince date={dateFinished} />}\n                    </div>\n                  </div>\n                );\n              })}\n            </div>\n          )}\n        </div>\n      ),\n    };\n  }\n\n  render() {\n    const {\n      deploysLoading,\n      deploysError,\n      release,\n      releaseLoading,\n      releaseError,\n      repositories,\n      repositoriesLoading,\n      repositoriesError,\n    } = this.props;\n    let header: React.ReactNode = null;\n    let body: React.ReactNode = null;\n\n    const loading = !!(deploysLoading || releaseLoading || repositoriesLoading);\n    const error = deploysError ?? releaseError ?? repositoriesError;\n    const hasRepos = repositories && repositories.length > 0;\n\n    if (loading) {\n      body = <LoadingIndicator mini />;\n    } else if (error) {\n      body = <LoadingError />;\n    } else {\n      const renderObj: {[key: string]: React.ReactNode} =\n        hasRepos && release ? this.getBody() : this.getRepoLink();\n      header = renderObj.header;\n      body = renderObj.body;\n    }\n\n    return (\n      <Hovercard {...this.props} header={header} body={body}>\n        {this.props.children}\n      </Hovercard>\n    );\n  }\n}\n\nexport {VersionHoverCard};\nexport default withApi(withRelease(withRepositories(VersionHoverCard)));\n\nconst ConnectRepo = styled('div')`\n  padding: ${space(2)};\n  text-align: center;\n`;\n\nconst VersionRepoLabel = styled(RepoLabel)`\n  width: 86px;\n`;\n\nconst StyledTimeSince = styled(TimeSince)`\n  color: ${p => p.theme.gray300};\n  position: absolute;\n  left: 98px;\n  width: 50%;\n  padding: 3px 0;\n`;\n\nconst HeaderWrapper = styled('div')`\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n`;\nconst VersionWrapper = styled('div')`\n  display: flex;\n  flex: 1;\n  align-items: center;\n  justify-content: flex-end;\n`;\nconst StyledVersion = styled(Version)`\n  margin-right: ${space(0.5)};\n  max-width: 190px;\n`;\nconst ClipboardIconWrapper = styled('span')`\n  &:hover {\n    cursor: pointer;\n  }\n`;\n","import Reflux from 'reflux';\n\nimport OrganizationActions from 'app/actions/organizationActions';\nimport ReleaseActions from 'app/actions/releaseActions';\nimport {Deploy, Organization, Release} from 'app/types';\n\ntype StoreRelease = Map<string, Release>;\ntype StoreDeploys = Map<string, Array<Deploy>>;\ntype StoreLoading = Map<string, boolean>;\ntype StoreError = Map<string, Error>;\n\ntype ReleaseStoreInterface = {\n  get(\n    projectSlug: string,\n    releaseVersion: string\n  ): {\n    release: Release | undefined;\n    releaseLoading: boolean | undefined;\n    releaseError: Error | undefined;\n    deploys: Array<Deploy> | undefined;\n    deploysLoading: boolean | undefined;\n    deploysError: Error | undefined;\n  };\n\n  state: {\n    orgSlug: string | undefined;\n    release: StoreRelease;\n    releaseLoading: StoreLoading;\n    releaseError: StoreError;\n    deploys: StoreDeploys;\n    deploysLoading: StoreLoading;\n    deploysError: StoreError;\n  };\n\n  updateOrganization(org: Organization): void;\n  loadRelease(orgSlug: string, projectSlug: string, releaseVersion: string): void;\n  loadReleaseSuccess(projectSlug: string, releaseVersion: string, data: Release): void;\n  loadReleaseError(projectSlug: string, releaseVersion: string, error: Error): void;\n  loadDeploys(orgSlug: string, projectSlug: string, releaseVersion: string): void;\n  loadDeploysSuccess(projectSlug: string, releaseVersion: string, data: Release): void;\n  loadDeploysError(projectSlug: string, releaseVersion: string, error: Error): void;\n};\n\nexport const getReleaseStoreKey = (projectSlug: string, releaseVersion: string) =>\n  `${projectSlug}${releaseVersion}`;\n\nconst ReleaseStoreConfig: Reflux.StoreDefinition & ReleaseStoreInterface = {\n  state: {\n    orgSlug: undefined,\n    release: new Map() as StoreRelease,\n    releaseLoading: new Map() as StoreLoading,\n    releaseError: new Map() as StoreError,\n    deploys: new Map() as StoreDeploys,\n    deploysLoading: new Map() as StoreLoading,\n    deploysError: new Map() as StoreError,\n  },\n\n  listenables: ReleaseActions,\n\n  init() {\n    this.listenTo(OrganizationActions.update, this.updateOrganization);\n    this.reset();\n  },\n\n  reset() {\n    this.state = {\n      orgSlug: undefined,\n      release: new Map() as StoreRelease,\n      releaseLoading: new Map() as StoreLoading,\n      releaseError: new Map() as StoreError,\n      deploys: new Map() as StoreDeploys,\n      deploysLoading: new Map() as StoreLoading,\n      deploysError: new Map() as StoreError,\n    };\n    this.trigger(this.state);\n  },\n\n  updateOrganization(org: Organization) {\n    this.reset();\n    this.state.orgSlug = org.slug;\n    this.trigger(this.state);\n  },\n\n  loadRelease(orgSlug: string, projectSlug: string, releaseVersion: string) {\n    // Wipe entire store if the user switched organizations\n    if (!this.orgSlug || this.orgSlug !== orgSlug) {\n      this.reset();\n      this.orgSlug = orgSlug;\n    }\n\n    const releaseKey = getReleaseStoreKey(projectSlug, releaseVersion);\n    const {releaseLoading, releaseError, ...state} = this.state;\n\n    this.state = {\n      ...state,\n      releaseLoading: {\n        ...releaseLoading,\n        [releaseKey]: true,\n      },\n      releaseError: {\n        ...releaseError,\n        [releaseKey]: undefined,\n      },\n    };\n    this.trigger(this.state);\n  },\n\n  loadReleaseError(projectSlug: string, releaseVersion: string, error: Error) {\n    const releaseKey = getReleaseStoreKey(projectSlug, releaseVersion);\n    const {releaseLoading, releaseError, ...state} = this.state;\n\n    this.state = {\n      ...state,\n      releaseLoading: {\n        ...releaseLoading,\n        [releaseKey]: false,\n      },\n      releaseError: {\n        ...releaseError,\n        [releaseKey]: error,\n      },\n    };\n    this.trigger(this.state);\n  },\n\n  loadReleaseSuccess(projectSlug: string, releaseVersion: string, data: Release) {\n    const releaseKey = getReleaseStoreKey(projectSlug, releaseVersion);\n    const {release, releaseLoading, releaseError, ...state} = this.state;\n    this.state = {\n      ...state,\n      release: {\n        ...release,\n        [releaseKey]: data,\n      },\n      releaseLoading: {\n        ...releaseLoading,\n        [releaseKey]: false,\n      },\n      releaseError: {\n        ...releaseError,\n        [releaseKey]: undefined,\n      },\n    };\n    this.trigger(this.state);\n  },\n\n  loadDeploys(orgSlug: string, projectSlug: string, releaseVersion: string) {\n    // Wipe entire store if the user switched organizations\n    if (!this.orgSlug || this.orgSlug !== orgSlug) {\n      this.reset();\n      this.orgSlug = orgSlug;\n    }\n\n    const releaseKey = getReleaseStoreKey(projectSlug, releaseVersion);\n    const {deploysLoading, deploysError, ...state} = this.state;\n\n    this.state = {\n      ...state,\n      deploysLoading: {\n        ...deploysLoading,\n        [releaseKey]: true,\n      },\n      deploysError: {\n        ...deploysError,\n        [releaseKey]: undefined,\n      },\n    };\n    this.trigger(this.state);\n  },\n\n  loadDeploysError(projectSlug: string, releaseVersion: string, error: Error) {\n    const releaseKey = getReleaseStoreKey(projectSlug, releaseVersion);\n    const {deploysLoading, deploysError, ...state} = this.state;\n\n    this.state = {\n      ...state,\n      deploysLoading: {\n        ...deploysLoading,\n        [releaseKey]: false,\n      },\n      deploysError: {\n        ...deploysError,\n        [releaseKey]: error,\n      },\n    };\n    this.trigger(this.state);\n  },\n\n  loadDeploysSuccess(projectSlug: string, releaseVersion: string, data: Release) {\n    const releaseKey = getReleaseStoreKey(projectSlug, releaseVersion);\n    const {deploys, deploysLoading, deploysError, ...state} = this.state;\n\n    this.state = {\n      ...state,\n      deploys: {\n        ...deploys,\n        [releaseKey]: data,\n      },\n      deploysLoading: {\n        ...deploysLoading,\n        [releaseKey]: false,\n      },\n      deploysError: {\n        ...deploysError,\n        [releaseKey]: undefined,\n      },\n    };\n    this.trigger(this.state);\n  },\n\n  get(projectSlug: string, releaseVersion: string) {\n    const releaseKey = getReleaseStoreKey(projectSlug, releaseVersion);\n\n    return {\n      release: this.state.release[releaseKey],\n      releaseLoading: this.state.releaseLoading[releaseKey],\n      releaseError: this.state.releaseError[releaseKey],\n      deploys: this.state.deploys[releaseKey],\n      deploysLoading: this.state.deploysLoading[releaseKey],\n      deploysError: this.state.deploysError[releaseKey],\n    };\n  },\n};\n\ntype ReleaseStore = Reflux.Store & ReleaseStoreInterface;\n\nconst ReleaseStore = Reflux.createStore(ReleaseStoreConfig) as ReleaseStore;\n\nexport default ReleaseStore;\n","import Reflux from 'reflux';\n\nimport RepoActions from 'app/actions/repositoryActions';\nimport {Repository} from 'app/types';\n\ntype RepositoryStoreInterface = {\n  get(): {\n    orgSlug?: string;\n    repositories?: Repository[];\n    repositoriesLoading?: boolean;\n    repositoriesError?: Error;\n  };\n\n  state: {\n    orgSlug?: string;\n    repositories?: Repository[];\n    repositoriesLoading?: boolean;\n    repositoriesError?: Error;\n  };\n\n  loadRepositories(orgSlug: string): void;\n  loadRepositoriesSuccess(data: Repository[]): void;\n  loadRepositoriesError(error: Error): void;\n};\n\nexport const RepositoryStoreConfig: Reflux.StoreDefinition & RepositoryStoreInterface = {\n  listenables: RepoActions,\n  state: {\n    orgSlug: undefined,\n    repositories: undefined,\n    repositoriesLoading: undefined,\n    repositoriesError: undefined,\n  },\n\n  init() {\n    this.resetRepositories();\n  },\n\n  resetRepositories() {\n    this.state = {\n      orgSlug: undefined,\n      repositories: undefined,\n      repositoriesLoading: undefined,\n      repositoriesError: undefined,\n    };\n    this.trigger(this.state);\n  },\n\n  loadRepositories(orgSlug: string) {\n    this.state = {\n      orgSlug,\n      repositories: orgSlug === this.state.orgSlug ? this.state.repositories : undefined,\n      repositoriesLoading: true,\n      repositoriesError: undefined,\n    };\n    this.trigger(this.state);\n  },\n\n  loadRepositoriesError(err: Error) {\n    this.state = {\n      ...this.state,\n      repositories: undefined,\n      repositoriesLoading: false,\n      repositoriesError: err,\n    };\n    this.trigger(this.state);\n  },\n\n  loadRepositoriesSuccess(data: Repository[]) {\n    this.state = {\n      ...this.state,\n      repositories: data,\n      repositoriesLoading: false,\n      repositoriesError: undefined,\n    };\n    this.trigger(this.state);\n  },\n\n  get() {\n    return {...this.state};\n  },\n};\n\ntype RepositoryStore = Reflux.Store & RepositoryStoreInterface;\n\nconst RepositoryStore = Reflux.createStore(RepositoryStoreConfig) as RepositoryStore;\n\nexport default RepositoryStore;\n","import * as React from 'react';\n\nimport {getRepositories} from 'app/actionCreators/repositories';\nimport RepositoryActions from 'app/actions/repositoryActions';\nimport {Client} from 'app/api';\nimport RepositoryStore from 'app/stores/repositoryStore';\nimport {Organization, Repository} from 'app/types';\nimport getDisplayName from 'app/utils/getDisplayName';\n\ntype DependentProps = {\n  api: Client;\n  organization: Organization;\n};\n\ntype InjectedProps = {\n  repositories?: Repository[];\n  repositoriesLoading?: boolean;\n  repositoriesError?: Error;\n};\n\nconst INITIAL_STATE: InjectedProps = {\n  repositories: undefined,\n  repositoriesLoading: undefined,\n  repositoriesError: undefined,\n};\n\nfunction withRepositories<P extends DependentProps>(\n  WrappedComponent: React.ComponentType<P>\n) {\n  class WithRepositories extends React.Component<P & DependentProps, InjectedProps> {\n    static displayName = `withRepositories(${getDisplayName(WrappedComponent)})`;\n\n    constructor(props: P & DependentProps, context: any) {\n      super(props, context);\n\n      const {organization} = this.props;\n      const orgSlug = organization.slug;\n      const repoData = RepositoryStore.get();\n\n      if (repoData.orgSlug !== orgSlug) {\n        RepositoryActions.resetRepositories();\n      }\n\n      this.state =\n        repoData.orgSlug === orgSlug\n          ? {...INITIAL_STATE, ...repoData}\n          : {...INITIAL_STATE};\n    }\n\n    componentDidMount() {\n      // XXX(leedongwei): Do not move this function call unless you modify the\n      // unit test named \"prevents repeated calls\"\n      this.fetchRepositories();\n    }\n    componentWillUnmount() {\n      this.unsubscribe();\n    }\n    unsubscribe = RepositoryStore.listen(() => this.onStoreUpdate(), undefined);\n\n    fetchRepositories() {\n      const {api, organization} = this.props;\n      const orgSlug = organization.slug;\n      const repoData = RepositoryStore.get();\n\n      // XXX(leedongwei): Do not check the orgSlug here. It would have been\n      // verified at `getInitialState`. The short-circuit hack in actionCreator\n      // does not update the orgSlug in the store.\n      if (\n        (!repoData.repositories && !repoData.repositoriesLoading) ||\n        repoData.repositoriesError\n      ) {\n        getRepositories(api, {orgSlug});\n      }\n    }\n\n    onStoreUpdate() {\n      const repoData = RepositoryStore.get();\n      this.setState({...repoData});\n    }\n\n    render() {\n      return <WrappedComponent {...this.props} {...this.state} />;\n    }\n  }\n\n  return WithRepositories;\n}\n\nexport default withRepositories;\n","import * as Sentry from '@sentry/react';\n\nimport RepositoryActions from 'app/actions/repositoryActions';\nimport {Client} from 'app/api';\nimport RepositoryStore from 'app/stores/repositoryStore';\nimport {Repository} from 'app/types';\n\ntype ParamsGet = {\n  orgSlug: string;\n};\n\nexport function getRepositories(api: Client, params: ParamsGet) {\n  const {orgSlug} = params;\n  const path = `/organizations/${orgSlug}/repos/`;\n\n  // HACK(leedongwei): Actions fired by the ActionCreators are queued to\n  // the back of the event loop, allowing another getRepo for the same\n  // repo to be fired before the loading state is updated in store.\n  // This hack short-circuits that and update the state immediately.\n  RepositoryStore.state.repositoriesLoading = true;\n  RepositoryActions.loadRepositories(orgSlug);\n\n  return api\n    .requestPromise(path, {\n      method: 'GET',\n    })\n    .then((res: Repository[]) => {\n      RepositoryActions.loadRepositoriesSuccess(res);\n    })\n    .catch(err => {\n      RepositoryActions.loadRepositoriesError(err);\n      Sentry.withScope(scope => {\n        scope.setLevel(Sentry.Severity.Warning);\n        scope.setFingerprint(['getRepositories-action-creator']);\n        Sentry.captureException(err);\n      });\n    });\n}\n"],"sourceRoot":""}
from libhsmd import init as libhsmd_init, handle as libhsmd_handle


def test_init():
    secret = '9f5a9ba98d7e816eebf496db2ff760dc17a4a2f0ae5a87c37cab4bbf6ee05530'
    network = 'testnet'
    expected = '006f0381559410101efc8ec46e364082e364cb941717053deb3b73b97e053865db18f0043587cf02420a478100000000e8e5390aa974d364d7de7ec50b1d14e5fa4bb33a45e0f864e2724dc0cdce922602b14536f3be120f93ac756e01511d4911fb2beb2cc418cdb9053576ec03cf6c85c0942cdffdb030c25d6ac0fe26b5b48737a1d29deecf3af237baa62847a59d9a'
    res = libhsmd_init(secret, network)
    assert(res == expected)


def test_fundchannel():
    secret = '9f5a9ba98d7e816eebf496db2ff760dc17a4a2f0ae5a87c37cab4bbf6ee05530'
    network = 'testnet'
    msg = '00130200000001f25c0c5f21c46ed3f1063a9a41a489ed4e6bb2c18ef1998eb6618198b17137f90000000000666a6c8001e985010000000000160014f4d3100ee3828a602cbc47b1d70ac204e3342081f06a98200000012d70736274ff0100520200000001f25c0c5f21c46ed3f1063a9a41a489ed4e6bb2c18ef1998eb6618198b17137f90000000000666a6c8001e985010000000000160014f4d3100ee3828a602cbc47b1d70ac204e3342081f06a98200001012ba086010000000000220020cc2ef6e3d8102826a2167b463a77bfaf5b57c1ec24c52115d3c471320ad475720105475221026ecfe4d4dd089bbadcf19c860580dae91b2752261269c1f770f32f80e80680492102df1c73d6d45af5edac96953e0eaae5677411b46791092b4bef2c59648b83c20c52ae220602df1c73d6d45af5edac96953e0eaae5677411b46791092b4bef2c59648b83c20c0841c77c75000000002206026ecfe4d4dd089bbadcf19c860580dae91b2752261269c1f770f32f80e806804908109206e600000000000002df1c73d6d45af5edac96953e0eaae5677411b46791092b4bef2c59648b83c20c039c7fa80e43780ad63af6df575924b4c9ae3f1ad22f74067c28227fb45817b2e301'
    expected = '0070141f930e76a8303ac0fe0eaa21cd6afd385453784c79799ed54f10f7a0d8980501e4e30f4208e93d526e7f3cb5592b723db5e56cf764e2540113101518fc7fe501'

    res = libhsmd_init(secret, network)
    capabilities = 24
    dbid = 1
    node_id = "02312627fdf07fbdd7e5ddb136611bdde9b00d26821d14d94891395452f67af248"
    res = libhsmd_handle(capabilities, dbid, node_id, msg)
    assert(res == expected)

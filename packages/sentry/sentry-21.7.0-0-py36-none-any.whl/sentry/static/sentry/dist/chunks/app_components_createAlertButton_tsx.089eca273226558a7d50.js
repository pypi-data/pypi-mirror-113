(self.webpackChunk=self.webpackChunk||[]).push([["app_components_createAlertButton_tsx"],{"./app/components/createAlertButton.tsx":function(e,t,r){"use strict";r.d(t,{K:function(){return S}});var n=r("../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),o=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),s=r("../node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js"),a=r("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),i=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),c=r("../node_modules/@babel/runtime/regenerator/index.js"),l=r.n(c),u=(r("../node_modules/core-js/modules/es.array.filter.js"),r("../node_modules/core-js/modules/es.object.values.js"),r("../node_modules/core-js/modules/es.regexp.exec.js"),r("../node_modules/core-js/modules/es.string.match.js"),r("../node_modules/core-js/modules/es.array.includes.js"),r("../node_modules/core-js/modules/es.string.includes.js"),r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/core-js/modules/es.array.find.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/es.symbol.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),r("../node_modules/react/index.js")),d=r("../node_modules/react-router/es/index.js"),p=r("./app/actionCreators/indicator.tsx"),m=r("./app/actionCreators/navigation.tsx"),y=r("./app/components/acl/access.tsx"),g=r("./app/components/alert.tsx"),f=r("./app/components/assistant/guideAnchor.tsx"),v=r("./app/components/button.tsx"),j=r("./app/components/links/link.tsx"),h=r("./app/icons/index.tsx"),b=r("./app/locale.tsx"),Z=r("./app/utils/discover/fields.tsx"),x=r("./app/utils/withApi.tsx"),w=r("./app/views/alerts/incidentRules/constants.tsx"),_=r("./app/views/alerts/utils/index.tsx"),A=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js"),O=["projects","eventView","organization","referrer","onIncompatibleQuery","onSuccess"],k=["organization","projectSlug","iconProps","referrer","router","hideIcon","api","showPermissionGuide"];function P(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function z(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?P(Object(r),!0).forEach((function(t){(0,o.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):P(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function E(e){var t=e.incompatibleQuery,r=e.eventView,n=e.orgId,o=e.onClose,s=t.hasProjectError,a=t.hasEnvironmentError,i=t.hasEventTypeError,c=t.hasYAxisError,l=Object.values(t).filter((function(e){return!0===e})).length,d=r.clone();d.query+=" event.type:error";var p=r.clone();p.query+=" event.type:transaction";var m=r.clone();m.query+=" event.type:default";var y=r.clone();y.query+=" event.type:error or event.type:default";var g="/organizations/".concat(n,"/discover/results/"),f={error:(0,A.tZ)(j.Z,{to:{pathname:g,query:d.generateQueryStringObject()}}),default:(0,A.tZ)(j.Z,{to:{pathname:g,query:m.generateQueryStringObject()}}),transaction:(0,A.tZ)(j.Z,{to:{pathname:g,query:p.generateQueryStringObject()}}),errorDefault:(0,A.tZ)(j.Z,{to:{pathname:g,query:y.generateQueryStringObject()}})};return(0,A.BX)(q,{type:"warning",icon:(0,A.tZ)(h.aU,{color:"yellow300",size:"sm"}),children:[1===l&&(0,A.BX)(u.Fragment,{children:[s&&(0,b.t)("An alert can use data from only one Project. Select one and try again."),a&&(0,b.t)("An alert supports data from a single Environment or All Environments. Pick one try again."),i&&(0,b._N)("An alert needs a filter of [error:event.type:error], [default:event.type:default], [transaction:event.type:transaction], [errorDefault:(event.type:error OR event.type:default)]. Use one of these and try again.",f),c&&(0,b._N)("An alert can’t use the metric [yAxis] just yet. Select another metric and try again.",{yAxis:(0,A.tZ)(Q,{children:r.getYAxis()})})]}),l>1&&(0,A.BX)(u.Fragment,{children:[(0,b.t)("Yikes! That button didn’t work. Please fix the following problems:"),(0,A.BX)(D,{children:[s&&(0,A.tZ)("li",{children:(0,b.t)("Select one Project.")}),a&&(0,A.tZ)("li",{children:(0,b.t)("Select a single Environment or All Environments.")}),i&&(0,A.tZ)("li",{children:(0,b._N)("Use the filter [error:event.type:error], [default:event.type:default], [transaction:event.type:transaction], [errorDefault:(event.type:error OR event.type:default)].",f)}),c&&(0,A.tZ)("li",{children:(0,b._N)("An alert can’t use the metric [yAxis] just yet. Select another metric and try again.",{yAxis:(0,A.tZ)(Q,{children:r.getYAxis()})})})]})]}),(0,A.tZ)(I,{icon:(0,A.tZ)(h.bM,{color:"yellow300",size:"sm",isCircled:!0}),"aria-label":(0,b.t)("Close"),size:"zero",onClick:o,borderless:!0})]})}function S(e){var t=e.projects,r=e.eventView,n=e.organization,o=e.referrer,i=e.onIncompatibleQuery,c=e.onSuccess,l=(0,s.Z)(e,O),u={hasProjectError:1!==r.project.length||-1===r.project[0],hasEnvironmentError:r.environment.length>1,hasEventTypeError:null===(0,_.A4)(r.query),hasYAxisError:function(e){var t,r=(0,Z.nr)(e.getYAxis());if("field"===r.kind||"equation"===r.kind)return!0;var n=e.query.match(/event\.type:(transaction|error)/);if(!n)return!1;var o="error"===n[1]?w.yq:w.Yp,s=!o.aggregations.includes(r.function[0]),i=Z.lx[r.function[0]];if(!i)return!1;var c=i.parameters.some((function(e){return"value"===e.kind&&"number"===e.dataType})),l=[""].concat((0,a.Z)(o.fields),(0,a.Z)(null!==(t=o.measurementKeys)&&void 0!==t?t:[])),u=!c&&!l.includes(r.function[1]);return s||u}(r)},d=t.find((function(e){return e.id==="".concat(r.project[0])})),p=Object.values(u).some((function(e){return e})),m=p?void 0:{pathname:"/organizations/".concat(n.slug,"/alerts/").concat(null==d?void 0:d.slug,"/new/"),query:z(z({},r.generateQueryStringObject()),{},{createFromDiscover:!0,referrer:o})};return(0,A.tZ)(C,z({organization:n,onClick:function(e){if(p)return e.preventDefault(),void i((function(e){return(0,A.tZ)(E,{incompatibleQuery:u,eventView:r,orgId:n.slug,onClose:e})}),u);c()},to:m},l))}E.displayName="IncompatibleQueryAlert",S.displayName="CreateAlertFromViewButton";var C=(0,x.Z)((0,d.withRouter)((function(e){var t=e.organization,r=e.projectSlug,o=e.iconProps,a=e.referrer,i=e.router,c=e.hideIcon,u=e.api,d=e.showPermissionGuide,g=(0,s.Z)(e,k),Z=function(e){var r="/organizations/".concat(t.slug,"/alerts/").concat(e);return"".concat(r,"/wizard/").concat(a?"?referrer=".concat(a):"")};function x(e){e.preventDefault(),(0,m.T)(Z(":projectId"),i)}function w(){return _.apply(this,arguments)}function _(){return(_=(0,n.Z)(l().mark((function e(){var r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="/organizations/".concat(t.slug,"/"),(0,p.E3)(),e.prev=2,e.next=5,u.requestPromise(r,{method:"PUT",data:{alertsMemberWrite:!0}});case 5:(0,p.S9)((0,b.t)("Successfully updated organization settings")),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),(0,p.Iw)((0,b.t)("Unable to update organization settings"));case 11:case"end":return e.stop()}}),e,null,[[2,8]])})))).apply(this,arguments)}var O=(0,b._N)("Ask your organization owner or manager to [settingsLink:enable alerts access] for you.",{settingsLink:(0,A.tZ)(j.Z,{to:"/settings/".concat(t.slug)})}),P=function(e){var t;return(0,A.tZ)(v.ZP,z(z({disabled:!e,title:e?void 0:O,icon:!c&&(0,A.tZ)(h.vr,z({},o)),to:r?Z(r):void 0,tooltipProps:{isHoverable:!0,position:"top",popperStyle:{maxWidth:"270px"}},onClick:r?void 0:x},g),{},{children:null!==(t=g.children)&&void 0!==t?t:(0,b.t)("Create Alert")}))},E=!t.alertsMemberWrite&&!!d;return(0,A.tZ)(y.Z,{organization:t,access:["alerts:write"],children:function(e){var r=e.hasAccess;return E?(0,A.tZ)(y.Z,{organization:t,access:["org:write"],children:function(e){var t=e.hasAccess;return(0,A.tZ)(f.Z,{target:t?"alerts_write_owner":"alerts_write_member",onFinish:t?w:void 0,children:P(r)})}}):P(r)}})})));t.Z=C;var q=(0,i.Z)(g.Z,{target:"e173ycuj3"})("color:",(function(e){return e.theme.textColor}),";margin-bottom:0;"),D=(0,i.Z)("ul",{target:"e173ycuj2"})({name:"1ykowef",styles:"margin-bottom:0"}),Q=(0,i.Z)("code",{target:"e173ycuj1"})({name:"1imza1v",styles:"background-color:transparent;padding:0"}),I=(0,i.Z)(v.ZP,{target:"e173ycuj0"})({name:"1f7txv4",styles:"transition:opacity 0.1s linear;position:absolute;top:3px;right:0;&:hover,&:focus{background-color:transparent;opacity:1;}"})}}]);
//# sourceMappingURL=../sourcemaps/app_components_createAlertButton_tsx.da64db01411d3b406c2f8742d08bbbbc.js.map
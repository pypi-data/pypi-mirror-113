(this.webpackJsonptermpairjs=this.webpackJsonptermpairjs||[]).push([[0],{16:function(e,t,n){"use strict";(function(e){n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return d}));var r=n(3),a=n.n(r),c=n(5),i=12;function o(){return s.apply(this,arguments)}function s(){return(s=Object(c.a)(a.a.mark((function t(){var n,r;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,n=window.location.hash.substring(1,window.location.hash.length-1)){t.next=4;break}return t.abrupt("return",null);case 4:return r=e.from(n,"base64"),t.next=7,window.crypto.subtle.importKey("raw",r,{name:"AES-GCM"},!1,["encrypt","decrypt"]);case 7:return t.abrupt("return",t.sent);case 10:return t.prev=10,t.t0=t.catch(0),console.error(t.t0),t.abrupt("return",null);case 14:case"end":return t.stop()}}),t,null,[[0,10]])})))).apply(this,arguments)}function l(e,t){return u.apply(this,arguments)}function u(){return(u=Object(c.a)(a.a.mark((function t(n,r){var c,o,s,l;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=e.from(r,"base64"),o=c.subarray(0,i),s=c.subarray(i),t.t0=e,t.next=6,window.crypto.subtle.decrypt({name:"AES-GCM",iv:o},n,s);case 6:return t.t1=t.sent,l=t.t0.from.call(t.t0,t.t1).toString("utf-8"),t.abrupt("return",l);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function d(e,t){return b.apply(this,arguments)}function b(){return(b=Object(c.a)(a.a.mark((function e(t,n){var r,c,o,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=window.crypto.getRandomValues(new Uint8Array(i)),e.next=3,window.crypto.subtle.encrypt({name:"AES-GCM",iv:r},t,(new TextEncoder).encode(n));case 3:return c=e.sent,o=p(r,c),s=h(o),e.abrupt("return",s);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e,t){var n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n.buffer}function h(e){for(var t=new Uint8Array(e),n="",r=t.byteLength,a=0;a<r;a++)n+=String.fromCharCode(t[a]);return window.btoa(n)}}).call(this,n(33).Buffer)},29:function(e,t,n){},40:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),c=n(10),i=n.n(c),o=(n(29),n(3)),s=n.n(o),l=n(5),u=n(4),d=n(6),b=n(7),p=n(8),h=n(1),f=(n(31),n.p+"static/media/logo.0cb35f08.png"),w=n(22),m=n(23),j=n.n(m),v=n(16),x=n(20),O=(n(38),n(15)),y=n(24),g=n(2),k=Object(O.b)({key:"showSettings",default:!1});function C(e){var t=Object(O.c)(k),n=Object(h.a)(t,2),r=n[0],a=n[1];return r?Object(g.jsx)("div",{className:"w-full h-full bg-gray-900 absolute bg-opacity-90  text-black",style:{zIndex:2e3},children:Object(g.jsxs)("div",{className:"w-11/12 h-5/6 m-10 p-5 bg-gray-400 flex items-center flex-col",children:[Object(g.jsx)("div",{className:"text-xl mb-10",children:"TermPair Settings"}),Object(g.jsx)("div",{className:"flex-grow",children:"Body"}),Object(g.jsx)("div",{children:Object(g.jsx)("button",{className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full",onClick:function(){return a(!1)},children:"Close"})})]})}):null}function S(e){return Object(g.jsx)("div",{className:"flex bg-black h-10 items-center justify-between",children:Object(g.jsx)("div",{className:"h-full",children:Object(g.jsx)("a",{href:window.location.pathname,children:Object(g.jsx)("img",{className:"h-full",src:f,alt:"logo"})})})})}function E(e){var t,n,r="Connected"===e.status,a=null!=e.terminalId?Object(g.jsx)("div",{children:e.status}):null,c=r?Object(g.jsx)("div",{title:"Whether you are allowed to send data to the terminal's input. This setting is controlled when initially sharing the terminal, and cannot be changed after sharing has begun.",children:(null===(t=e.terminalData)||void 0===t?void 0:t.allow_browser_control)&&"Connected"===e.status?"can type":"cannot type"}):null,i=r?Object(g.jsxs)("div",{title:"Number of other browsers connected to this terminal",children:[e.numClients?e.numClients:"0"," Connected Client(s)"]}):null,o=r?Object(g.jsxs)("div",{children:["Started at"," ",j()(null===(n=e.terminalData)||void 0===n?void 0:n.broadcast_start_time_iso).format("h:mm a on MMM Do, YYYY")]}):null,s=r?Object(g.jsxs)("span",{title:"Dimensions of terminal, rows x cols",children:[e.terminalSize.rows,"x",e.terminalSize.cols]}):null;return Object(g.jsxs)(g.Fragment,{children:[Object(g.jsxs)("div",{className:"flex ".concat(r?"bg-green-900":"bg-red-900","   justify-evenly text-gray-300"),children:[a,s,c,i,o]}),Object(g.jsxs)("div",{className:"flex bg-black  justify-evenly text-gray-300",children:[Object(g.jsx)("div",{children:Object(g.jsx)("a",{href:"https://chadsmith.dev",children:"chadsmith.dev"})}),Object(g.jsx)("div",{children:Object(g.jsx)("a",{href:"https://github.com/cs01",children:" GitHub"})})]})]})}var T=function(e){Object(b.a)(n,e);var t=Object(p.a)(n);function n(e){var r;return Object(u.a)(this,n),(r=t.call(this,e)).state={hasError:!1},r}return Object(d.a)(n,[{key:"componentDidCatch",value:function(e,t){}},{key:"render",value:function(){return this.state.hasError?Object(g.jsx)("h1",{children:"Something went wrong."}):this.props.children}}],[{key:"getDerivedStateFromError",value:function(e){return{hasError:!0}}}]),n}(a.a.Component),_="Terminal was shared in read only mode. Unable to send data to terminal's input.",N=Object(y.debounce)((function(e){x.b.dark(e)}),500);function D(e){return"\x1b[1;31m"+e+"\x1b[0m"}function I(e){e.writeln("To broadcast a terminal, run");var t="".concat(window.location.protocol,"//").concat(window.location.hostname).concat(window.location.pathname);e.writeln("");var n=window.location.port;window.location.port||(n="https:"===window.location.protocol?443:80),e.writeln('    pipx run termpair share --host "'.concat(t,'" --port ').concat(n)),e.writeln(""),e.writeln("Then open or share the url printed to the terminal."),e.writeln(""),e.writeln("To install pipx, see https://pipxproject.github.io/pipx/"),e.writeln("All terminal data is end-to-end encrypted \ud83d\udd12."),e.writeln("The termpair server and third parties can't read transmitted data.")}var L=function(){var e=Object(r.useState)(null),t=Object(h.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)(0),i=Object(h.a)(c,2),o=i[0],u=i[1],d=Object(r.useState)({rows:20,cols:81}),b=Object(h.a)(d,2),p=b[0],f=b[1],m=Object(r.useState)(null),j=Object(h.a)(m,2),O=j[0],y=j[1],k=Object(r.useState)(null),L=Object(h.a)(k,2),A=L[0],B=L[1],M=Object(r.useState)(null),U=Object(h.a)(M,2),z=U[0],F=U[1],P=Object(r.useState)(new w.Terminal({cursorBlink:!0,macOptionIsMeta:!0,scrollback:1e3})),Y=Object(h.a)(P,1)[0],G=Object(r.useState)(new URLSearchParams(window.location.search).get("terminal_id")),K=Object(h.a)(G,1)[0],W=Object(r.useState)(null),H=Object(h.a)(W,2),J=H[0],R=H[1];Object(r.useLayoutEffect)((function(){var e=document.getElementById("terminal");e?(Y.open(e),Y.writeln("Welcome to TermPair! https://github.com/cs01/termpair"),Y.writeln("")):console.error("no terminal element, aborting")}),[]),Object(r.useEffect)((function(){A&&-1===["No Terminal provided"].indexOf(A)&&N(Object(g.jsxs)("div",{children:["Terminal status: ",A]})),function(e,t,n,r){switch(n){case null:break;case"Connected":e.writeln("Connection established with end-to-end encryption \ud83d\udd12."),e.writeln("The termpair server and third parties can't read transmitted data."),e.writeln(""),e.writeln("You can copy text with ctrl+shift+c or ctrl+shift+x, and paste with ctrl+shift+v."),e.writeln("");break;case"Disconnected":"Connected"===r&&(e.writeln(D("Terminal session has ended")),e.writeln(""),I(e));break;case"Terminal ID is invalid":e.writeln(D("An invalid Terminal ID (".concat(t,") was provided. ")+"Check that the session is still being broadcast and that the ID is entered correctly.")),e.writeln(""),I(e);break;case"Invalid encryption key":e.writeln(D("Did not receive a valid secret encryption key. Confirm the full and correct url was entered.")),e.writeln(""),I(e);break;case"Browser is not running in a secure context":e.writeln(D("Fatal Error: TermPair only works on secure connections. Ensure url starts with https. See https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts and `termpair serve --help` for more information.")),e.writeln(""),I(e);break;case"Connecting...":break;case"Connection Error":e.writeln(D("An error occurred in the websocket connection to the server. Connection has been closed.")),I(e);break;case"No Terminal provided":I(e);break;default:!function(e){throw Error}()}}(Y,K,A,z),F(A)}),[A]),Object(r.useEffect)((function(){function e(){return(e=Object(l.a)(s.a.mark((function e(){var t,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(K){e.next=4;break}return a(null),B("No Terminal provided"),e.abrupt("return");case 4:if(window.isSecureContext){e.next=7;break}return B("Browser is not running in a secure context"),e.abrupt("return");case 7:return e.next=9,Object(v.c)();case 9:return t=e.sent,R(t),t||B("Invalid encryption key"),e.next=14,fetch("terminal/".concat(K));case 14:if(200!==(n=e.sent).status){e.next=23;break}return e.t0=a,e.next=19,n.json();case 19:e.t1=e.sent,(0,e.t0)(e.t1),e.next=25;break;case 23:B("Terminal ID is invalid"),a(null);case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[K]),Object(r.useEffect)((function(){O&&clearTimeout(O),y(setTimeout((function(){Y.resize(p.cols,p.rows)}),500))}),[p,Y]),Object(r.useEffect)((function(){!function(){if(null===A&&(null===n||void 0===n?void 0:n.terminal_id)&&J){B("Connecting...");var e,t="https:"===window.location.protocol?"wss":"ws",r=new WebSocket("".concat(t,"://").concat(window.location.hostname,":").concat(window.location.port).concat(window.location.pathname,"connect_browser_to_terminal?terminal_id=").concat(n.terminal_id));Y.attachCustomKeyEventHandler(function(e,t,n){function r(r){if("keydown"!==r.type)return!0;if(r.ctrlKey&&r.shiftKey){var a=r.key.toLowerCase();if("v"===a)return t?(navigator.clipboard.readText().then((function(e){n(e)})),!1):(N(_),!1);if("c"===a||"x"===a){var c=e.getSelection();return navigator.clipboard.writeText(c),e.focus(),!1}}return!0}return r}(Y,null===n||void 0===n?void 0:n.allow_browser_control,function(){var e=Object(l.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.t0=r,e.next=4,Object(v.b)(J,t);case 4:e.t1=e.sent,e.t0.send.call(e.t0,e.t1),e.next=11;break;case 8:e.prev=8,e.t2=e.catch(0),console.error("Failed to send data over websocket",e.t2);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t){return e.apply(this,arguments)}}())),r.addEventListener("open",(function(t){B("Connected"),e=Y.onData(function(){var e=Object(l.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!1!==n.allow_browser_control){e.next=4;break}return N(_),e.abrupt("return");case 4:return e.t0=r,e.next=7,Object(v.b)(J,t);case 7:e.t1=e.sent,e.t0.send.call(e.t0,e.t1),e.next=14;break;case 11:e.prev=11,e.t2=e.catch(0),console.error("Failed to send data over websocket",e.t2);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t){return e.apply(this,arguments)}}())})),r.addEventListener("close",(function(t){e&&e.dispose(),B("Disconnected"),u(0)})),r.addEventListener("error",(function(t){e&&e.dispose(),console.error(t),B("Connection Error"),u(0)})),r.addEventListener("message",function(){var e=Object(l.a)(s.a.mark((function e(t){var n,r,a,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("new_output"!==(n=JSON.parse(t.data)).event){e.next=9;break}return r=n.payload,e.next=5,Object(v.a)(J,r);case 5:a=e.sent,Y.write(a),e.next=10;break;case 9:"resize"===n.event?n.payload.cols&&n.payload.rows&&f({cols:n.payload.cols,rows:n.payload.rows}):"num_clients"===n.event?(c=n.payload,u(c)):console.error("unknown event type",n);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}}()}),[n,A]);var V=Object(g.jsx)("div",{id:"terminal",className:"p-3 bg-black flex-grow text-gray-400"});return Object(g.jsx)(T,{children:Object(g.jsxs)("div",{className:"flex flex-col h-screen",children:[Object(g.jsx)(x.a,{position:"bottom-right",limit:3,autoClose:5e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!1,draggable:!0,pauseOnHover:!0}),Object(g.jsx)(C,{}),Object(g.jsx)(S,{}),V,Object(g.jsx)(E,{terminalData:n,status:A,terminalId:K,terminalSize:p,numClients:o})]})})};i.a.render(Object(g.jsx)(a.a.StrictMode,{children:Object(g.jsx)(O.a,{children:Object(g.jsx)(L,{})})}),document.getElementById("root"))}},[[40,1,2]]]);
//# sourceMappingURL=main.c998c7be.chunk.js.map
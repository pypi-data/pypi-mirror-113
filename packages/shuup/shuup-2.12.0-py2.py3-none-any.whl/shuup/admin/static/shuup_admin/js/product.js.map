{"version":3,"sources":["../base/js/dropzone.js","edit_media.js"],"names":["activateDropzone","$dropzone","attrs","length","console","error","selector","attr","$data","$","data","uploadPath","upload_path","addRemoveLinks","add_remove_links","uploadUrl","upload_url","window","ShuupAdminConfig","browserUrls","media","upload","browsable","extraAttrs","Object","keys","filter","startsWith","forEach","attrKey","replace","params","assign","url","csrfmiddlewaretoken","csrf","dictRemoveFile","gettext","autoProcessQueue","uploadMultiple","parallelUploads","maxFiles","dictDefaultMessage","clickable","accept","file","done","kind","type","indexOf","dropzone","Dropzone","on","onAddedFile","files","removeFile","onRemovedFile","find","val","onSuccess","xhr","JSON","parse","responseText","id","onError","errorMessage","response","Messages","enqueue","tags","text","onQueueComplete","noop","BrowseAPI","openBrowseWindow","disabledMenus","onSelect","obj","name","remove","emit","thumbnail","fileInput","document","createElement","body","appendChild","prop","css","evt","target","addFile","trigger","push","activateDropzones","each","idx","object","includes","module","exports","e","preventDefault","confirm","parents","fadeOut","next","$panel","prefix","split","current","$imagePanels","removeClass","addClass","replaceWith","i","addMediaPanel","$section","section","maxPanelId","map","v","el","toArray","value","panelCount","Math","max","$source","html","$html","targetId","$contents","$name","append","prepend","insertBefore","getFileIds","$fileInputs","fileIds","fileId","parseInt","isNaN","getFileCount","setFileCount","count","onDropzoneQueueComplete","location","pathname","productId","product_id","ajax","add_media","method","file_ids","traditional","success","added","addedMedia","filePanel","product_media","message","alert","onDropzoneSuccess","dropzones","field","targetPath","queueComplete","zoneData","fieldId"],"mappings":"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","file":"product.js","sourceRoot":"../../../static_src/product","sourcesContent":["/**\n * This file is part of Shuup.\n *\n * Copyright (c) 2012-2021, Shuup Commerce Inc. All rights reserved.\n *\n * This source code is licensed under the OSL-3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\nfunction activateDropzone($dropzone, attrs={}) {\n    if(!$dropzone.length) {\n        console.error(\"Error! [dropzone.js] Unable to find requested element \", $dropzone);\n        return;\n    }\n\n    const selector = \"#\" + $dropzone.attr(\"id\");\n    const $data = $(selector).data();\n    const uploadPath = $data.upload_path || attrs.uploadPath;\n    const addRemoveLinks = $data.add_remove_links;\n    const uploadUrl = (\n        $data.upload_url ||\n        window.ShuupAdminConfig.browserUrls.media ||\n        window.ShuupAdminConfig.browserUrls.upload\n    );\n    const browsable = (window.ShuupAdminConfig.browserUrls[\"media\"] && $data.browsable && $data.browsable !== \"False\");\n\n    // Load attributes encoded in attributes with `data-dz-` prefixes\n    // e.g.: data-dz-maxFilesize=\"10000\"\n    const extraAttrs = {};\n    Object.keys($data).filter(attr => attr.startsWith(\"dz_\")).forEach((attr) => {\n        const attrKey = attr.replace(\"dz_\", \"\");\n        extraAttrs[attrKey] = $data[attr];\n    });\n\n    const params = Object.assign({\n        url: uploadUrl + \"?action=upload&path=\" + uploadPath,\n        uploadUrl,\n        params: {\n            csrfmiddlewaretoken: window.ShuupAdminConfig.csrf\n        },\n        addRemoveLinks: (addRemoveLinks === \"True\"),\n        dictRemoveFile: gettext(\"Clear\"),\n        autoProcessQueue: true,\n        uploadMultiple: false,\n        parallelUploads: 1,\n        maxFiles: 1,\n        dictDefaultMessage: gettext(\"Drop files here or click to browse.\"),\n        clickable: false,\n        accept: function(file, done) {\n            if ($data.kind === \"images\" && file.type.indexOf(\"image\") < 0) {\n                done(gettext(\"only images can be uploaded!\"));\n            } else {\n                done();\n            }\n        }\n    }, extraAttrs, attrs);\n    const dropzone = new Dropzone(selector, params);\n\n    dropzone.on(\"addedfile\", attrs.onAddedFile || function(file) {\n        if(params.maxFiles === 1 && dropzone.files.length > 1) {\n            dropzone.removeFile(dropzone.files[0]);\n        }\n    });\n\n    dropzone.on(\"removedfile\", attrs.onRemovedFile || function(data){\n        $(selector).find(\"input\").val(\"\");\n    });\n\n    dropzone.on(\"success\", attrs.onSuccess || function(data){\n        // file selected through dnd\n        if(data.xhr) {\n            data = JSON.parse(data.xhr.responseText).file;\n        }\n        $(selector).find(\"input\").val(data.id);\n    });\n\n    dropzone.on(\"error\", attrs.onError|| function(data){\n        let errorMessage = gettext(\"Error happened while uploading file.\")\n        if(data.xhr) {\n            response = JSON.parse(data.xhr.responseText)\n            if (response.error && response.error.file) {\n                errorMessage = JSON.parse(data.xhr.responseText).error.file\n            }\n        }\n\n        window.Messages.enqueue({ tags: \"error\", text: errorMessage});\n        dropzone.removeFile(data);\n    });\n\n    dropzone.on(\"queuecomplete\", attrs.onQueueComplete || $.noop);\n\n    $(selector).on(\"click\", function() {\n        if (browsable) {\n            window.BrowseAPI.openBrowseWindow({\n                kind: \"media\",\n                disabledMenus: [\"delete\", \"rename\"],\n                filter: $(selector).data().kind,\n                onSelect: (obj) => {\n                    obj.name = obj.text;\n                    $(selector).find(\"input\").val(obj.id);\n                    $(selector).find(\".dz-preview\").remove();\n                    dropzone.emit(\"addedfile\", obj);\n                    if(obj.thumbnail) {\n                        dropzone.emit(\"thumbnail\", obj, obj.thumbnail);\n                    }\n                    dropzone.emit(\"success\", obj);\n                    dropzone.emit(\"complete\", obj);\n                }\n            });\n        } else {\n            const fileInput = document.createElement(\"input\");\n            document.body.appendChild(fileInput);\n            $(fileInput).prop(\"type\", \"file\").css(\"display\", \"none\").on(\"change\", (evt) => {\n                const file = evt.target.files[0];\n                dropzone.addFile(file);\n                fileInput.remove();\n            }).trigger(\"click\");\n        }\n    });\n\n    const data = $(selector).data();\n    if(data.url) {\n        dropzone.files.push(data);\n        dropzone.emit(\"addedfile\", data);\n        if(data.thumbnail){\n            dropzone.emit(\"thumbnail\", data, data.thumbnail);\n        }\n        dropzone.emit(\"complete\", data);\n    }\n}\n\nwindow.activateDropzones = function() {\n    $(\"div[data-dropzone='true']\").each(function(idx, object) {\n        const dropzone = $(object);\n        if(!dropzone.attr(\"id\").includes(\"__prefix__\") && dropzone.find(\".dz-message\").length === 0) {\n            activateDropzone(dropzone);\n        }\n    });\n};\nwindow.activateDropzone = activateDropzone;\n\n$(function(){\n    window.activateDropzones();\n});\n\nmodule.exports = { activateDropzone }\n","/**\n * This file is part of Shuup.\n *\n * Copyright (c) 2012-2021, Shuup Commerce Inc. All rights reserved.\n *\n * This source code is licensed under the OSL-3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { activateDropzone } from '../base/js/dropzone';\n\n$(function() {\n    $(\".product-media-delete\").on(\"click\", function(e) {\n        e.preventDefault();\n        if (confirm(gettext(\"Are you sure you want to delete this media?\")))\n        {\n            $(this).parents(\".panel\").fadeOut();\n            $(this).next(\".d-none\").find(\"input\").prop(\"checked\", true);\n        }\n    });\n\n    $(document).on(\"click\", \".set-as-primary\", function(e) {\n        e.preventDefault();\n        const $panel = $(this).parents(\".panel\");\n        const prefix = $panel.data(\"prefix\");\n\n        const [, current] = prefix.split(\"-\");\n\n        const $imagePanels = $(\"#product-images-section .panel\");\n\n        $imagePanels.removeClass(\"panel-selected\").addClass(\"panel-default\");\n\n        $(\".is-primary-image\").replaceWith(function() {\n            return $(\"<a>\", {\"class\": \"set-as-primary btn btn-sm btn-inverse\", \"href\": \"#\"}).text(gettext(\"Set as primary image\"));\n        });\n\n        $imagePanels.each(function(i) {\n            $(\"#id_images-\" + i + \"-is_primary\").prop(\"checked\", false);\n        });\n\n        $(this).replaceWith(function() {\n            return $(\"<span>\", {\"class\": \"is-primary-image\"}).text(gettext(\"Primary image\"));\n        });\n\n        $panel.addClass(\"panel-selected\");\n        $(\"#id_images-\" + current + \"-is_primary\").prop(\"checked\", true);\n    });\n\n    function addMediaPanel($section, file) {\n        const section = $section.attr(\"id\");\n        const maxPanelId = $(\"#\" + section + \" .panel\")\n            .map((v, el) => $(el).data(\"idx\")).toArray()\n            .filter(value => value !== \"__prefix_name__\");\n        const panelCount = maxPanelId.length ? Math.max(...maxPanelId) : 0;\n        const $source = $(\"#\" + section + \"-placeholder-panel\");\n\n        let html = $source.html().replace(/__prefix__/g, panelCount).replace(/__prefix_name__/g, panelCount + 1);\n        if (file) {\n            html = html.replace(/__file_id__/g, file.id);\n        }\n        const $html = $(html);\n\n        let targetId = \"id_images\";\n        if (section.indexOf(\"media\") > 0) {\n            targetId = \"id_media\";\n        }\n\n        $(\"#\" + targetId + \"-TOTAL_FORMS\").val($(\"#\" + section + \" .panel\").length);\n        $(\"#\" + targetId + \"-INITIAL_FORMS\").val($(\"#\" + section + \" .panel\").length);\n        if (file) {\n            let $contents = $(\"<a class='thumbnail-image' href='\" + file.url + \"' target='_blank'></a>\");\n            let $name = \"<h4>\" + file.name + \"</h4>\";\n            if(targetId === \"id_images\") {\n                $contents.append(\"<img src='\" + file.url + \"'>\");\n                $html.find(\".thumbnail\").append($contents);\n            } else {\n                $contents.append(\"<img src='\" + file.url + \"' />\");\n                $html.find(\".extra-fields\").prepend($name);\n            }\n            $html.find(\".file-control\").find(\"input\").val(file.id);\n        }\n        $html.insertBefore($source);\n    }\n\n    function getFileIds(kind) {\n        const $fileInputs = $(\"#product-\" + kind + \"-section\").find(\".file-control input\");\n        var fileIds = [];\n        for(var i = 0; i < $fileInputs.length; i++){\n            let fileId = parseInt($($fileInputs[i]).val());\n            if(!isNaN(fileId)) {\n                fileIds.push(parseInt($($fileInputs[i]).val()));\n            }\n        }\n        return fileIds\n    }\n\n    function getFileCount(kind) {\n        return $(\"#product-\" + kind + \"-section\").data(\"saved_file_count\") || 0;\n    }\n\n    function setFileCount(kind, count) {\n        $(\"#product-\" + kind + \"-section\").data(\"saved_file_count\", count);\n    }\n\n    function onDropzoneQueueComplete(dropzone, kind) {\n        if(location.pathname.indexOf(\"new\") > 0) {\n            // save product media the traditional way via the save button when creating a new product\n            return;\n        }\n        const productId = $(\"#product-\" + kind + \"-section-dropzone\").data().product_id;\n        if (!productId) {\n            return;\n        }\n\n        let fileIds = getFileIds(kind);\n        if (getFileCount(kind) === fileIds.length) {  // Skip add media if file count has not changed\n            return;\n        }\n\n        $.ajax({\n            url: window.ShuupAdminConfig.browserUrls.add_media.replace(\"/99999/\", \"/\" + productId + \"/\"),\n            method: \"POST\",\n            data: {\n                csrfmiddlewaretoken: ShuupAdminConfig.csrf,\n                product_id: productId,\n                file_ids: fileIds,\n                kind\n            },\n            traditional: true,\n            success: function(data) {\n                if (data.added) {\n                    data.added.forEach((addedMedia) => {\n                        const filePanel = $(\".panel[data-file='\" + addedMedia.file + \"']\");\n                        const idx = parseInt(filePanel.data(\"idx\"), 10) - 1;\n                        $(\"#id_\" + kind + \"-\" + idx + \"-file\").prop(\"value\", addedMedia.file);\n                        $(\"#id_\" + kind + \"-\" + idx + \"-id\").prop(\"value\", addedMedia.product_media);\n                    });\n                }\n                window.Messages.enqueue({\n                    tags: \"success\",\n                    text: data.message\n                });\n            },\n            error: function(data) {\n                alert(\"Error!\");\n            }\n        });\n    }\n\n    function onDropzoneSuccess($section, file) {\n        // file selected through dnd\n        if(file.xhr) {\n            file = JSON.parse(file.xhr.responseText).file;\n        }\n        addMediaPanel($section, file);\n    }\n    const dropzones = [\n        {\n            field: 'product-images-section',\n            targetPath: \"/products/images\",\n            maxFiles: 10,\n            queueComplete: \"images\"\n        },\n        {\n            field: 'product-media-section',\n            targetPath: \"/products/media\",\n            maxFiles: 10,\n            queueComplete: \"media\"\n        }\n    ];\n    dropzones.forEach(function(zoneData) {\n        var fieldId = \"#\" + zoneData.field + \"-dropzone\";\n        if ($(fieldId).length) {\n            // Save file count so we can prevent saving product media\n            // if file count has not changed\n            setFileCount(zoneData.queueComplete, getFileIds(zoneData.queueComplete).length);\n            activateDropzone($(fieldId), {\n                uploadPath: zoneData.targetPath,\n                maxFiles: zoneData.maxFiles,\n                onSuccess: function(file) {\n                    onDropzoneSuccess($(\"#\" + zoneData.field), file);\n                },\n                onQueueComplete: function() {\n                    onDropzoneQueueComplete(this, zoneData.queueComplete);\n                }\n            });\n        }\n    });\n});\n"]}
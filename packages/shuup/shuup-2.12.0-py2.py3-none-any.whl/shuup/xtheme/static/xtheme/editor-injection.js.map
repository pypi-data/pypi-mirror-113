{"mappings":"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","sources":["static_src/lib/domready.js","static_src/injection/editor-injection.js","static_src/lib/qs.js","static_src/lib/el.js","static_src/lib/ajax.js"],"sourcesContent":["/**\n * This file is part of Shuup.\n *\n * Copyright (c) 2012-2021, Shuup Commerce Inc. All rights reserved.\n *\n * This source code is licensed under the OSL-3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\nconst callbacks = [];\nconst events = [\"DOMContentLoaded\", \"load\"];\nvar loaded = (document.readyState === \"complete\");\n\nfunction listener() {\n    events.forEach((ev) => { document.removeEventListener(ev, listener); });\n    if (!loaded) {\n        loaded = true;\n        var fn;\n        while ((fn = callbacks.shift())) {\n            fn();\n        }\n    }\n}\n\nif (!loaded) {\n    events.forEach((ev) => { document.addEventListener(ev, listener); });\n}\n\nexport default function(fn) {\n    if (loaded) {\n        setTimeout(fn, 0);\n    } else {\n        callbacks.push(fn);\n    }\n}\n","/**\n * This file is part of Shuup.\n *\n * Copyright (c) 2012-2021, Shuup Commerce Inc. All rights reserved.\n *\n * This source code is licensed under the OSL-3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n// import styles\nimport \"./editor-injection.less\";\n\nimport domready from \"../lib/domready\";\nimport { stringify, mutateURL } from \"../lib/qs\";\nimport el from \"../lib/el\";\nimport ajax from \"../lib/ajax\";\n\nvar _sidebarDiv = null;\nvar _sidebarIframe = null;\nvar _sidebarToggler = null;\n\nfunction getSidebarDiv() {\n    if (_sidebarDiv === null) {\n        _sidebarDiv = el(\"div\", { id: \"xt-edit-sidebar\" }, [\n            el(\"div\", { id: \"xt-edit-sidebar-container\" },\n                (_sidebarIframe = el(\"iframe\", {\n                    id: \"xt-edit-sidebar-iframe\"\n                }))\n            )\n        ]);\n        document.body.appendChild(_sidebarDiv);\n    }\n    return _sidebarDiv;\n}\n\nfunction getSidebarIframe() {\n    getSidebarDiv();\n    return _sidebarIframe;\n}\n\nfunction setPopup(visible) {\n    const sidebarDiv = getSidebarDiv();\n    if (visible === undefined) {\n        sidebarDiv.classList.toggle(\"popout\");\n    } else {\n        sidebarDiv.classList.toggle(\"popout\", !!visible);\n    }\n}\n\nfunction openPlaceholderEditor(domElement) {\n    const layoutIdentifier = domElement.dataset.xtLayoutIdentifier;\n    const layoutDataKey = domElement.dataset.xtLayoutDataKey;\n    const placeholderName = domElement.dataset.xtPlaceholderName;\n    const globalType = domElement.dataset.xtGlobalType;\n    const contentTypeId = domElement.dataset.xtContentTypeId;\n    if (!placeholderName) {\n        return;\n    }\n    const defaultConfigElement = domElement.querySelector(\"script.xt-ph-default-layout\");\n    const defaultConfigJSON = (defaultConfigElement ? defaultConfigElement.innerHTML : null);\n    const viewName = window.XthemeEditorConfig.viewName;\n    const urlParams = {\n        view: viewName,\n        theme: window.XthemeEditorConfig.themeIdentifier,\n        ph: placeholderName,\n        \"global_type\": globalType,\n        \"layout_identifier\": layoutIdentifier,\n        \"layout_data_key\": layoutDataKey,\n        // TODO: Hopefully we won't get any problems with too-long query strings (2048 is the maximum for IE):\n        \"default_config\": defaultConfigJSON\n    };\n    getSidebarIframe().src = window.XthemeEditorConfig.editUrl + \"?\" + stringify(urlParams);\n    setTimeout(() => {\n        setPopup(true);\n    }, 1); // Defer slide-out, because otherwise browsers coalesce the addClass (as it's done in the same JS \"tick\")\n}\n\nfunction addSnippetInjectionMarkup() {\n    const nav = document.querySelector(\".navbar-admin-tools .navbar-nav\");\n    if (!nav) return;  // No navigation no snippet in navigation either\n    if (!document.querySelector(\".xt-ph\")) {\n        // No placeholders in the DOM, so no need to show Inject button here.\n        return;\n    }\n    const button = el(\"button\", {\n        \"type\": \"button\"\n    }, gettext(\"Custom CSS/JS\"));\n    button.addEventListener(\"click\", () => {\n        window.open(window.XthemeEditorConfig.injectSnipperUrl, \"_blank\");\n    });\n    const li = el(\"li.xt-snippet-injection\", [button]);\n    nav.insertBefore(li, nav.firstChild);\n}\n\nfunction addEditToggleMarkup() {\n    const hidden = (name, value) => el(\"input\", { type: \"hidden\", name, value });\n    const editing = (window.XthemeEditorConfig.edit);\n    if (!document.querySelector(\".xt-ph\")) {\n        // No placeholders in the DOM, so no need to show an Edit button here.\n        return;\n    }\n    const li = el(\"li.xt-edit-toggle\", [\n        el(\"form\", {\n            \"action\": window.XthemeEditorConfig.commandUrl,\n            \"method\": \"POST\"\n        }, [\n                hidden(\"csrfmiddlewaretoken\", window.XthemeEditorConfig.csrfToken),\n                hidden(\"path\", location.href),\n                hidden(\"command\", (editing ? \"edit_off\" : \"edit_on\")),\n                el(\"button\", {\n                    \"type\": \"submit\"\n                }, (editing ? gettext(\"Exit Edit\") : gettext(\"Edit Page\")))\n            ])\n    ]);\n    let nav = document.querySelector(\".navbar-admin-tools .navbar-nav\");\n    if (!nav) return;  // No navigation no edit toggle in navigation either\n    nav.insertBefore(li, nav.firstChild);\n}\n\nfunction handleMessage(event) {\n    if (!window.XthemeEditorConfig.edit) {\n        return;  // Not editing, ignore messages\n    }\n    if (event.origin !== location.origin) {\n        return;  // Not our origin, can't be our message\n    }\n    const placeholder = event.data.reloadPlaceholder;\n    if (!placeholder) {\n        return; // Not our message\n    }\n    const oldPh = document.querySelector(\"#xt-ph-\" + placeholder);\n    if (!oldPh) {\n        return;   // Not sure where to put output anyway\n    }\n    ajax({\n        url: mutateURL(location.href, { \"_uncache_\": +new Date() }),\n        success: (text) => {\n            const newDoc = document.implementation.createHTMLDocument();\n            newDoc.body.innerHTML = text;\n            const newPh = newDoc.querySelector(\"#xt-ph-\" + placeholder);\n            if (newPh) {\n                oldPh.innerHTML = newPh.innerHTML;\n            }\n        }\n    });\n}\n\nfunction addPhClickHandler() {\n    document.addEventListener(\"click\", (event) => {\n        const classList = event.target.classList;\n        if (classList && classList.contains(\"xt-ph\")) {\n            openPlaceholderEditor(event.target);\n            event.preventDefault();\n            event.stopPropagation();\n            return false;\n        }\n    }, false);\n}\n\nfunction addCloseHandler() {\n    document.addEventListener(\"keyup\", (event) => {\n        if (event.key === \"Escape\") {\n            setPopup(false);\n        }\n    }, false);\n}\n\ndomready(() => {\n    window.addEventListener(\"message\", handleMessage, false);\n    addSnippetInjectionMarkup();\n    addEditToggleMarkup();\n    if (window.XthemeEditorConfig.edit) {\n        addPhClickHandler();\n        addCloseHandler();\n    }\n});\n\n\nwindow.togglePopup = function(visible) {\n    setPopup(visible);\n};\n","/**\n * This file is part of Shuup.\n *\n * Copyright (c) 2012-2021, Shuup Commerce Inc. All rights reserved.\n *\n * This source code is licensed under the OSL-3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\nexport function stringify(obj) {\n    const bits = [];\n    for (var key in obj) {\n        if (obj.hasOwnProperty(key) && obj[key]) {\n            bits.push(encodeURIComponent(key) + \"=\" + encodeURIComponent(obj[key]));\n        }\n    }\n    return bits.sort().join(\"&\");\n}\n\nexport function parse(queryString) {\n    const kw = {};\n    if (queryString === null || queryString === undefined) {\n        queryString = location.search.replace(/^\\?/, \"\");\n    }\n    queryString.split(\"&\").forEach((bit) => {\n        const [key, val] = bit.split(\"=\", 2);\n        kw[key] = (val !== undefined ? val : true);\n    });\n    return kw;\n}\n\nexport function mutateObj(obj, mutations) {\n    for (var key in mutations) {\n        if (!mutations.hasOwnProperty(key)) {\n            continue;\n        }\n        const val = mutations[key];\n        if (val === null || val === undefined) {\n            delete obj[key];\n        } else {\n            obj[key] = val;\n        }\n    }\n    return obj;\n}\n\nexport function mutate(mutations, queryString) {\n    const kw = parse(queryString);\n    mutateObj(kw, mutations);\n    return stringify(kw);\n}\n\nexport function mutateURL(url, mutations) {\n    var [base, search] = url.split(\"?\", 2);\n    search = mutate(mutations, search || \"\");\n    return base + (search.length ? \"?\" + search : \"\");\n}\n","/**\n * This file is part of Shuup.\n *\n * Copyright (c) 2012-2021, Shuup Commerce Inc. All rights reserved.\n *\n * This source code is licensed under the OSL-3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nfunction processAttrs(element, attrs) {\n    for (var key in attrs) {\n        if (!attrs.hasOwnProperty(key)) {\n            continue;\n        }\n        if (key === \"$events\") {\n            const eventHash = attrs[key];\n            for (var eventName in eventHash) {\n                if (!eventHash.hasOwnProperty(eventName)) {\n                    continue;\n                }\n                element.addEventListener(eventName, eventHash[eventName], false);\n            }\n            continue;\n        }\n        element[key] = attrs[key];\n    }\n}\n\nfunction processChildren(element, children) {\n    if (children && !Array.isArray(children)) {\n        children = [children];\n    }\n    (children || []).forEach((child) => {\n        if (!child) {\n            return;\n        }\n        if (typeof child === \"string\") {\n            child = document.createTextNode(child);\n        }\n        element.appendChild(child);\n    });\n}\n\n/**\n * Generate a HTML element.\n * For instance, el(\"div.foo\", {id: \"y\"}, [\"Hello\", \"Hello\"]) would generate\n * a div with the outerHTML `<div id=\"y\" class=\"foo\">HelloHello</div>`.\n *\n * @param selector Tag + CSS classes, separated with full-stops.\n * @param attrs Optional hash of attributes to assign on the new element.\n * @param children Optional array of children for the node.\n * @returns {HTMLElement}\n */\nexport default function el(selector, attrs, children) {\n    const [tag, ...classes] = selector.split(\".\");\n    const element = document.createElement(tag);\n    classes.forEach((cls) => {\n        element.classList.add(cls);\n    });\n    if (Array.isArray(attrs)) {\n        children = attrs;\n        attrs = {};\n    }\n    processAttrs(element, attrs);\n    processChildren(element, children);\n    return element;\n}\n","/**\n * This file is part of Shuup.\n *\n * Copyright (c) 2012-2021, Shuup Commerce Inc. All rights reserved.\n *\n * This source code is licensed under the OSL-3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n/**\n * BASED ON:\n * xhr-ajax.js Copyright (C) 2013 Craig Roberts (http://craig0990.co.uk)\n *\n * Licensed under the MIT License (http://mit-license.org)\n */\n\nexport default function ajax(options) {\n    const noop = function() {};\n    const client = new XMLHttpRequest();\n    options.success = options.success || noop;\n    options.error = options.error || noop;\n    options.async = true;\n    client.open(options.method || \"GET\", options.url);\n    client.send(options.data);\n    client.onreadystatechange = function() {\n        if (this.readyState !== 4) {\n            return;\n        }\n        if (this.status === 200) {\n            options.success(this.responseText, this);\n        } else {\n            options.error(this.status, this.statusText, this);\n        }\n        client.onreadystatechange = noop;\n    };\n    return client;\n}\n"],"names":["fn","loaded","setTimeout","callbacks","push","events","document","readyState","listener","forEach","ev","removeEventListener","shift","addEventListener","$deefb30f190f0dce$var$_domready","$deefb30f190f0dce$var$_interopRequireDefault","parcelRequire","stringify","obj","bits","key","hasOwnProperty","encodeURIComponent","sort","join","parse","queryString","kw","location","search","replace","split","bit","_bit$split2","$880d7fc53e77175d$var$_slicedToArray","val","undefined","mutateObj","mutations","mutate","url","_url$split2","base","length","selector","attrs","children","_selector$split2","tag","classes","slice","element","createElement","cls","classList","add","Array","isArray","eventHash","eventName","processAttrs","child","createTextNode","appendChild","processChildren","$deefb30f190f0dce$var$_el","options","noop","client","XMLHttpRequest","success","error","async","open","method","send","data","onreadystatechange","this","status","responseText","statusText","$deefb30f190f0dce$var$_ajax","_sidebarDiv","_sidebarIframe","getSidebarDiv","default","id","body","setPopup","visible","sidebarDiv","toggle","openPlaceholderEditor","domElement","layoutIdentifier","dataset","xtLayoutIdentifier","layoutDataKey","xtLayoutDataKey","placeholderName","xtPlaceholderName","globalType","xtGlobalType","xtContentTypeId","defaultConfigElement","querySelector","defaultConfigJSON","innerHTML","urlParams","view","window","XthemeEditorConfig","viewName","theme","themeIdentifier","ph","src","editUrl","$880d7fc53e77175d$exports","handleMessage","event","edit","origin","placeholder","reloadPlaceholder","oldPh","mutateURL","href","Date","text","newDoc","implementation","createHTMLDocument","newPh","nav","button","gettext","injectSnipperUrl","li","insertBefore","firstChild","addSnippetInjectionMarkup","hidden","name","value","type","editing","commandUrl","csrfToken","addEditToggleMarkup","target","contains","preventDefault","stopPropagation","togglePopup"],"version":3,"file":"editor-injection.js.map"}
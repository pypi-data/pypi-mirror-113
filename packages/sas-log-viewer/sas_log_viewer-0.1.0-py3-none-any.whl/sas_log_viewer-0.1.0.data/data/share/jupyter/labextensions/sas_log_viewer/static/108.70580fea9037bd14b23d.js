(self.webpackChunksas_log_viewer=self.webpackChunksas_log_viewer||[]).push([[108],{108:(e,t,s)=>{"use strict";s.r(t),s.d(t,{ISASLogExtension:()=>A,default:()=>L,saslogExtension:()=>T});var o=s(841),n=s(967),l=s(228),a=s(50),i=s(850),r=s(797),d=s(129),c=s(562),h=s(271),g=s(950),u=s(510),m=s(437),p=s.n(m);const _="%showLog",v="execute_request",S="status",w="idle";class x extends n.VDomModel{constructor(e){super(),this.requestStarted="",this.logRequestStarted="",this.logStreamObj={},this._log=[],this._kernel=null,this._messages={},this._childLUT={},this._roots=[],this.kernel=null!=e?e:null}clear(){this._log.splice(0,this._log.length),this._messages={},this._childLUT={},this._roots=[],this.logStreamObj={},this.stateChanged.emit(void 0)}get kernel(){return this._kernel}set kernel(e){this._kernel&&this._kernel.anyMessage.disconnect(this.onMessage,this),this._kernel=e,this._kernel&&this._kernel.anyMessage.connect(this.onMessage,this)}get log(){return this._log}get tree(){return this._roots.map((e=>this.getThread(e,!1)))}depth(e){if(null===e)return-1;let t=0;for(;e=this._findParent(e);)++t;return t}getThread(e,t=!0){const s=this._messages[e];if(t){let e,t=s;for(;e=this._findParent(t);)t=e;return this.getThread(t.msg.header.msg_id,!1)}const o=(this._childLUT[e]||[]).map((e=>this.getThread(e,!1)));return{args:this._messages[e],children:o}}onMessage(e,t){var s,o,n,l,a;const{msg:i}=t;console.log(`%c ${i.header.msg_type}`,"color: purple; font-weight: bold; font-size: 14px;"),console.log(i.content),this._log.push(t),this._messages[i.header.msg_id]=t;const r=this._findParent(t);if(null===r)this._roots.push(i.header.msg_id);else{const e=r.msg.header;this._childLUT[e.msg_id]=this._childLUT[e.msg_id]||[],this._childLUT[e.msg_id].push(i.header.msg_id)}if(i.header.msg_type!==v||i.content.code===_||this.requestStarted||(this.requestStarted=i.header.msg_id),this.requestStarted&&(null===(s=i.parent_header)||void 0===s?void 0:s.msg_id)===this.requestStarted&&i.content.execution_state===w&&i.header.msg_type===S&&(console.log("%c --------- showLog start -------","color: red; font-weight: bold;"),null===(o=this.kernel)||void 0===o||o.requestExecute({code:_},!0)),i.header.msg_type===v&&(null===(n=i.content)||void 0===n?void 0:n.code)===_){this.requestStarted="";let e=i.header.msg_id;this.logRequestStarted=e,this.logStreamObj[e]=[]}if(this.logRequestStarted&&"stream"===i.header.msg_type){let e=null===(l=i.parent_header)||void 0===l?void 0:l.msg_id;this.logStreamObj[e].push(i.content.text)}this.logRequestStarted&&(null===(a=i.parent_header)||void 0===a?void 0:a.msg_id)===this.logRequestStarted&&i.content.execution_state===w&&i.header.msg_type===S&&this.logRequestStarted&&(console.log("%c --------- showLog end -------","color: red; font-weight: bold;"),this.logRequestStarted=""),this.stateChanged.emit(void 0)}_findParent(e){return void 0!==e.msg.parent_header.msg_id&&this._messages[e.msg.parent_header.msg_id]||null}}const b=new g.LabIcon({name:"custom-ui-components:sasLog",svgstr:'<?xml version="1.0" encoding="utf-8"?>\n\x3c!-- Generator: Adobe Illustrator 24.0.1, SVG Export Plug-In . SVG Version: 6.00 Build 0)  --\x3e\n<svg version="1.1" id="Log" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n\t viewBox="0 0 16 16" style="enable-background:new 0 0 16 16;" xml:space="preserve">\n<style type="text/css">\n\t.st0{fill:none;}\n\t.st1{fill:#5D5D5D;}\n</style>\n<rect id="svgToolTipPane" y="1" class="st0" width="14" height="14"/>\n<path id="iconColor" class="st1" d="M13,1H3C2.5,1,2,1.5,2,2v12c0,0.6,0.5,1,1,1h10c0.6,0,1-0.4,1-1V2C14,1.5,13.6,1,13,1z M13,14H3\n\tV3h10V14z M12,8H4V7h8V8z M12,5H4v1h8V5z M12,9H4v1h8V9z M12,11H4v1h8V11z"/>\n</svg>\n'}),k=new(p());class y extends n.VDomRenderer{constructor(e){super(e),this.collapsedKeys={},this.id=`saslog-messagelog-${r.UUID.uuid4()}`,this.addClass("jp-saslog-messagelog")}render(){const e=this.model.logStreamObj;return h.createElement("div",null,Object.keys(e).map((t=>{const s=this.collapsedKeys[t],o=s?g.caretRightIcon:g.caretDownIcon;return h.createElement("div",{key:t,className:"collapsible "+(s?"collapsed":"")},h.createElement("div",{className:"log-header"},h.createElement("button",{className:"collapser",onClick:()=>{this.collapsedKeys[t]=!this.collapsedKeys[t],this.update()}},h.createElement(o.react,{className:"kspy-collapser-icon"})),h.createElement("div",{className:"log-id"},t)),h.createElement("div",{className:"log-container"},e[t].map(((e,s)=>h.createElement("div",{key:`${t}-${s}`},h.createElement("div",{dangerouslySetInnerHTML:{__html:k.toHtml(e)}}))))))})))}collapseAll(){for(const e in this.model.logStreamObj)this.collapsedKeys[e]=!0;this.update()}expandAll(){this.collapsedKeys={},this.update()}}class C extends u.Widget{constructor(e){super(),this._model=new x(e),this.addClass("jp-saslog-view"),this.id=`saslog-${r.UUID.uuid4()}`,this.title.label="SAS Log",this.title.closable=!0,this.title.icon=b;const t=this.layout=new u.BoxLayout;this._toolbar=new n.Toolbar,this._toolbar.addClass("jp-saslog-toolbar"),this._messagelog=new y(this._model),t.addWidget(this._toolbar),t.addWidget(this._messagelog),u.BoxLayout.setStretch(this._toolbar,0),u.BoxLayout.setStretch(this._messagelog,1),this.collapseAllButton=new n.ToolbarButton({onClick:()=>{this._messagelog.collapseAll()},className:"jp-saslog-collapseAll",icon:g.caretRightIcon,tooltip:"Collapse all threads"}),this._toolbar.addItem("collapse-all",this.collapseAllButton),this.expandAllButton=new n.ToolbarButton({onClick:()=>{this._messagelog.expandAll()},className:"jp-saslog-expandAll",icon:g.caretDownIcon,tooltip:"Expand all threads"}),this._toolbar.addItem("expand-all",this.expandAllButton),this.clearAllButton=new n.ToolbarButton({onClick:()=>{this._model.clear()},className:"jp-saslog-clearAll",icon:g.closeIcon,tooltip:"Clear all threads"}),this._toolbar.addItem("clear-all",this.clearAllButton)}onActivateRequest(e){this.node.contains(document.activeElement)||this.collapseAllButton.node.focus()}get model(){return this._model}}var f;!function(e){e.newSASlog="saslog:new"}(f||(f={}));const A=new r.Token("jupyter.extensions.saslog"),I=new c.AttachedProperty({create:()=>"",name:"SASLogTarget"});class T{constructor(e){this.commands=e}createNew(e,t){const s=[];let o=-1;(0,i.find)(e.toolbar.children(),((e,t)=>!!e.hasClass("jp-Notebook-toolbarCellType")&&(o=t,!0)));let l=1;for(const t of[f.newSASlog]){const a=new n.CommandToolbarButton({id:t,commands:this.commands});a.addClass("jp-saslog-nbtoolbarbutton"),o>=0?e.toolbar.insertItem(o+l++,this.commands.label(t),a):e.toolbar.insertAfter("cellType",this.commands.label(t),a),s.push(a)}return new d.DisposableDelegate((()=>{for(const e of s)e.dispose()}))}}const L={id:"sas-log-viewer:plugin",autoStart:!0,requires:[a.INotebookTracker],optional:[n.ICommandPalette,l.IMainMenu,o.ILayoutRestorer],provides:A,activate:async(e,t,s,o,l)=>{console.log("SAS log_viewer extension is activated!");const{commands:a,docRegistry:i}=e,r=new T(a);i.addWidgetExtension("Notebook",r);const d=new n.WidgetTracker({namespace:"saslog"});function c(){a.notifyCommandChanged(f.newSASlog)}l&&l.restore(d,{command:f.newSASlog,args:e=>({path:I.get(e.content),activate:!1}),name:e=>I.get(e.content),when:t.restored}),function(e,t,s,o,l){const{commands:a,shell:i}=e;a.addCommand(f.newSASlog,{label:"Show SAS Log",caption:"Show the SAS log for the associated notebook",iconClass:"jp-Icon jp-Icon-16 jp-saslogIcon",isEnabled:function(){var e,s,o;return null!==t.currentWidget&&null!==(null!==(o=null===(s=null===(e=t.currentWidget.context.sessionContext)||void 0===e?void 0:e.session)||void 0===s?void 0:s.kernel)&&void 0!==o?o:null)&&"sas"==t.currentWidget.sessionContext.prevKernelName},execute:e=>{var o,l,a;let r;if(r=e.path?null!==(o=t.find((t=>t.context.path===e.path)))&&void 0!==o?o:null:t.currentWidget,!r)return;const d=new C(null===(a=null===(l=r.context.sessionContext)||void 0===l?void 0:l.session)||void 0===a?void 0:a.kernel);d.title.label=`SAS Log: ${r.title.label}`,r.title.changed.connect((()=>{d.title.label=`SAS Log: ${r.title.label}`}));const c=new n.MainAreaWidget({content:d});I.set(d,r.context.path),r.context.pathChanged.connect(((e,t)=>{I.set(d,t),s.save(c)})),s.add(c),r.context.sessionContext.kernelChanged.connect(((e,t)=>{d.model.kernel=t.newValue})),i.add(c,"main",{mode:"split-right"}),!1!==e.activate&&i.activateById(c.id),r.disposed.connect((()=>{c.close()}))}}),null==o||o.addItem({command:f.newSASlog,category:"Kernel"}),null==l||l.kernelMenu.addGroup([{command:f.newSASlog}])}(e,t,d,s,o),t.currentChanged.connect(c);let h=t.currentWidget;return h&&h.context.sessionContext.kernelChanged.connect(c),t.currentChanged.connect((e=>{h&&h.context.sessionContext.kernelChanged.disconnect(c),h=e.currentWidget,h&&h.context.sessionContext.kernelChanged.connect(c)})),r}}}}]);
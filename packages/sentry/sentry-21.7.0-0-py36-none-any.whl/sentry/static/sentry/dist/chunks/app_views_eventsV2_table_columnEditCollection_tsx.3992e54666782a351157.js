(self.webpackChunk=self.webpackChunk||[]).push([["app_views_eventsV2_table_columnEditCollection_tsx"],{"./app/utils/userselect.tsx":function(e,t,n){"use strict";n.d(t,{l:function(){return o}});var o=function(e){var t={userSelect:document.body.style.userSelect,MozUserSelect:document.body.style.MozUserSelect,msUserSelect:document.body.style.msUserSelect,webkitUserSelect:document.body.style.webkitUserSelect};return document.body.style.userSelect=e.userSelect||"",document.body.style.MozUserSelect=e.MozUserSelect||"",document.body.style.msUserSelect=e.msUserSelect||"",document.body.style.webkitUserSelect=e.webkitUserSelect||"",t}},"./app/views/eventsV2/table/columnEditCollection.tsx":function(e,t,n){"use strict";n.d(t,{Z:function(){return B}}),n("../node_modules/core-js/modules/es.reflect.construct.js");var o=n("../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),r=n("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),s=n("../node_modules/@babel/runtime/helpers/esm/createClass.js"),i=n("../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js"),a=n("../node_modules/@babel/runtime/helpers/esm/inherits.js"),l=n("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),d=n("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),u=n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),c=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),m=(n("../node_modules/core-js/modules/es.array.concat.js"),n("../node_modules/core-js/modules/es.array.splice.js"),n("../node_modules/core-js/modules/es.array.includes.js"),n("../node_modules/core-js/modules/es.array.find-index.js"),n("../node_modules/core-js/modules/es.array.from.js"),n("../node_modules/core-js/modules/es.string.iterator.js"),n("../node_modules/core-js/modules/es.array.join.js"),n("../node_modules/core-js/modules/es.array.find.js"),n("../node_modules/core-js/modules/es.number.constructor.js"),n("../node_modules/core-js/modules/es.array.map.js"),n("../node_modules/react/index.js")),g=n("../node_modules/react-dom/index.js"),p=n("./app/components/acl/feature.tsx"),h=n("./app/components/button.tsx"),v=n("./app/components/charts/styles.tsx"),f=n("./app/components/featureBadge.tsx"),b=n("./app/icons/index.tsx"),y=n("./app/locale.tsx"),Z=n("./app/styles/space.tsx"),x=n("./app/utils/analytics.tsx"),C=n("./app/utils/discover/fields.tsx"),j=n("./app/utils/theme.tsx");function w(e,t){var n="nativeEvent"in e?e.nativeEvent:e;return window.TouchEvent&&n instanceof TouchEvent?n.targetTouches[0][t]:n instanceof MouseEvent?n[t]:0}var S=n("./app/utils/userselect.tsx"),k=n("./app/views/eventsV2/table/queryField.tsx"),_=n("./app/views/eventsV2/table/types.tsx"),D=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");var E,T="draggable-item";!function(e){e[e.TOP=0]="TOP",e[e.BOTTOM=1]="BOTTOM"}(E||(E={}));var U=function(e){(0,a.Z)(v,e);var t,n,c=(t=v,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,o=(0,d.Z)(t);if(n){var r=(0,d.Z)(this).constructor;e=Reflect.construct(o,arguments,r)}else e=o.apply(this,arguments);return(0,l.Z)(this,e)});function v(){var e;(0,r.Z)(this,v);for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];return e=c.call.apply(c,[this].concat(n)),(0,u.Z)((0,i.Z)(e),"state",{isDragging:!1,draggingIndex:void 0,draggingTargetIndex:void 0,draggingGrabbedOffset:void 0,left:void 0,top:void 0}),(0,u.Z)((0,i.Z)(e),"previousUserSelect",null),(0,u.Z)((0,i.Z)(e),"portal",null),(0,u.Z)((0,i.Z)(e),"dragGhostRef",m.createRef()),(0,u.Z)((0,i.Z)(e),"handleAddColumn",(function(){e.props.onChange([].concat((0,o.Z)(e.props.columns),[{kind:"field",field:""}]))})),(0,u.Z)((0,i.Z)(e),"handleAddEquation",(function(){var t=e.props.organization,n={kind:_.L.EQUATION,field:""};(0,x.ec)({eventKey:"discover_v2.add_equation",eventName:"Discoverv2: Equation added",organization_id:parseInt(t.id,10)}),e.props.onChange([].concat((0,o.Z)(e.props.columns),[n]))})),(0,u.Z)((0,i.Z)(e),"handleUpdateColumn",(function(t,n){var r=(0,o.Z)(e.props.columns);r.splice(t,1,n),e.props.onChange(r)})),(0,u.Z)((0,i.Z)(e),"onDragMove",(function(t){var n,o,r=e.state,s=r.isDragging,i=r.draggingTargetIndex,a=r.draggingGrabbedOffset;if(s&&["mousemove","touchmove"].includes(t.type)){t.preventDefault(),t.stopPropagation();var l=w(t,"pageX"),d=w(t,"pageY"),u=null!==(n=null==a?void 0:a.x)&&void 0!==n?n:0,c=null!==(o=null==a?void 0:a.y)&&void 0!==o?o:0;if(e.dragGhostRef.current){var m=e.dragGhostRef.current;m.style.left="".concat(l-u,"px"),m.style.top="".concat(d-c,"px")}var g=document.querySelectorAll(".".concat(T)),p=Array.from(g).findIndex((function(e){var t=e.getBoundingClientRect(),n=d,o=window.scrollY+t.top,r=window.scrollY+t.top+t.height;return n>=o&&n<=r}));p>=0&&p!==i&&e.setState({draggingTargetIndex:p})}})),(0,u.Z)((0,i.Z)(e),"onDragEnd",(function(t){if(e.state.isDragging&&["mouseup","touchend"].includes(t.type)){var n=e.state.draggingIndex,r=e.state.draggingTargetIndex;if("number"==typeof n&&"number"==typeof r){e.cleanUpListeners(),e.previousUserSelect&&((0,S.l)(e.previousUserSelect),e.previousUserSelect=null);var s=(0,o.Z)(e.props.columns),i=s.splice(n,1);s.splice(r,0,i[0]),e.props.onChange(s),e.setState({isDragging:!1,left:void 0,top:void 0,draggingIndex:void 0,draggingTargetIndex:void 0,draggingGrabbedOffset:void 0})}}})),e}return(0,s.Z)(v,[{key:"componentDidMount",value:function(){if(!this.portal){var e=document.createElement("div");e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.zIndex=String(j.ZP.zIndex.modal),this.portal=e,document.body.appendChild(this.portal)}}},{key:"componentWillUnmount",value:function(){this.portal&&document.body.removeChild(this.portal),this.cleanUpListeners()}},{key:"keyForColumn",value:function(e,t){return"function"===e.kind?[].concat((0,o.Z)(e.function),[t]).join(":"):[].concat((0,o.Z)(e.field),[t]).join(":")}},{key:"cleanUpListeners",value:function(){this.state.isDragging&&(window.removeEventListener("mousemove",this.onDragMove),window.removeEventListener("touchmove",this.onDragMove),window.removeEventListener("mouseup",this.onDragEnd),window.removeEventListener("touchend",this.onDragEnd))}},{key:"removeColumn",value:function(e){var t=(0,o.Z)(this.props.columns);t.splice(e,1),this.props.onChange(t)}},{key:"startDrag",value:function(e,t){if(!this.state.isDragging&&["mousedown","touchstart"].includes(e.type)){e.preventDefault(),e.stopPropagation();var n=w(e,"pageY"),o=w(e,"pageX"),r=Array.from(document.querySelectorAll(".".concat(T))).find((function(t){return t.contains(e.currentTarget)})).getBoundingClientRect(),s={x:o-r.x+4,y:n-r.y+4};this.previousUserSelect=(0,S.l)({userSelect:"none",MozUserSelect:"none",msUserSelect:"none",webkitUserSelect:"none"}),window.addEventListener("mousemove",this.onDragMove),window.addEventListener("touchmove",this.onDragMove),window.addEventListener("mouseup",this.onDragEnd),window.addEventListener("touchend",this.onDragEnd),this.setState({isDragging:!0,draggingIndex:t,draggingTargetIndex:t,draggingGrabbedOffset:s,top:n,left:o})}}},{key:"renderGhost",value:function(e){var t,n,o=this.state,r=o.isDragging,s=o.draggingIndex,i=o.draggingGrabbedOffset,a=s;if("number"!=typeof a||!r||!this.portal)return null;var l=null!==(t=null==i?void 0:i.x)&&void 0!==t?t:0,d=null!==(n=null==i?void 0:i.y)&&void 0!==n?n:0,u=Number(this.state.top)-d,c=Number(this.state.left)-l,m=this.props.columns[a],p={top:"".concat(u,"px"),left:"".concat(c,"px")},h=(0,D.tZ)(z,{ref:this.dragGhostRef,style:p,children:this.renderItem(m,a,{isGhost:!0,gridColumns:e})});return g.createPortal(h,this.portal)}},{key:"renderItem",value:function(e,t,n){var o=this,r=n.canDelete,s=void 0===r||r,i=n.isGhost,a=void 0!==i&&i,l=n.gridColumns,d=void 0===l?2:l,u=this.props,c=u.columns,g=u.fieldOptions,p=this.state,v=p.isDragging,f=p.draggingTargetIndex,Z=p.draggingIndex,x=null;if(v&&!1===a&&f===t&&(x=(0,D.tZ)(M,{className:T},"placeholder:".concat(this.keyForColumn(e,a)))),v&&!1===a&&Z===t)return x;var C=Number(f)<=Number(Z)?E.TOP:E.BOTTOM;return(0,D.BX)(m.Fragment,{children:[C===E.TOP&&x,(0,D.BX)(I,{className:a?"":T,children:[s?(0,D.tZ)(h.ZP,{"aria-label":(0,y.t)("Drag to reorder"),onMouseDown:function(e){return o.startDrag(e,t)},onTouchStart:function(e){return o.startDrag(e,t)},icon:(0,D.tZ)(b.LS,{size:"xs"}),size:"zero",borderless:!0}):(0,D.tZ)("span",{}),(0,D.tZ)(k.q,{fieldOptions:g,gridColumns:d,fieldValue:e,onChange:function(e){return o.handleUpdateColumn(t,e)},takeFocus:t===this.props.columns.length-1,otherColumns:c}),s?(0,D.tZ)(h.ZP,{"aria-label":(0,y.t)("Remove column"),onClick:function(){return o.removeColumn(t)},icon:(0,D.tZ)(b.Fz,{}),borderless:!0}):(0,D.tZ)("span",{})]}),C===E.BOTTOM&&x]},"".concat(t,":").concat(this.keyForColumn(e,a)))}},{key:"render",value:function(){var e=this,t=this.props,n=t.className,r=t.columns,s=t.organization,i=r.length>1,a=r.length<20,l=a?void 0:"Sorry, you reached the maximum number of columns. Delete columns to add more.",d=Math.max.apply(Math,(0,o.Z)(r.map((function(e){return"function"===e.kind&&2===C.lx[e.function[0]].parameters.length?3:2}))));return(0,D.BX)("div",{className:n,children:[this.renderGhost(d),(0,D.tZ)(I,{children:(0,D.BX)(R,{gridColumns:d,children:[(0,D.tZ)(A,{children:(0,y.t)("Tag / Field / Function")}),(0,D.tZ)(A,{children:(0,y.t)("Field Parameter")})]})}),r.map((function(t,n){return e.renderItem(t,n,{canDelete:i,gridColumns:d})})),(0,D.tZ)(I,{children:(0,D.BX)(P,{children:[(0,D.tZ)(h.ZP,{size:"small",label:(0,y.t)("Add a Column"),onClick:this.handleAddColumn,title:l,disabled:!a,icon:(0,D.tZ)(b.N_,{isCircled:!0,size:"xs"}),children:(0,y.t)("Add a Column")}),(0,D.tZ)(p.Z,{organization:s,features:["discover-arithmetic"],children:(0,D.BX)(h.ZP,{size:"small",label:(0,y.t)("Add an Equation"),onClick:this.handleAddEquation,title:l,disabled:!a,icon:(0,D.tZ)(b.N_,{isCircled:!0,size:"xs"}),children:[(0,y.t)("Add an Equation"),(0,D.tZ)(O,{type:"beta"})]})})]})})]})}}]),v}(m.Component);U.displayName="ColumnEditCollection";var O=(0,c.Z)(f.Z,{target:"ev0fm796"})("margin:-",(0,Z.Z)(.5)," auto;margin-left:",(0,Z.Z)(1),";"),I=(0,c.Z)("div",{target:"ev0fm795"})("display:grid;grid-template-columns:",(0,Z.Z)(3)," 1fr ",(0,Z.Z)(3),";justify-content:center;align-items:center;width:100%;touch-action:none;padding-bottom:",(0,Z.Z)(1),";"),z=(0,c.Z)("div",{target:"ev0fm794"})("background:",(function(e){return e.theme.background}),";display:block;position:absolute;padding:",4,"px;border-radius:",(function(e){return e.theme.borderRadius}),";box-shadow:0 0 15px rgba(0, 0, 0, 0.15);width:710px;opacity:0.8;cursor:grabbing;padding-right:",(0,Z.Z)(2),";&>",I,"{padding-bottom:0;}& svg{cursor:grabbing;}"),M=(0,c.Z)("div",{target:"ev0fm793"})("margin:0 ",(0,Z.Z)(3)," ",(0,Z.Z)(1)," ",(0,Z.Z)(3),";border:2px dashed ",(function(e){return e.theme.border}),";border-radius:",(function(e){return e.theme.borderRadius}),";height:41px;"),P=(0,c.Z)("div",{target:"ev0fm792"})("grid-column:2/3;& button{margin-right:",(0,Z.Z)(1),";}"),R=(0,c.Z)("div",{target:"ev0fm791"})("grid-column:2/3;display:grid;grid-template-columns:repeat(",(function(e){return e.gridColumns}),", 1fr);grid-column-gap:",(0,Z.Z)(1),";"),A=(0,c.Z)(v.OT,{target:"ev0fm790"})({name:"ti75j2",styles:"margin:0"}),B=U}}]);
//# sourceMappingURL=../sourcemaps/app_views_eventsV2_table_columnEditCollection_tsx.673af2826f9498cfc529932a0f9c8776.js.map
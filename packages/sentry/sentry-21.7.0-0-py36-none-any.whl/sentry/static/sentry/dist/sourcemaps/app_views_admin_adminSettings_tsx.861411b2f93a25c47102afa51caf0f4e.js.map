{"version":3,"sources":["webpack:///./app/views/admin/adminSettings.tsx","webpack:///./app/views/admin/options.tsx","webpack:///./app/views/asyncView.tsx","webpack:///../node_modules/lodash/keyBy.js"],"names":["optionsAvailable","AdminSettings","this","endpoint","data","state","initialData","fields","key","option","field","value","undefined","isUndefined","defn","getOption","defaultValue","getOptionField","t","apiMethod","apiEndpoint","omitDisabled","requireChanges","AsyncView","sections","heading","definitions","label","placeholder","help","document","location","protocol","host","component","EmailField","ConfigStore","email","BooleanField","RadioBooleanField","noLabel","yesLabel","yesFirst","tct","link","href","hostname","definitionsMap","keyBy","def","disabledReasons","diskPriority","smtpDisabled","getOptionDefault","meta","optionsForSection","section","filter","split","Field","TextField","name","required","allowEmpty","disabledReason","getSectionFieldSet","getForm","fieldMap","sets","set","push","length","title","getTitle","renderComponent","AsyncComponent","baseAssignValue","createAggregator","result","module","exports"],"mappings":"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","file":"chunks/app_views_admin_adminSettings_tsx.xxxxxxxxxxxxxxxxxxxx.js","sourcesContent":["import isUndefined from 'lodash/isUndefined';\n\nimport {ApiForm} from 'app/components/forms';\nimport {t} from 'app/locale';\nimport AsyncView from 'app/views/asyncView';\n\nimport {getOption, getOptionField} from './options';\n\nconst optionsAvailable = [\n  'system.url-prefix',\n  'system.admin-email',\n  'system.support-email',\n  'system.security-email',\n  'system.rate-limit',\n  'auth.allow-registration',\n  'auth.ip-rate-limit',\n  'auth.user-rate-limit',\n  'api.rate-limit.org-create',\n  'beacon.anonymous',\n];\n\ntype Field = ReturnType<typeof getOption>;\n\ntype FieldDef = {\n  field: Field;\n  value: string | undefined;\n};\n\ntype State = AsyncView['state'] & {\n  data: Record<string, FieldDef>;\n};\n\nexport default class AdminSettings extends AsyncView<{}, State> {\n  get endpoint() {\n    return '/internal/options/';\n  }\n\n  getEndpoints(): ReturnType<AsyncView['getEndpoints']> {\n    return [['data', this.endpoint]];\n  }\n\n  renderBody() {\n    const {data} = this.state;\n\n    const initialData = {};\n    const fields = {};\n    for (const key of optionsAvailable) {\n      // TODO(dcramer): we should not be mutating options\n      const option = data[key] ?? {field: {}, value: undefined};\n\n      if (isUndefined(option.value) || option.value === '') {\n        const defn = getOption(key);\n        initialData[key] = defn.defaultValue ? defn.defaultValue() : '';\n      } else {\n        initialData[key] = option.value;\n      }\n      fields[key] = getOptionField(key, option.field);\n    }\n\n    return (\n      <div>\n        <h3>{t('Settings')}</h3>\n\n        <ApiForm\n          apiMethod=\"PUT\"\n          apiEndpoint={this.endpoint}\n          initialData={initialData}\n          omitDisabled\n          requireChanges\n        >\n          <h4>General</h4>\n          {fields['system.url-prefix']}\n          {fields['system.admin-email']}\n          {fields['system.support-email']}\n          {fields['system.security-email']}\n          {fields['system.rate-limit']}\n\n          <h4>Security & Abuse</h4>\n          {fields['auth.allow-registration']}\n          {fields['auth.ip-rate-limit']}\n          {fields['auth.user-rate-limit']}\n          {fields['api.rate-limit.org-create']}\n\n          <h4>Beacon</h4>\n          {fields['beacon.anonymous']}\n        </ApiForm>\n      </div>\n    );\n  }\n}\n","import * as React from 'react';\nimport keyBy from 'lodash/keyBy';\n\nimport {\n  BooleanField,\n  EmailField,\n  RadioBooleanField,\n  TextField,\n} from 'app/components/forms';\nimport {t, tct} from 'app/locale';\nimport ConfigStore from 'app/stores/configStore';\n\ntype Section = {\n  key: string;\n  heading?: string;\n};\n\ntype Field = {\n  key: string;\n  label: React.ReactNode;\n  help?: React.ReactNode;\n  noLabel?: string;\n  yesLabel?: string;\n  yesFirst?: boolean;\n  placeholder?: string;\n  required?: boolean;\n  allowEmpty?: boolean;\n  disabledReason?: string;\n  defaultValue?: () => string | false;\n  component?: React.ComponentType<any>;\n};\n\n// This are ordered based on their display order visually\nconst sections: Section[] = [\n  {\n    key: 'system',\n  },\n  {\n    key: 'mail',\n    heading: t('Outbound email'),\n  },\n  {\n    key: 'auth',\n    heading: t('Authentication'),\n  },\n  {\n    key: 'beacon',\n    heading: t('Beacon'),\n  },\n];\n\n// This are ordered based on their display order visually\nconst definitions: Field[] = [\n  {\n    key: 'system.url-prefix',\n    label: t('Root URL'),\n    placeholder: 'https://sentry.example.com',\n    help: t('The root web address which is used to communicate with the Sentry backend.'),\n    defaultValue: () => `${document.location.protocol}//${document.location.host}`,\n  },\n  {\n    key: 'system.admin-email',\n    label: t('Admin Email'),\n    placeholder: 'admin@example.com',\n    help: t('The technical contact for this Sentry installation.'),\n    // TODO(dcramer): this should not be hardcoded to a component\n    component: EmailField,\n    defaultValue: () => ConfigStore.get('user').email,\n  },\n  {\n    key: 'system.support-email',\n    label: t('Support Email'),\n    placeholder: 'support@example.com',\n    help: t('The support contact for this Sentry installation.'),\n    // TODO(dcramer): this should not be hardcoded to a component\n    component: EmailField,\n    defaultValue: () => ConfigStore.get('user').email,\n  },\n  {\n    key: 'system.security-email',\n    label: t('Security Email'),\n    placeholder: 'security@example.com',\n    help: t('The security contact for this Sentry installation.'),\n    // TODO(dcramer): this should not be hardcoded to a component\n    component: EmailField,\n    defaultValue: () => ConfigStore.get('user').email,\n  },\n  {\n    key: 'system.rate-limit',\n    label: t('Rate Limit'),\n    placeholder: 'e.g. 500',\n    help: t(\n      'The maximum number of events the system should accept per minute. A value of 0 will disable the default rate limit.'\n    ),\n  },\n  {\n    key: 'auth.allow-registration',\n    label: t('Allow Registration'),\n    help: t('Allow anyone to create an account and access this Sentry installation.'),\n    component: BooleanField,\n    defaultValue: () => false,\n  },\n  {\n    key: 'auth.ip-rate-limit',\n    label: t('IP Rate Limit'),\n    placeholder: 'e.g. 10',\n    help: t(\n      'The maximum number of times an authentication attempt may be made by a single IP address in a 60 second window.'\n    ),\n  },\n  {\n    key: 'auth.user-rate-limit',\n    label: t('User Rate Limit'),\n    placeholder: 'e.g. 10',\n    help: t(\n      'The maximum number of times an authentication attempt may be made against a single account in a 60 second window.'\n    ),\n  },\n  {\n    key: 'api.rate-limit.org-create',\n    label: 'Organization Creation Rate Limit',\n    placeholder: 'e.g. 5',\n    help: t(\n      'The maximum number of organizations which may be created by a single account in a one hour window.'\n    ),\n  },\n  {\n    key: 'beacon.anonymous',\n    label: 'Usage Statistics',\n    component: RadioBooleanField,\n    // yes and no are inverted here due to the nature of this configuration\n    noLabel: 'Send my contact information along with usage statistics',\n    yesLabel: 'Please keep my usage information anonymous',\n    yesFirst: false,\n    help: tct(\n      'If enabled, any stats reported to sentry.io will exclude identifying information (such as your administrative email address). By anonymizing your installation the Sentry team will be unable to contact you about security updates. For more information on what data is sent to Sentry, see the [link:documentation].',\n      {\n        link: <a href=\"https://develop.sentry.dev/self-hosted/\" />,\n      }\n    ),\n  },\n  {\n    key: 'mail.from',\n    label: t('Email From'),\n    component: EmailField,\n    defaultValue: () => `sentry@${document.location.hostname}`,\n    help: t('Email address to be used in From for all outbound email.'),\n  },\n  {\n    key: 'mail.host',\n    label: t('SMTP Host'),\n    placeholder: 'localhost',\n    defaultValue: () => 'localhost',\n  },\n  {\n    key: 'mail.port',\n    label: t('SMTP Port'),\n    placeholder: '25',\n    defaultValue: () => '25',\n  },\n  {\n    key: 'mail.username',\n    label: t('SMTP Username'),\n    defaultValue: () => '',\n  },\n  {\n    key: 'mail.password',\n    label: t('SMTP Password'),\n    // TODO(mattrobenolt): We don't want to use a real password field unless\n    // there's a way to reveal it. Without being able to see the password, it's\n    // impossible to confirm if it's right.\n    // component: PasswordField,\n    defaultValue: () => '',\n  },\n  {\n    key: 'mail.use-tls',\n    label: t('Use STARTTLS? (exclusive with SSL)'),\n    component: BooleanField,\n    defaultValue: () => false,\n  },\n  {\n    key: 'mail.use-ssl',\n    label: t('Use SSL? (exclusive with STARTTLS)'),\n    component: BooleanField,\n    defaultValue: () => false,\n  },\n];\n\nconst definitionsMap = keyBy(definitions, def => def.key);\n\nconst disabledReasons = {\n  diskPriority:\n    'This setting is defined in config.yml and may not be changed via the web UI.',\n  smtpDisabled: 'SMTP mail has been disabled, so this option is unavailable',\n};\n\nexport function getOption(option: string) {\n  return definitionsMap[option];\n}\n\nexport function getOptionDefault(option: string) {\n  const meta = getOption(option);\n  return meta.defaultValue ? meta.defaultValue() : undefined;\n}\n\nfunction optionsForSection(section: Section) {\n  return definitions.filter(option => option.key.split('.')[0] === section.key);\n}\n\nexport function getOptionField(option: string, field: Field) {\n  const meta = {...getOption(option), ...field};\n  const Field = meta.component || TextField;\n  return (\n    <Field\n      {...meta}\n      name={option}\n      key={option}\n      defaultValue={getOptionDefault(option)}\n      required={meta.required && !meta.allowEmpty}\n      disabledReason={meta.disabledReason && disabledReasons[meta.disabledReason]}\n    />\n  );\n}\n\nfunction getSectionFieldSet(section: Section, fields: Field[]) {\n  return (\n    <fieldset key={section.key}>\n      {section.heading && <legend>{section.heading}</legend>}\n      {fields}\n    </fieldset>\n  );\n}\n\nexport function getForm(fieldMap: Record<string, Field>) {\n  const sets: React.ReactNode[] = [];\n\n  for (const section of sections) {\n    const set: Field[] = [];\n\n    for (const option of optionsForSection(section)) {\n      if (fieldMap[option.key]) {\n        set.push(fieldMap[option.key]);\n      }\n    }\n\n    if (set.length) {\n      sets.push(getSectionFieldSet(section, set));\n    }\n  }\n\n  return sets;\n}\n","import * as React from 'react';\nimport DocumentTitle from 'react-document-title';\n\nimport AsyncComponent from 'app/components/asyncComponent';\n\ntype AsyncViewState = AsyncComponent['state'];\ntype AsyncViewProps = AsyncComponent['props'];\n\nexport default class AsyncView<\n  P extends AsyncViewProps = AsyncViewProps,\n  S extends AsyncViewState = AsyncViewState\n> extends AsyncComponent<P, S> {\n  getTitle() {\n    return '';\n  }\n\n  render() {\n    const title = this.getTitle();\n    return (\n      <DocumentTitle title={`${title ? `${title} - ` : ''}Sentry`}>\n        {this.renderComponent() as React.ReactChild}\n      </DocumentTitle>\n    );\n  }\n}\n","var baseAssignValue = require('./_baseAssignValue'),\n    createAggregator = require('./_createAggregator');\n\n/**\n * Creates an object composed of keys generated from the results of running\n * each element of `collection` thru `iteratee`. The corresponding value of\n * each key is the last element responsible for generating the key. The\n * iteratee is invoked with one argument: (value).\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Collection\n * @param {Array|Object} collection The collection to iterate over.\n * @param {Function} [iteratee=_.identity] The iteratee to transform keys.\n * @returns {Object} Returns the composed aggregate object.\n * @example\n *\n * var array = [\n *   { 'dir': 'left', 'code': 97 },\n *   { 'dir': 'right', 'code': 100 }\n * ];\n *\n * _.keyBy(array, function(o) {\n *   return String.fromCharCode(o.code);\n * });\n * // => { 'a': { 'dir': 'left', 'code': 97 }, 'd': { 'dir': 'right', 'code': 100 } }\n *\n * _.keyBy(array, 'dir');\n * // => { 'left': { 'dir': 'left', 'code': 97 }, 'right': { 'dir': 'right', 'code': 100 } }\n */\nvar keyBy = createAggregator(function(result, value, key) {\n  baseAssignValue(result, key, value);\n});\n\nmodule.exports = keyBy;\n"],"sourceRoot":""}
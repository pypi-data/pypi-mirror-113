(self.webpackChunk=self.webpackChunk||[]).push([["app_components_charts_eventsRequest_tsx"],{"./app/actionCreators/events.tsx":function(e,r,t){"use strict";t.d(r,{lI:function(){return j},eV:function(){return h},JE:function(){return b}}),t("../node_modules/core-js/modules/es.object.keys.js"),t("../node_modules/core-js/modules/es.symbol.js"),t("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),t("../node_modules/core-js/modules/web.dom-collections.for-each.js"),t("../node_modules/core-js/modules/es.object.get-own-property-descriptors.js");var s=t("../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),o=t("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),n=t("../node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),a=t("../node_modules/@babel/runtime/regenerator/index.js"),i=t.n(a),u=(t("../node_modules/core-js/modules/es.array.iterator.js"),t("../node_modules/core-js/modules/es.object.from-entries.js"),t("../node_modules/core-js/modules/es.array.filter.js"),t("../node_modules/core-js/modules/es.object.entries.js"),t("../node_modules/core-js/modules/es.object.values.js"),t("../node_modules/lodash/pick.js")),l=t.n(u),c=t("./app/components/charts/utils.tsx"),d=t("./app/utils/getPeriod.tsx"),m=t("./app/utils/performance/constants.tsx");function p(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,s)}return t}function f(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?p(Object(t),!0).forEach((function(r){(0,o.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):p(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}var j=function(e,r){var t=r.organization,s=r.project,o=r.environment,a=r.team,i=r.period,u=r.start,l=r.end,m=r.interval,p=r.includePrevious,j=r.query,h=r.yAxis,v=r.field,b=r.topEvents,y=r.orderby,g=r.partial,P=(0,c.Sw)(p,i),_=Object.fromEntries(Object.entries({interval:m,project:s,environment:o,team:a,query:j,yAxis:h,field:v,topEvents:b,orderby:y,partial:g?"1":void 0}).filter((function(e){return void 0!==(0,n.Z)(e,2)[1]}))),D=(0,d.X)({period:i,start:u,end:l},{shouldDoublePeriod:P});return e.requestPromise("/organizations/".concat(t.slug,"/events-stats/"),{query:f(f({},_),D)})};function h(e,r,t){return v.apply(this,arguments)}function v(){return(v=(0,s.Z)(i().mark((function e(r,t,s){var o,n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=l()(s,Object.values(m.s)),n=f(f({},o),{},{query:s.query}),e.abrupt("return",r.requestPromise("/organizations/".concat(t,"/events-facets/"),{query:n}));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e,r,t){return y.apply(this,arguments)}function y(){return(y=(0,s.Z)(i().mark((function e(r,t,s){var o,n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=l()(s,Object.values(m.s)),n=f(f({},o),{},{query:s.query}),e.abrupt("return",r.requestPromise("/organizations/".concat(t,"/events-meta/"),{query:n}).then((function(e){return e.count})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},"./app/components/charts/eventsRequest.tsx":function(e,r,t){"use strict";t("../node_modules/core-js/modules/es.reflect.construct.js"),t("../node_modules/core-js/modules/es.symbol.js"),t("../node_modules/core-js/modules/es.array.filter.js"),t("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),t("../node_modules/core-js/modules/web.dom-collections.for-each.js"),t("../node_modules/core-js/modules/es.object.get-own-property-descriptors.js");var s=t("../node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),o=t("../node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js"),n=t("../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),a=t("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),i=t("../node_modules/@babel/runtime/helpers/esm/createClass.js"),u=t("../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js"),l=t("../node_modules/@babel/runtime/helpers/esm/inherits.js"),c=t("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),d=t("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),m=t("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),p=t("../node_modules/@babel/runtime/regenerator/index.js"),f=t.n(p),j=(t("../node_modules/core-js/modules/es.array.includes.js"),t("../node_modules/core-js/modules/es.array.concat.js"),t("../node_modules/core-js/modules/es.function.name.js"),t("../node_modules/core-js/modules/es.array.slice.js"),t("../node_modules/core-js/modules/es.array.map.js"),t("../node_modules/core-js/modules/es.array.sort.js"),t("../node_modules/core-js/modules/es.object.keys.js"),t("../node_modules/react/index.js")),h=t("../node_modules/lodash/isEqual.js"),v=t.n(h),b=t("../node_modules/lodash/omitBy.js"),y=t.n(b),g=t("./app/actionCreators/events.tsx"),P=t("./app/actionCreators/indicator.tsx"),_=t("./app/components/charts/loadingPanel.tsx"),D=t("./app/components/charts/utils.tsx"),O=t("./app/locale.tsx"),w=t("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js"),x=["api","confirmedQuery","expired","name","hideError"],Z=["children","showLoading"];function k(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,s)}return t}function T(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?k(Object(t),!0).forEach((function(r){(0,m.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):k(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}var q=["api","children","organization","loading"],S=function(e){return y()(e,(function(e,r){return q.includes(r)}))},E=function(e){(0,l.Z)(j,e);var r,t,p=(r=j,t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,s=(0,d.Z)(r);if(t){var o=(0,d.Z)(this).constructor;e=Reflect.construct(s,arguments,o)}else e=s.apply(this,arguments);return(0,c.Z)(this,e)});function j(){var e;(0,a.Z)(this,j);for(var r=arguments.length,t=new Array(r),s=0;s<r;s++)t[s]=arguments[s];return e=p.call.apply(p,[this].concat(t)),(0,m.Z)((0,u.Z)(e),"state",{reloading:!!e.props.loading,errored:!1,timeseriesData:null,fetchedWithPrevious:!1}),(0,m.Z)((0,u.Z)(e),"unmounting",!1),(0,m.Z)((0,u.Z)(e),"fetchData",(0,n.Z)(f().mark((function r(){var t,s,n,a,i,u,l,c;return f().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t=e.props,s=t.api,n=t.confirmedQuery,a=t.expired,i=t.name,u=t.hideError,l=(0,o.Z)(t,x),c=null,!1!==n){r.next=4;break}return r.abrupt("return");case 4:if(e.setState((function(e){return{reloading:null!==e.timeseriesData,errored:!1}})),!a){r.next=10;break}(0,P.Iw)((0,O.t)("%s has an invalid date range. Please try a more recent date range.",i),{append:!0}),e.setState({errored:!0}),r.next=21;break;case 10:return r.prev=10,s.clear(),r.next=14,(0,g.lI)(s,l);case 14:c=r.sent,r.next=21;break;case 17:r.prev=17,r.t0=r.catch(10),u||(r.t0&&r.t0.responseJSON&&r.t0.responseJSON.detail?(0,P.Iw)(r.t0.responseJSON.detail):(0,P.Iw)((0,O.t)("Error loading chart data"))),e.setState({errored:!0});case 21:if(!e.unmounting){r.next=23;break}return r.abrupt("return");case 23:e.setState({reloading:!1,timeseriesData:c,fetchedWithPrevious:l.includePrevious});case 24:case"end":return r.stop()}}),r,null,[[10,17]])})))),(0,m.Z)((0,u.Z)(e),"getData",(function(r){var t=e.state.fetchedWithPrevious,s=e.props,o=s.period,n=s.includePrevious,a=t||(0,D.Sw)(n,o),i=Math.floor(r.length/2);return{current:a?r.slice(i):r,previous:a?r.slice(0,i):null}})),e}return(0,i.Z)(j,[{key:"componentDidMount",value:function(){this.fetchData()}},{key:"componentDidUpdate",value:function(e){v()(S(e),S(this.props))||this.fetchData()}},{key:"componentWillUnmount",value:function(){this.unmounting=!0}},{key:"calculateTotalsPerTimestamp",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return 1e3*e};return e.map((function(e,t){var o=(0,s.Z)(e,2),n=o[0],a=o[1];return{name:r(n,a,t),value:a.reduce((function(e,r){return e+r.count}),0)}}))}},{key:"transformPreviousPeriodData",value:function(e,r){var t;return r?{seriesName:null!==(t=this.props.previousSeriesName)&&void 0!==t?t:"Previous",data:this.calculateTotalsPerTimestamp(r,(function(r,t,s){return 1e3*e[s][0]}))}:null}},{key:"transformAggregatedTimeseries",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return{seriesName:r,data:this.calculateTotalsPerTimestamp(e)}}},{key:"transformTimeseriesData",value:function(e,r){return[{seriesName:r||"Current",data:e.map((function(e){var r=(0,s.Z)(e,2);return{name:1e3*r[0],value:r[1].reduce((function(e,r){return e+r.count}),0)}}))}]}},{key:"processData",value:function(e){if(!e)return{};var r=e.data,t=e.totals,s=this.props,o=s.includeTransformedData,n=s.includeTimeAggregation,a=s.timeAggregationSeriesName,i=this.getData(r),u=i.current,l=i.previous;return{data:o?this.transformTimeseriesData(u,this.props.currentSeriesName):[],allData:r,originalData:u,totals:t,originalPreviousData:l,previousData:o?this.transformPreviousPeriodData(u,l):null,timeAggregatedData:n?this.transformAggregatedTimeseries(u,a||""):{}}}},{key:"render",value:function(){var e=this,r=this.props,t=r.children,s=r.showLoading,n=(0,o.Z)(r,Z),a=this.state,i=a.timeseriesData,u=a.reloading,l=a.errored,c=this.props.loading||null===i;if(s&&c)return(0,w.tZ)(_.Z,{"data-test-id":"events-request-loading"});if((0,D.Xe)(i))return t(T({loading:c,reloading:u,errored:l,results:Object.keys(i).map((function(r){var t=i[r],s=e.transformTimeseriesData(t.data,r)[0];return[t.order||0,s]})).sort((function(e,r){return e[0]-r[0]})).map((function(e){return e[1]}))},n));var d=this.processData(i);return t(T({loading:c,reloading:u,errored:l,timeseriesData:d.data,allTimeseriesData:d.allData,originalTimeseriesData:d.originalData,timeseriesTotals:d.totals,originalPreviousTimeseriesData:d.originalPreviousData,previousTimeseriesData:d.previousData,timeAggregatedData:d.timeAggregatedData},n))}}]),j}(j.PureComponent);E.displayName="EventsRequest",(0,m.Z)(E,"defaultProps",{period:void 0,start:null,end:null,interval:"1d",limit:15,query:"",includePrevious:!0,includeTransformedData:!0}),r.Z=E},"./app/utils/getPeriod.tsx":function(e,r,t){"use strict";t.d(r,{X:function(){return u}});var s=t("../node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),o=(t("../node_modules/core-js/modules/es.regexp.exec.js"),t("../node_modules/core-js/modules/es.string.match.js"),t("../node_modules/core-js/modules/es.array.concat.js"),t("../node_modules/moment/moment.js")),n=t.n(o),a=t("./app/constants/index.tsx"),i=t("./app/utils/dates.tsx"),u=function(e){var r=e.period,t=e.start,o=e.end,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=u.shouldDoublePeriod;if(r||t||o||(r=a.GY),r){if(!l)return{statsPeriod:r};var c=r.match(/([0-9]+)([mhdw])/),d=(0,s.Z)(c,3),m=d[1],p=d[2];return{statsPeriod:"".concat(2*parseInt(m,10)).concat(p)}}if(!t||!o)throw new Error("start and end required");var f=(0,i.v5)(t),j=(0,i.v5)(o);if(l){var h=n()(o).diff(n()(t)),v=n()(t).subtract(h);return{start:(0,i.v5)(v),end:j}}return{start:f,end:j}}}}]);
//# sourceMappingURL=../sourcemaps/app_components_charts_eventsRequest_tsx.3ec7dfcdafd172146559220adc89e208.js.map
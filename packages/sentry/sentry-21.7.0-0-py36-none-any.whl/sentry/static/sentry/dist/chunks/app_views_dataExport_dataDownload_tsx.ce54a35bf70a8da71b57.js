(self.webpackChunk=self.webpackChunk||[]).push([["app_views_dataExport_dataDownload_tsx"],{"./app/components/dataExport.tsx":function(e,t,r){"use strict";r.d(t,{tD:function(){return n}}),r("../node_modules/core-js/modules/es.reflect.construct.js"),r("../node_modules/core-js/modules/es.object.keys.js"),r("../node_modules/core-js/modules/es.symbol.js"),r("../node_modules/core-js/modules/es.array.filter.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),r("../node_modules/core-js/modules/web.dom-collections.for-each.js"),r("../node_modules/core-js/modules/es.object.get-own-property-descriptors.js");var n,o=r("../node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),s=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),i=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),a=r("../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js"),l=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),d=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),u=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),c=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),p=(r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/react/index.js")),h=r("../node_modules/lodash/debounce.js"),m=r.n(h),y=r("../node_modules/lodash/isEqual.js"),f=r.n(y),b=r("./app/actionCreators/indicator.tsx"),v=r("./app/components/acl/feature.tsx"),Z=r("./app/components/button.tsx"),w=r("./app/locale.tsx"),j=r("./app/utils/withApi.tsx"),g=r("./app/utils/withOrganization.tsx"),x=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function _(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function k(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_(Object(r),!0).forEach((function(t){(0,c.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}!function(e){e.IssuesByTag="Issues-by-Tag",e.Discover="Discover"}(n||(n={}));var D=function(e){(0,l.Z)(p,e);var t,r,n=(t=p,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,u.Z)(t);if(r){var o=(0,u.Z)(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return(0,d.Z)(this,e)});function p(){var e;(0,s.Z)(this,p);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return e=n.call.apply(n,[this].concat(r)),(0,c.Z)((0,a.Z)(e),"state",e.initialState),(0,c.Z)((0,a.Z)(e),"resetState",(function(){e.setState(e.initialState)})),(0,c.Z)((0,a.Z)(e),"startDataExport",(function(){var t=e.props,r=t.api,n=t.organization.slug,s=t.payload,i=s.queryType,a=s.queryInfo;e.setState({inProgress:!0}),r.requestPromise("/organizations/".concat(n,"/data-export/"),{includeAllArgs:!0,method:"POST",data:{query_type:i,query_info:a}}).then((function(e){var t=(0,o.Z)(e,3),r=(t[0],t[1],t[2]);(0,b.S9)(201===(null==r?void 0:r.status)?(0,w.t)("Sit tight. We'll shoot you an email when your data is ready for download."):(0,w.t)("It looks like we're already working on it. Sit tight, we'll email you."))})).catch((function(t){var r,n,o=null!==(r=null==t||null===(n=t.responseJSON)||void 0===n?void 0:n.detail)&&void 0!==r?r:"We tried our hardest, but we couldn't export your data. Give it another go.";(0,b.Iw)((0,w.t)(o)),e.setState({inProgress:!1})}))})),e}return(0,i.Z)(p,[{key:"componentDidUpdate",value:function(e){var t=e.payload,r=this.props.payload;f()(t,r)||this.resetState()}},{key:"initialState",get:function(){return{inProgress:!1}}},{key:"render",value:function(){var e=this.state.inProgress,t=this.props,r=t.children,n=t.disabled,o=t.icon;return(0,x.tZ)(v.Z,{features:["organizations:discover-query"],children:e?(0,x.tZ)(Z.ZP,k(k({size:"small",priority:"default",title:"You can get on with your life. We'll email you when your data's ready."},this.props),{},{disabled:!0,icon:o,children:(0,w.t)("We're working on it...")})):(0,x.tZ)(Z.ZP,k(k({onClick:m()(this.startDataExport,500),disabled:n||!1,size:"small",priority:"default",title:"Put your data to work. Start your export and we'll email you when it's finished.",icon:o},this.props),{},{children:r||(0,w.t)("Export All to CSV")}))})}}]),p}(p.Component);D.displayName="DataExport",t.ZP=(0,j.Z)((0,g.Z)(D))},"./app/views/asyncView.tsx":function(e,t,r){"use strict";r.d(t,{Z:function(){return p}}),r("../node_modules/core-js/modules/es.reflect.construct.js");var n=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),o=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),s=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),i=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),a=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),l=(r("../node_modules/react/index.js"),r("../node_modules/react-document-title/index.js")),d=r.n(l),u=r("./app/components/asyncComponent.tsx"),c=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");var p=function(e){(0,s.Z)(u,e);var t,r,l=(t=u,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,a.Z)(t);if(r){var o=(0,a.Z)(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return(0,i.Z)(this,e)});function u(){return(0,n.Z)(this,u),l.apply(this,arguments)}return(0,o.Z)(u,[{key:"getTitle",value:function(){return""}},{key:"render",value:function(){var e=this.getTitle();return(0,c.tZ)(d(),{title:"".concat(e?"".concat(e," - "):"","Sentry"),children:this.renderComponent()})}}]),u}(u.Z);p.displayName="AsyncView"},"./app/views/dataExport/dataDownload.tsx":function(e,t,r){"use strict";r.r(t),r.d(t,{DownloadStatus:function(){return n}}),r("../node_modules/core-js/modules/es.reflect.construct.js");var n,o=r("../node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),s=r("../node_modules/@babel/runtime/helpers/esm/createClass.js"),i=r("../node_modules/@babel/runtime/helpers/esm/inherits.js"),a=r("../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),l=r("../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),d=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),u=(r("../node_modules/core-js/modules/es.array.concat.js"),r("../node_modules/react/index.js")),c=r("../node_modules/react-router/es/index.js"),p=r("./app/components/button.tsx"),h=r("./app/components/dataExport.tsx"),m=r("./app/components/dateTime.tsx"),y=r("./app/icons/index.tsx"),f=r("./app/locale.tsx"),b=r("./app/styles/space.tsx"),v=r("./app/views/asyncView.tsx"),Z=r("./app/views/auth/layout.tsx"),w=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");!function(e){e.Early="EARLY",e.Valid="VALID",e.Expired="EXPIRED"}(n||(n={}));var j=function(e){(0,i.Z)(b,e);var t,r,d=(t=b,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,l.Z)(t);if(r){var o=(0,l.Z)(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return(0,a.Z)(this,e)});function b(){return(0,o.Z)(this,b),d.apply(this,arguments)}return(0,s.Z)(b,[{key:"getTitle",value:function(){return(0,f.t)("Download Center")}},{key:"getEndpoints",value:function(){var e=this.props.params,t=e.orgId,r=e.dataExportId;return[["download","/organizations/".concat(t,"/data-export/").concat(r,"/")]]}},{key:"getActionLink",value:function(e){var t=this.props.params.orgId;switch(e){case h.tD.IssuesByTag:return"/organizations/".concat(t,"/issues/");case h.tD.Discover:return"/organizations/".concat(t,"/discover/queries/");default:return"/"}}},{key:"renderDate",value:function(e){if(!e)return null;var t=new Date(e);return(0,w.tZ)("strong",{children:(0,w.tZ)(m.Z,{date:t})})}},{key:"renderEarly",value:function(){return(0,w.BX)(u.Fragment,{children:[(0,w.tZ)(g,{children:(0,w.BX)("h3",{children:[(0,f.t)("What are"),(0,w.tZ)("i",{children:(0,f.t)(" you ")}),(0,f.t)("doing here?")]})}),(0,w.BX)(x,{children:[(0,w.tZ)("p",{children:(0,f.t)("Not that its any of our business, but were you invited to this page? It's just that we don't exactly remember emailing you about it.")}),(0,w.tZ)("p",{children:(0,f.t)("Close this window and we'll email you when your download is ready.")})]})]})}},{key:"renderExpired",value:function(){var e=this.state.download.query,t=this.getActionLink(e.type);return(0,w.BX)(u.Fragment,{children:[(0,w.tZ)(g,{children:(0,w.tZ)("h3",{children:(0,f.t)("This is awkward.")})}),(0,w.BX)(x,{children:[(0,w.tZ)("p",{children:(0,f.t)("That link expired, so your download doesn't live here anymore. Just picked up one day and left town.")}),(0,w.tZ)("p",{children:(0,f.t)("Make a new one with your latest data. Your old download will never see it coming.")}),(0,w.tZ)(_,{href:t,priority:"primary",children:(0,f.t)("Start a New Download")})]})]})}},{key:"openInDiscover",value:function(){var e=this.state.download.query.info,t=this.props.params.orgId,r={pathname:"/organizations/".concat(t,"/discover/results/"),query:e};c.browserHistory.push(r)}},{key:"renderOpenInDiscover",value:function(){var e=this,t=this.state.download.query,r=(void 0===t?{type:h.tD.IssuesByTag,info:{}}:t).type;return"Discover"===(void 0===r?h.tD.IssuesByTag:r)?(0,w.BX)(u.Fragment,{children:[(0,w.tZ)("p",{children:(0,f.t)("Need to make changes?")}),(0,w.tZ)(p.ZP,{priority:"primary",onClick:function(){return e.openInDiscover()},children:(0,f.t)("Open in Discover")}),(0,w.tZ)("br",{})]}):null}},{key:"renderValid",value:function(){var e=this.state.download,t=e.dateExpired,r=e.checksum,n=this.props.params,o=n.orgId,s=n.dataExportId;return(0,w.BX)(u.Fragment,{children:[(0,w.tZ)(g,{children:(0,w.tZ)("h3",{children:(0,f.t)("All done.")})}),(0,w.BX)(x,{children:[(0,w.tZ)("p",{children:(0,f.t)("See, that wasn't so bad. Your data is all ready for download.")}),(0,w.tZ)(p.ZP,{priority:"primary",icon:(0,w.tZ)(y.Dj,{}),href:"/api/0/organizations/".concat(o,"/data-export/").concat(s,"/?download=true"),children:(0,f.t)("Download CSV")}),(0,w.BX)("p",{children:[(0,f.t)("That link won't last forever — it expires:"),(0,w.tZ)("br",{}),this.renderDate(t)]}),this.renderOpenInDiscover(),(0,w.BX)("p",{children:[(0,w.tZ)("small",{children:(0,w.BX)("strong",{children:["SHA1:",r]})}),(0,w.tZ)("br",{}),(0,f._N)("Need help verifying? [link].",{link:(0,w.tZ)("a",{href:"https://docs.sentry.io/product/discover-queries/query-builder/#filter-by-table-columns",target:"_blank",rel:"noopener noreferrer",children:(0,f.t)("Check out our docs")})})]})]})]})}},{key:"renderError",value:function(){var e,t=this.state.errors.download,r=null==t||null===(e=t.responseJSON)||void 0===e?void 0:e.detail;return(0,w.tZ)(Z.Z,{children:(0,w.BX)("main",{children:[(0,w.tZ)(g,{children:(0,w.BX)("h3",{children:[t.status," - ",t.statusText]})}),r&&(0,w.tZ)(x,{children:(0,w.tZ)("p",{children:r})})]})})}},{key:"renderContent",value:function(){switch(this.state.download.status){case n.Early:return this.renderEarly();case n.Expired:return this.renderExpired();default:return this.renderValid()}}},{key:"renderBody",value:function(){return(0,w.tZ)(Z.Z,{children:(0,w.tZ)("main",{children:this.renderContent()})})}}]),b}(v.Z),g=(0,d.Z)("header",{target:"eq2c1c22"})("border-bottom:1px solid ",(function(e){return e.theme.border}),";padding:",(0,b.Z)(3)," 40px 0;h3{font-size:24px;margin:0 0 ",(0,b.Z)(3)," 0;}"),x=(0,d.Z)("div",{target:"eq2c1c21"})("padding:",(0,b.Z)(2)," 40px;max-width:500px;p{margin:",(0,b.Z)(1.5)," 0;}"),_=(0,d.Z)(p.ZP,{target:"eq2c1c20"})("margin-bottom:",(0,b.Z)(1.5),";");t.default=j}}]);
//# sourceMappingURL=../sourcemaps/app_views_dataExport_dataDownload_tsx.ddf55861b413da441516d40773bd1543.js.map
(()=>{var e,t,i,n={33832:(e,t,i)=>{"use strict";var n=i(90567),a=i.n(n),o=i(86330),l=i.n(o),r=i(61941),s=i.n(r),c=i(11986),d=i.n(c),h=i(28995);!function(e){var t,i,n,o,r,c=!1,g=-1,f=!1,u={},p={},m=null,v={},b=null,k=null,w=!1,x=h.$T.gettext("The back side of the templates that use this one as the back side will be removed."),j=h.$T.gettext("Disassociate back sides"),y=!1;let _=null;function T(e){return _.includes(e)}function C(e){return e*r}function O(e){return e/r}function M(e,t){return e(/([0-9.]+)pt/g.exec(t)[1])+"pt"}var z=d()(M,C),P=d()(M,C);function D(e){var t={id:++g,type:e,x:n,y:o,font_family:"sans-serif",bold:!1,italic:!1,text_align:"center",color:"black",font_size:"15pt",width:T(e)?150:400,height:T(e)?150:null,text:(0,h.$T)("Fixed text"),selected:!1};return t.toHTML=function(){return $("<div>").addClass("designer-item").toggleClass("selected",this.selected).css({width:C(this.width),height:this.height?C(this.height):this.height,cursor:"move",fontWeight:this.bold?"bold":"normal",fontStyle:this.italic?"italic":"normal",fontFamily:this.font_family,fontSize:z(this.font_size),textAlign:this.text_align.replace("Justified","justify"),color:this.color}).attr("data-type",this.type).text("fixed"===this.type?this.text:v[this.type])}.bind(t),t}function F(e,t){this.realWidth=e,this.realHeight=t,this.width=C(e),this.height=C(t)}function S(e,t){var i=t?".template-side.back":".template-side.front",n=$("<div/>").css({position:"absolute",left:e.x+"px",top:e.y+"px",zIndex:g+10}).data("id",e.id).appendTo(i);return t||n.draggable({containment:i,stack:i+" > div",opacity:.5,drag:function(e,t){c&&(t.position.left=10*Math.floor(t.position.left/10),t.position.top=10*Math.floor(t.position.top/10))},stop:function(e,t){var i=$(this).data("id");u[i].x=O(t.position.left),u[i].y=O(t.position.top)}}),n}function q(e,t){if(e.length){var i=e.closest(".ui-draggable").data("id");return t?p[i]:u[i]}}function H(){return q($(".designer-item.selected"))}function W(e){var t=q(e);t&&(t.selected=!1,e.removeClass("selected"))}function E(e){var t=q(e);$(".element-tools").removeClass("hidden"),$(".second-row").removeClass("disappear"),$(".selection-text").html("fixed"===t.type?h.$T.gettext("Fixed text"):v[t.type]),W($(".designer-item.selected")),t.selected=!0,e.addClass("selected");var i=l()([t.bold?"bold":null,t.italic?"italic":null]);$("#alignment-selector").val(t.text_align),$("#font-selector").val(t.font_family),$("#size-selector").val(t.font_size),$("#style-selector").val(i.length?i.join("_"):"normal"),$("#color-selector").val(t.color),$(".js-element-width").val(t.width/n),$(".js-element-height").val(t.height/n);var a=$("#fixed-text-field");const o=$("#subtool-element-height");var r=$(".font-tools");"fixed"===t.type?(r.show(),a.closest(".tool").show(),a.val(t.text),o.hide()):T(t.type)?(r.hide(),a.closest(".tool").hide(),o.show()):(r.show(),a.closest(".tool").hide(),a.val(""),o.hide())}function I(){var e,a=Math.ceil(i.width/n),o=Math.ceil(t.width/n),l=Math.ceil(i.height/n),r=Math.ceil(t.height/n);if(t.width>i.width){var s=$("#horizontal-ruler");for(e=a;e<o;e++)$('<div class="marking"/>').attr("id","rulerh"+e).css({width:n+"px",left:e*n+"px",top:0}).html(e+1).appendTo(s)}else if(t.width<i.width)for(e=a;e>o;e--)$("#rulerh"+(e-1)).remove();if(t.height>i.height){var c=$("#vertical-ruler");for(e=l;e<r;e++)$('<div class="marking"/>').attr("id","rulerv"+e).css({"line-height":n/2+"px",height:n+"px",left:0,top:e*n+"px"}).html(e+1).appendTo(c)}else if(t.height<i.height)for(e=l;e>r;e--)$("#rulerv"+(e-1)).remove()}function L(e,a){var o=$(".template-container"),l=parseFloat($(".template-width").val()),r=parseFloat($(".template-height").val());o.width(Math.round(l*n)),o.height(Math.round(r*n)),i.width=t.width,i.height=t.height,t=new F(Math.round(50*l),Math.round(50*r)),I(),function(e,t){J(e),t.background_url&&J(t,!0)}(e,a),function(e,t){$(".js-preset-tool option").each((function(){var i=$(this);if("custom"!==i.val()){var n=i.data("width"),a=i.data("height");n===e&&a===t&&(i.prop("selected",!0),$(".js-template-dimension").prop("disabled",!0))}}))}(l,r)}function A(e){var t=H(),i=$(".designer-item.selected");i&&({font:function(){t.font_family=$("#font-selector").val()},color:function(){t.color=$("#color-selector").val()},alignment:function(){t.text_align=$("#alignment-selector").val()},size:function(){t.font_size=$("#size-selector").val()},style:function(){switch($("#style-selector").val()){case"normal":t.bold=!1,t.italic=!1;break;case"bold":t.bold=!0,t.italic=!1;break;case"italic":t.bold=!1,t.italic=!0;break;case"bold_italic":t.bold=!0,t.italic=!0}},text:function(){var e=$("#fixed-text-field");t.text=e.val().replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"),e.val(t.text)},width:function(){t.width=Math.round($(".js-element-width").val()*n),"ticket_qr_code"===t.type&&($(".js-element-height").val($(".js-element-width").val()),t.height=t.width)},height:function(){t.height=Math.round($(".js-element-height").val()*n),"ticket_qr_code"===t.type&&($(".js-element-width").val($(".js-element-height").val()),t.width=t.height)}}[e](),i.replaceWith(t.toHTML()))}function U(e,i){if("stretch"===i)e.css({left:0,top:0}),e.height(t.height),e.width(t.width);else if("center"===i){var n,a=(o=e,(l=new Image).src=o.attr("src"),{width:l.width,height:l.height});e.height(a.height),e.width(a.width),e.width()>t.width||e.height()>t.height?(e.width()>t.width&&(n=t.width/e.width(),e.width(t.width),e.height(e.height()*n),e.css({left:0,top:t.height/2-e.height()/2+"px"})),e.height()>t.height&&(n=t.height/e.height(),e.width(e.width()*n),e.height(t.height),e.css({left:t.width/2-e.width()/2+"px",top:0}))):e.css({left:t.width/2-a.width/2+"px",top:t.height/2-a.height/2+"px"})}var o,l}function J(e,i){var n=i?".template-side.back":".template-side.front",a=$(n).find(".background-image"),o=e.data.background_position;a.attr({src:e.background_url}).css({position:"absolute",left:0,top:0,height:t.height+"px",width:t.width+"px",zIndex:5}).on("load",(function(){$("#loadingIcon").hide(),U($(this),o)})).appendTo(n)}function N(e,t){e.data&&(e.data.items.forEach((function(e){!function(e,t){delete e.id;var i=s()(D(),e);t?p[i.id]=i:u[i.id]=i}(e,t)})),function(e){var t=e?p:u;$.each(t,(function(t,i){var n=S(i,e);n.css({left:C(i.x)+"px",top:C(i.y)+"px"}),n.append(i.toHTML()),i.selected&&!e&&E(n.find(".designer-item"))}))}(t)),G(!(t&&e.data&&(e.data.items.length||e.background_url))),e.background_url&&J(e,t)}function B(e){var t=$(".template-side.back");e.background_url&&(e.background_url=null,t.find(".background-image").remove(),t.append($("<img>",{class:"background-image"}))),t.find(".designer-item").remove(),e.title=null,e.data=null,p={}}function G(e){var t=$(".backside-placeholder");t.parent().toggleClass("empty",e),t.toggle(e),$(".backside-tools").toggleClass("hidden",e)}function K(e){G(e),$(".backside-tools").toggleClass("hidden",!e),e?($(".backside-placeholder").addClass("to-be-removed"),$(".placeholder-text").html(h.$T.gettext("This back side template will be removed")),$(".placeholder-link").hide(),x=h.$T.gettext("The back side of this template will be removed"),j=h.$T.gettext("Disassociate back side"),y=!0):($(".backside-placeholder").removeClass("to-be-removed"),$(".placeholder-text").html(h.$T.gettext("The back side is empty.")),$(".placeholder-link").show(),x=h.$T.gettext("The back side of the templates that use this one as the back side will be removed."),j=h.$T.gettext("Disassociate back sides"),y=!1)}function Q(e,t,i,n){if($("#backside-warning").length||null!==m){var a=null;$("#backside-warning").length&&null!==m?a=$(".affected-targets-warning"):$("#backside-warning").length?a=$("#backside-warning"):null!==m&&(a=$("#frontside-warning")),50*e.val()!==i?(null!==m&&K(!0),a.show("fast"),w=!0):50*t.val()===n&&(a.hide("fast"),null!==m&&K(!1),w=!1)}}function R(){$("#frontside-warning").hide("fast"),K(!1),y=!1,w=!1}e.setupDesigner=function(e,l,s,d,g){f=!!e,v=Object.assign(...Object.values(d).map((e=>{let{options:t}=e;return t}))),r=s.zoom_factor,n=C(50),o=n,m=l.id,_=g,$(document).ready((function(){var i=$(".js-remove-bg").qtip();$('#bg-form input[type="file"]').on("change",(function(){var e=$(this);this.files&&e.next("label").removeClass("i-button").text(this.files[0].name),$(".js-upload-bg").attr("disabled",!e.val()).toggleClass("highlight",!!e.val())})),$(".template-content").on("mousedown",".designer-item",(function(){E($(this))})).on("dblclick",".designer-item",(function(){!function(e){var t=q(e);if("fixed"===t.type){var i=prompt("Enter fixed-text value",t.text);if(i){var n=e.parent(".ui-draggable");t.text=i,n.html(t.toHTML())}}}($(this))})),$(".js-upload-bg").click((function(){return $(".js-toggle-side.front").click(),$("#bg-form").submit(),!1})),$("#grid-snap").change((function(){c=this.checked})).change(),$("#bg-form").ajaxForm({dataType:"json",iframe:!1,success:function(t){t.error?alertPopup(t.error,(0,h.$T)("Error")):(e.background_url=t.image_url,J(e),$(".template-side.front").trigger("indico:backgroundChanged"))}}),$("input[name=bg-position]").change((function(t){t.preventDefault();var i=$(this).val();U($(".template-side.front .background-image"),i),e.data.background_position=i})),$(".js-remove-bg").click((function(t){t.preventDefault(),i.qtip("api").toggle(),function(e){e.background_url&&(e.background_url=null,$(".template-side.front").trigger("indico:backgroundChanged"))}(e)})),$(".move-button").click((function(e){e.preventDefault(),function(e){var i=H(),n=$(".designer-item.selected").parent();({left:function(){n&&(n.css("left",0),i.x=0)},right:function(){if(n){var e=t.width-n.width();n.css("left",e>0?e+"px":0),i.x=O(e>0?e:0)}},center:function(){if(n){var e=(t.width-n.width())/2,a=(t.height-n.height())/2;n.css("left",e>0?e+"px":0),n.css("top",a>0?a+"px":0),i.x=O(e>0?e:0),i.y=O(a>0?a:0)}},top:function(){n&&(n.css("top",0),i.y=0)},bottom:function(){if(n){var e=t.height-n.height();n.css("top",e>0?e+"px":0),i.y=O(e>0?e:0)}}})[e]()}($(this).data("direction"))})),$(".js-font-tool").change((function(){A($(this).data("attr"))})),$(".insert-element-btn").click((function(e){var i,a,l;e.preventDefault(),$(".js-toggle-side.front").click(),i=D($("#element-list").val()),a=S(i),l=i.toHTML().appendTo(a),u[i.id]=i,E(l),o+=n,o%=t.height-20})),$(".js-remove-element").click((function(e){var t,i;e.preventDefault(),t=$(".designer-item.selected"),(i=H())&&(delete u[i.id],t.remove(),$(".element-tools").addClass("hidden"))})),$(".js-save-template").click((function(i){i.preventDefault(),function(e){if(""!==$(".js-template-name").val())if(Object.keys(u).length||e.background_url){y&&(m=null);var i={template:{width:t.realWidth,height:t.realHeight,background_position:$("input[name=bg-position]:checked").val(),items:a()(u).map((function(e){return $.extend(!0,{},e).font_size=P(e.font_size),e}))},clear_background:!e.background_url,title:$(".js-template-name").val(),is_clonable:$('input[name="is-clonable"]:checked').length>0,backside_template_id:m};(w?confirmPrompt(h.$T.gettext("Are you sure you want to change the dimensions of this template?")+x,j):$.Deferred().resolve()).then((function(){$.ajax({url:location.pathname,data:JSON.stringify(i),contentType:"application/json",method:"POST",complete:IndicoUI.Dialogs.Util.progress(),error:handleAjaxError,success:function(e){b=t.width,k=t.height,y&&($(".affected-targets-warning").hide("fast"),K(!1),$(".js-remove-backside").click(),y=!1,w=!1),handleFlashes(e,!0)}})}))}else alertPopup(h.$T.gettext("The template cannot be empty. Add some elements or a background image."),h.$T.gettext("Warning"));else alertPopup(h.$T.gettext("Please choose a name for the template"),(0,h.$T)("Warning"))}(e)})),$(".template-width, .template-height").on("input",(function(){L(e,l)})),$(".js-element-width").on("keyup click",(function(){A("width")})),$(".js-element-height").on("keyup click",(function(){A("height")})),$("#fixed-text-field").on("keyup",(function(){A("text")})),$(".js-preset-tool").on("change",(function(){var t=$(this).find("option:selected");"custom"!==t.val()&&($(".template-width").val(t.data("width")).change(),$(".template-height").val(t.data("height")).change(),L(e,l)),$(".js-template-dimension").prop("disabled","custom"!==t.val())})),$(".js-toggle-side").on("click",(function(){var e=$(this),t=e.hasClass("front")?"front":"back",i=$(".designer-item.selected"),n=l.data&&(l.data.items.length||l.background_url);$(".template-content").toggleClass("flipped","back"===t),$(".template-side.back").toggleClass("active","back"===t),$(".template-side.front").toggleClass("active","front"===t),$(".backside-tools").toggleClass("hidden","front"===t||!n),$(".js-toggle-side").removeClass("highlight"),$(".element-tools").addClass("hidden"),$(".js-hide-on-flip").toggle("back"!==t),$(".js-invisible-on-flip").toggleClass("disappear","back"===t),e.toggleClass("highlight"),i&&i[0]&&W(i),$(".template-side.active").trigger("indico:backgroundChanged")})),$(".template-side").on("indico:backgroundChanged",(function(){var t=$("#backgroundFile"),i=$(".template-side.front"),n=i.find(".background-image");!e.background_url&&n.attr("src")&&(n.remove(),i.append($("<img>",{class:"background"})),t.val(""),t.next("label").addClass("i-button").text(h.$T.gettext("Choose a file"))),$(".js-upload-bg").attr("disabled",!t.val()),$(".js-remove-bg").attr("disabled",!e.background_url),$("#bg-position-stretch").prop("checked","stretch"===e.data.background_position),$("#bg-position-center").prop("checked","center"===e.data.background_position)})),$(".template-side.front").trigger("indico:backgroundChanged"),$(".template-side.back").on("indico:backsideUpdated",(function(e,t){m=t.backside_template_id,B(l),N(t.template,!0),l=t.template,y&&R(),$(".backside-template-title, .js-front-affected-title").text(t.template.title)})),$(".js-remove-backside").on("click",(function(){m=null,B(l),y&&R(),G(!0)})),$(".js-change-orientation").on("click",(function(){var t=$(".template-width"),i=$(".template-height"),n=t.val();t.val(i.val()).change(),i.val(n).change(),L(e,l)})),$(".js-backside-list-dialog").on("click",(function(){var e=$(this);ajaxDialog({trigger:e,url:e.data("href"),data:{width:t.realWidth,height:t.realHeight},title:e.data("title")})})),$(".backside-tools").addClass("hidden");var r=$(".template-width"),s=$(".template-height");r.on("change input",(function(){Q($(this),s,b,k)})),s.on("change input",(function(){Q($(this),r,k,b)})),$(".js-back-affected").qbubble({overwrite:!0,position:{target:$(".js-back-affected")},content:{text:$(".back-warning-qtip-content").html()},hide:{event:"unfocus click"},show:{event:"click"}}),$(".js-front-affected").qbubble({overwrite:!0,position:{target:$(".js-front-affected")},content:{text:function(){return $(".front-warning-qtip-content").html()}},hide:{event:"unfocus click"},show:{event:"click"}})})),f?(t=new F(e.data.width,e.data.height),$(".js-template-name").val(e.title),$(".js-is-clonable").prop("checked",e.is_clonable),$(".template-container").width(t.width).height(t.height)):t=new F(s.tpl_size[0],s.tpl_size[1]),i=new F(0,0),$(".template-width").val(t.width/n),$(".template-height").val(t.height/n),b=t.width,k=t.height,I(),L(e,l),N(e),N(l,!0)}}(window)},2666:(e,t,i)=>{var n=i(11396),a=i(32544),o=i(5850),l=a((function(e,t){n(t,o(t),e)}));e.exports=l},61941:(e,t,i)=>{e.exports=i(2666)}},a={};function o(e){var t=a[e];if(void 0!==t)return t.exports;var i=a[e]={id:e,loaded:!1,exports:{}};return n[e].call(i.exports,i,i.exports,o),i.loaded=!0,i.exports}o.m=n,e=[],o.O=(t,i,n,a)=>{if(!i){var l=1/0;for(c=0;c<e.length;c++){for(var[i,n,a]=e[c],r=!0,s=0;s<i.length;s++)(!1&a||l>=a)&&Object.keys(o.O).every((e=>o.O[e](i[s])))?i.splice(s--,1):(r=!1,a<l&&(l=a));r&&(e.splice(c--,1),t=n())}return t}a=a||0;for(var c=e.length;c>0&&e[c-1][2]>a;c--)e[c]=e[c-1];e[c]=[i,n,a]},o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},i=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,o.t=function(e,n){if(1&n&&(e=this(e)),8&n)return e;if("object"==typeof e&&e){if(4&n&&e.__esModule)return e;if(16&n&&"function"==typeof e.then)return e}var a=Object.create(null);o.r(a);var l={};t=t||[null,i({}),i([]),i(i)];for(var r=2&n&&e;"object"==typeof r&&!~t.indexOf(r);r=i(r))Object.getOwnPropertyNames(r).forEach((t=>l[t]=()=>e[t]));return l.default=()=>e,o.d(a,l),a},o.d=(e,t)=>{for(var i in t)o.o(t,i)&&!o.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},o.e=()=>Promise.resolve(),o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),o.j=1113,(()=>{var e={1113:0};o.O.j=t=>0===e[t];var t=(t,i)=>{var n,a,[l,r,s]=i,c=0;for(n in r)o.o(r,n)&&(o.m[n]=r[n]);if(s)var d=s(o);for(t&&t(i);c<l.length;c++)a=l[c],o.o(e,a)&&e[a]&&e[a][0](),e[l[c]]=0;return o.O(d)},i=self.webpackChunk=self.webpackChunk||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var l=o.O(void 0,[8592],(()=>o(33832)));l=o.O(l)})();
//# sourceMappingURL=module_designer.bfc9ee13.bundle.js.map
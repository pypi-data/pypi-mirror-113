{"version":3,"sources":["webpack:///./app/components/internalStatChart.tsx","webpack:///./app/views/admin/adminQueue.tsx","webpack:///./app/views/asyncView.tsx"],"names":["InternalStatChart","error","loading","data","setState","props","api","request","method","since","resolution","key","stat","success","this","fetchData","_nextProps","nextState","state","prevProps","label","height","onRetry","series","seriesName","map","name","value","isGroupedByDate","showTimeInTooltip","labelYAxisExtents","Component","withApi","TIME_WINDOWS","AdminQueue","timeWindow","Date","getTime","taskName","seconds","Error","activeTask","taskList","Header","className","merged","active","r","size","barId","onClick","changeWindow","withPadding","onChange","changeTask","clearable","choices","t","AsyncView","title","getTitle","renderComponent","AsyncComponent"],"mappings":"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","file":"chunks/app_views_admin_adminQueue_tsx.xxxxxxxxxxxxxxxxxxxx.js","sourcesContent":["import {Component} from 'react';\n\nimport {Client} from 'app/api';\nimport MiniBarChart from 'app/components/charts/miniBarChart';\nimport LoadingError from 'app/components/loadingError';\nimport LoadingIndicator from 'app/components/loadingIndicator';\nimport withApi from 'app/utils/withApi';\n\ntype Props = {\n  api: Client;\n  since: number;\n  resolution: string;\n  stat: string;\n  label: string;\n  height?: number;\n};\n\ntype State = {\n  error: boolean;\n  loading: boolean;\n  data: [number, number][] | null;\n};\n\nclass InternalStatChart extends Component<Props, State> {\n  state: State = {\n    error: false,\n    loading: true,\n    data: null,\n  };\n\n  componentDidMount() {\n    this.fetchData();\n  }\n\n  shouldComponentUpdate(_nextProps: Props, nextState: State) {\n    return this.state.loading !== nextState.loading;\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    if (\n      prevProps.since !== this.props.since ||\n      prevProps.stat !== this.props.stat ||\n      prevProps.resolution !== this.props.resolution\n    ) {\n      this.fetchData();\n    }\n  }\n\n  fetchData = () => {\n    this.setState({loading: true});\n    this.props.api.request('/internal/stats/', {\n      method: 'GET',\n      data: {\n        since: this.props.since,\n        resolution: this.props.resolution,\n        key: this.props.stat,\n      },\n      success: data =>\n        this.setState({\n          data,\n          loading: false,\n          error: false,\n        }),\n      error: () => this.setState({error: true, loading: false}),\n    });\n  };\n\n  render() {\n    const {loading, error, data} = this.state;\n    const {label, height} = this.props;\n    if (loading) {\n      return <LoadingIndicator />;\n    } else if (error) {\n      return <LoadingError onRetry={this.fetchData} />;\n    }\n\n    const series = {\n      seriesName: label,\n      data:\n        data?.map(([timestamp, value]) => ({\n          name: timestamp * 1000,\n          value,\n        })) ?? [],\n    };\n    return (\n      <MiniBarChart\n        height={height ?? 150}\n        series={[series]}\n        isGroupedByDate\n        showTimeInTooltip\n        labelYAxisExtents\n      />\n    );\n  }\n}\n\nexport default withApi(InternalStatChart);\n","import styled from '@emotion/styled';\n\nimport Button from 'app/components/button';\nimport ButtonBar from 'app/components/buttonBar';\nimport {SelectField} from 'app/components/forms';\nimport InternalStatChart from 'app/components/internalStatChart';\nimport {Panel, PanelBody, PanelHeader} from 'app/components/panels';\nimport AsyncView from 'app/views/asyncView';\n\nconst TIME_WINDOWS = ['1h', '1d', '1w'] as const;\n\ntype TimeWindow = typeof TIME_WINDOWS[number];\n\ntype State = AsyncView['state'] & {\n  timeWindow: TimeWindow;\n  since: number;\n  resolution: string;\n  taskName: string;\n  activeTask: string;\n  taskList: string[];\n};\n\nexport default class AdminQueue extends AsyncView<{}, State> {\n  getDefaultState() {\n    return {\n      ...super.getDefaultState(),\n      timeWindow: '1w',\n      since: new Date().getTime() / 1000 - 3600 * 24 * 7,\n      resolution: '1h',\n      taskName: null,\n    };\n  }\n\n  getEndpoints(): ReturnType<AsyncView['getEndpoints']> {\n    return [['taskList', '/internal/queue/tasks/']];\n  }\n\n  changeWindow(timeWindow: TimeWindow) {\n    let seconds: number;\n    if (timeWindow === '1h') {\n      seconds = 3600;\n    } else if (timeWindow === '1d') {\n      seconds = 3600 * 24;\n    } else if (timeWindow === '1w') {\n      seconds = 3600 * 24 * 7;\n    } else {\n      throw new Error('Invalid time window');\n    }\n    this.setState({\n      since: new Date().getTime() / 1000 - seconds,\n      timeWindow,\n    });\n  }\n\n  changeTask(value: string) {\n    this.setState({activeTask: value});\n  }\n\n  renderBody() {\n    const {activeTask, taskList} = this.state;\n\n    return (\n      <div>\n        <Header>\n          <h3 className=\"no-border\">Queue Overview</h3>\n\n          <ButtonBar merged active={this.state.timeWindow}>\n            {TIME_WINDOWS.map(r => (\n              <Button size=\"small\" barId={r} onClick={() => this.changeWindow(r)} key={r}>\n                {r}\n              </Button>\n            ))}\n          </ButtonBar>\n        </Header>\n\n        <Panel>\n          <PanelHeader>Global Throughput</PanelHeader>\n          <PanelBody withPadding>\n            <InternalStatChart\n              since={this.state.since}\n              resolution={this.state.resolution}\n              stat=\"jobs.all.started\"\n              label=\"jobs started\"\n            />\n          </PanelBody>\n        </Panel>\n\n        <h3 className=\"no-border\">Task Details</h3>\n\n        <div>\n          <div className=\"m-b-1\">\n            <label>Show details for task:</label>\n            <SelectField\n              name=\"task\"\n              onChange={value => this.changeTask(value as string)}\n              value={activeTask}\n              clearable\n              choices={taskList.map(t => [t, t])}\n            />\n          </div>\n          {activeTask ? (\n            <div>\n              <Panel key={`jobs.started.${activeTask}`}>\n                <PanelHeader>\n                  Jobs Started <small>{activeTask}</small>\n                </PanelHeader>\n                <PanelBody withPadding>\n                  <InternalStatChart\n                    since={this.state.since}\n                    resolution={this.state.resolution}\n                    stat={`jobs.started.${activeTask}`}\n                    label=\"jobs\"\n                    height={100}\n                  />\n                </PanelBody>\n              </Panel>\n              <Panel key={`jobs.finished.${activeTask}`}>\n                <PanelHeader>\n                  Jobs Finished <small>{activeTask}</small>\n                </PanelHeader>\n                <PanelBody withPadding>\n                  <InternalStatChart\n                    since={this.state.since}\n                    resolution={this.state.resolution}\n                    stat={`jobs.finished.${activeTask}`}\n                    label=\"jobs\"\n                    height={100}\n                  />\n                </PanelBody>\n              </Panel>\n            </div>\n          ) : null}\n        </div>\n      </div>\n    );\n  }\n}\n\nconst Header = styled('div')`\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n`;\n","import * as React from 'react';\nimport DocumentTitle from 'react-document-title';\n\nimport AsyncComponent from 'app/components/asyncComponent';\n\ntype AsyncViewState = AsyncComponent['state'];\ntype AsyncViewProps = AsyncComponent['props'];\n\nexport default class AsyncView<\n  P extends AsyncViewProps = AsyncViewProps,\n  S extends AsyncViewState = AsyncViewState\n> extends AsyncComponent<P, S> {\n  getTitle() {\n    return '';\n  }\n\n  render() {\n    const title = this.getTitle();\n    return (\n      <DocumentTitle title={`${title ? `${title} - ` : ''}Sentry`}>\n        {this.renderComponent() as React.ReactChild}\n      </DocumentTitle>\n    );\n  }\n}\n"],"sourceRoot":""}
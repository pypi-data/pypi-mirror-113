{"version":3,"sources":["webpack:///./app/views/asyncView.tsx","webpack:///./app/components/idBadge/teamBadge/index.tsx","webpack:///./app/views/settings/components/teamSelect.tsx"],"names":["AsyncView","title","this","getTitle","renderComponent","AsyncComponent","TeamBadgeContainer","team","props","TeamStore","onTeamStoreUpdate","undefined","nextProps","state","isEqual","setState","unlistener","updatedTeam","has","id","avatar","React","TeamSelect","loading","teamsSearch","debounce","query","api","organization","requestPromise","slug","per_page","TEAMS_PER_PAGE","DEFAULT_DEBOUNCE_DURATION","event","fetchTeams","target","value","option","find","tm","onAddTeam","teamSlug","onRemoveTeam","options","disabled","selectedTeams","menuHeader","isDisabled","length","filter","some","selectedTeam","map","index","searchKey","label","DropdownTeamBadge","avatarSize","items","busyItemsStillVisible","onChange","handleQueryUpdate","onSelect","handleAddTeam","emptyMessage","t","alignMenu","isOpen","size","confirmLastTeamRemoveMessage","confirmMessage","TeamRow","orgId","onRemove","handleRemove","hasButtons","renderTeamAddDropDown","renderBody","TeamPanelItem","StyledLink","to","message","bypass","onConfirm","icon","isCircled","TeamBadge","p","theme","fontSizeMedium","PanelItem","space","Link","withApi"],"mappings":"61BAQqBA,E,0iBAInB,WACE,MAAO,K,oBAGT,WACE,IAAMC,EAAQC,KAAKC,WACnB,OACE,QAAC,IAAD,CAAeF,MAAK,UAAKA,EAAQ,GAAH,OAAMA,EAAN,OAAmB,GAA7B,UAApB,SACGC,KAAKE,wB,GATJC,KAHWL,E,w+ECMfM,E,wnBACW,CAACC,KAAM,EAAKC,MAAMD,Q,+BAkBpBE,YACX,SAACF,GAAD,OAAuB,EAAKG,kBAAkBH,UAC9CI,I,iEAlBF,SAAiCC,GAC3BV,KAAKW,MAAMN,OAASK,EAAUL,OAI9BO,IAAQZ,KAAKW,MAAMN,KAAMK,EAAUL,OAIvCL,KAAKa,SAAS,CAACR,KAAMK,EAAUL,U,kCAGjC,WAAuB,MACrB,UAAAL,KAAKc,kBAAL,cAAAd,Q,+BAQF,SAAkBe,GAChB,GAAKA,EAAYC,IAAIhB,KAAKW,MAAMN,KAAKY,IAArC,CAIA,IAAMZ,EAAOE,YAAkBP,KAAKW,MAAMN,KAAKY,IAC1CZ,IAAQO,IAAQP,EAAKa,OAAQlB,KAAKW,MAAMN,KAAKa,SAIlDlB,KAAKa,SAAS,CAACR,Y,oBAGjB,WACE,OAAO,QAAC,IAAD,OAAWL,KAAKM,OAAhB,IAAuBD,KAAML,KAAKW,MAAMN,Y,GAtClBc,aAA3Bf,E,iCA0CN,Q,+RCEMgB,E,wnBACW,CACbC,SAAS,EACTC,YAAa,Q,+BAOFC,IAAQ,mCAAC,WAAOC,GAAP,sFACQ,EAAKlB,MAA1BmB,EADa,EACbA,IAAKC,EADQ,EACRA,aADQ,SAEMD,EAAIE,eAAJ,yBACND,EAAaE,KADP,WAExB,CACEJ,MAAO,CAACA,QAAOK,SAAUC,QALT,OAEdR,EAFc,OAQpB,EAAKT,SAAS,CAACS,cAAaD,SAAS,IARjB,2CAAD,sDASlBU,Q,uCAEiB,SAACC,GACnB,EAAKnB,SAAS,CAACQ,SAAS,IACxB,EAAKY,WAAWD,EAAME,OAAOC,W,mCAGf,SAACC,GAAiB,MAC1B/B,EAAI,UAAG,EAAKM,MAAMW,mBAAd,aAAG,EAAwBe,MAAK,SAAAC,GAAE,OAAIA,EAAGV,OAASQ,EAAOD,SAC/D9B,GACF,EAAKC,MAAMiC,UAAUlC,O,kCAIV,SAACmC,GACd,EAAKlC,MAAMmC,aAAaD,M,kDA5B1B,WACExC,KAAKiC,e,mCA8BP,WACE,IAIIS,EAJJ,EAA8C1C,KAAKM,MAA5CqC,EAAP,EAAOA,SAAUC,EAAjB,EAAiBA,cAAeC,EAAhC,EAAgCA,WACzBvB,EAAetB,KAAKW,MAApBW,YACDwB,EAAaH,EAkBnB,OAdED,EADkB,OAAhBpB,GAA+C,IAAvBA,EAAYyB,OAC5B,GAEAzB,EACP0B,QACC,SAAA3C,GAAI,OAAKuC,EAAcK,MAAK,SAAAC,GAAY,OAAIA,EAAatB,OAASvB,EAAKuB,WAExEuB,KAAI,SAAC9C,EAAM+C,GAAP,MAAkB,CACrBA,QACAjB,MAAO9B,EAAKuB,KACZyB,UAAWhD,EAAKuB,KAChB0B,OAAO,QAACC,EAAD,CAAmBC,WAAY,GAAInD,KAAMA,SAKpD,QAAC,IAAD,CACEoD,MAAOf,EACPgB,sBAAuB1D,KAAKW,MAAMU,QAClCsC,SAAU3D,KAAK4D,kBACfC,SAAU7D,KAAK8D,cACfC,cAAcC,OAAE,YAChBnB,WAAYA,EACZF,SAAUG,EACVmB,UAAU,QARZ,SAUG,gBAAEC,EAAF,EAAEA,OAAF,OACC,QAAC,IAAD,CACE,cAAYF,OAAE,YACdE,OAAQA,EACRC,KAAK,SACLxB,SAAUG,EAJZ,UAMGkB,OAAE,mB,wBAOb,WAAa,WACX,EACEhE,KAAKM,MADAoB,EAAP,EAAOA,aAAckB,EAArB,EAAqBA,cAAeD,EAApC,EAAoCA,SAAUyB,EAA9C,EAA8CA,6BAG9C,GAA6B,IAAzBxB,EAAcG,OAChB,OAAO,QAAC,IAAD,WAAeiB,OAAE,uBAE1B,IAAMK,EACqB,IAAzBzB,EAAcG,QAAgBqB,EAC1BA,EACA,KAEN,OAAOxB,EAAcO,KAAI,SAAA9C,GAAI,OAC3B,QAACiE,EAAD,CAEEC,MAAO7C,EAAaE,KACpBvB,KAAMA,EACNmE,SAAU,EAAKC,aACf9B,SAAUA,EACV0B,eAAgBA,GALXhE,EAAKuB,W,oBAUhB,WACE,OACE,QAAC,KAAD,YACE,QAAC,KAAD,CAAa8C,YAAU,EAAvB,WACGV,OAAE,QACFhE,KAAK2E,4BAGR,QAAC,IAAD,UAAY3E,KAAK4E,sB,GAnHAzD,aAAnBC,E,yBAiIN,IAAMkD,EAAU,SAAC,GAAD,IAAEC,EAAF,EAAEA,MAAOlE,EAAT,EAASA,KAAMmE,EAAf,EAAeA,SAAU7B,EAAzB,EAAyBA,SAAU0B,EAAnC,EAAmCA,eAAnC,OACd,QAACQ,EAAD,YACE,QAACC,EAAD,CAAYC,GAAE,oBAAeR,EAAf,kBAA8BlE,EAAKuB,KAAnC,KAAd,UACE,QAAC,EAAD,CAAWvB,KAAMA,OAEnB,QAAC,IAAD,CACE2E,QAASX,EACTY,QAASZ,EACTa,UAAW,kBAAMV,EAASnE,EAAKuB,OAC/Be,SAAUA,EAJZ,UAME,QAAC,KAAD,CACEwB,KAAK,SACLgB,MAAM,QAAC,KAAD,CAAcC,WAAS,EAACjB,KAAK,OACnCxB,SAAUA,EAHZ,UAKGqB,OAAE,kBAhBLM,E,sBAsBN,IAAMf,GAAoB,OAAO8B,EAAP,sBAAH,iCAER,SAAAC,GAAC,OAAIA,EAAEC,MAAMC,iBAFL,yBAMjBX,GAAgB,OAAOY,KAAP,sBAAH,YACNC,OAAM,GADA,wBAKbZ,GAAa,OAAOa,IAAP,sBAAH,wBAEED,OAAM,GAFR,KAKhB,GAAeE,OAAQxE","file":"chunks/app_views_asyncView_tsx-app_views_settings_components_teamSelect_tsx.xxxxxxxxxxxxxxxxxxxx.js","sourcesContent":["import * as React from 'react';\nimport DocumentTitle from 'react-document-title';\n\nimport AsyncComponent from 'app/components/asyncComponent';\n\ntype AsyncViewState = AsyncComponent['state'];\ntype AsyncViewProps = AsyncComponent['props'];\n\nexport default class AsyncView<\n  P extends AsyncViewProps = AsyncViewProps,\n  S extends AsyncViewState = AsyncViewState\n> extends AsyncComponent<P, S> {\n  getTitle() {\n    return '';\n  }\n\n  render() {\n    const title = this.getTitle();\n    return (\n      <DocumentTitle title={`${title ? `${title} - ` : ''}Sentry`}>\n        {this.renderComponent() as React.ReactChild}\n      </DocumentTitle>\n    );\n  }\n}\n","import * as React from 'react';\nimport isEqual from 'lodash/isEqual';\n\nimport TeamStore from 'app/stores/teamStore';\nimport {Team} from 'app/types';\n\nimport Badge from './badge';\n\ntype Props = React.ComponentProps<typeof Badge>;\n\ntype State = {\n  team: Team;\n};\n\nclass TeamBadgeContainer extends React.Component<Props, State> {\n  state: State = {team: this.props.team};\n\n  UNSAFE_componentWillReceiveProps(nextProps: Props) {\n    if (this.state.team === nextProps.team) {\n      return;\n    }\n\n    if (isEqual(this.state.team, nextProps.team)) {\n      return;\n    }\n\n    this.setState({team: nextProps.team});\n  }\n\n  componentWillUnmount() {\n    this.unlistener?.();\n  }\n\n  unlistener = TeamStore.listen(\n    (team: Set<string>) => this.onTeamStoreUpdate(team),\n    undefined\n  );\n\n  onTeamStoreUpdate(updatedTeam: Set<string>) {\n    if (!updatedTeam.has(this.state.team.id)) {\n      return;\n    }\n\n    const team = TeamStore.getById(this.state.team.id);\n    if (!team || isEqual(team.avatar, this.state.team.avatar)) {\n      return;\n    }\n\n    this.setState({team});\n  }\n\n  render() {\n    return <Badge {...this.props} team={this.state.team} />;\n  }\n}\n\nexport default TeamBadgeContainer;\n","import * as React from 'react';\nimport styled from '@emotion/styled';\nimport debounce from 'lodash/debounce';\n\nimport {Client} from 'app/api';\nimport Button from 'app/components/button';\nimport Confirm from 'app/components/confirm';\nimport DropdownAutoComplete from 'app/components/dropdownAutoComplete';\nimport {Item} from 'app/components/dropdownAutoComplete/types';\nimport DropdownButton from 'app/components/dropdownButton';\nimport TeamBadge from 'app/components/idBadge/teamBadge';\nimport Link from 'app/components/links/link';\nimport {Panel, PanelBody, PanelHeader, PanelItem} from 'app/components/panels';\nimport {DEFAULT_DEBOUNCE_DURATION, TEAMS_PER_PAGE} from 'app/constants';\nimport {IconSubtract} from 'app/icons';\nimport {t} from 'app/locale';\nimport space from 'app/styles/space';\nimport {Organization, Team} from 'app/types';\nimport withApi from 'app/utils/withApi';\nimport EmptyMessage from 'app/views/settings/components/emptyMessage';\n\ntype Props = {\n  api: Client;\n  organization: Organization;\n  /**\n   * Should button be disabled\n   */\n  disabled: boolean;\n  /**\n   * Teams that are already selected.\n   */\n  selectedTeams: Team[];\n  /**\n   * callback when teams are added\n   */\n  onAddTeam: (team: Team) => void;\n  /**\n   * Callback when teams are removed\n   */\n  onRemoveTeam: (teamSlug: string) => void;\n\n  /**\n   * Optional menu header.\n   */\n  menuHeader?: React.ReactElement;\n\n  /**\n   * Message to display when the last team is removed\n   * if empty no confirm will be displayed.\n   */\n  confirmLastTeamRemoveMessage?: string;\n};\n\ntype State = {\n  loading: boolean;\n  teamsSearch: null | Team[];\n};\n\nclass TeamSelect extends React.Component<Props, State> {\n  state: State = {\n    loading: true,\n    teamsSearch: null,\n  };\n\n  componentDidMount() {\n    this.fetchTeams();\n  }\n\n  fetchTeams = debounce(async (query?: string) => {\n    const {api, organization} = this.props;\n    const teamsSearch = await api.requestPromise(\n      `/organizations/${organization.slug}/teams/`,\n      {\n        query: {query, per_page: TEAMS_PER_PAGE},\n      }\n    );\n    this.setState({teamsSearch, loading: false});\n  }, DEFAULT_DEBOUNCE_DURATION);\n\n  handleQueryUpdate = (event: React.ChangeEvent<HTMLInputElement>) => {\n    this.setState({loading: true});\n    this.fetchTeams(event.target.value);\n  };\n\n  handleAddTeam = (option: Item) => {\n    const team = this.state.teamsSearch?.find(tm => tm.slug === option.value);\n    if (team) {\n      this.props.onAddTeam(team);\n    }\n  };\n\n  handleRemove = (teamSlug: string) => {\n    this.props.onRemoveTeam(teamSlug);\n  };\n\n  renderTeamAddDropDown() {\n    const {disabled, selectedTeams, menuHeader} = this.props;\n    const {teamsSearch} = this.state;\n    const isDisabled = disabled;\n\n    let options: Item[] = [];\n    if (teamsSearch === null || teamsSearch.length === 0) {\n      options = [];\n    } else {\n      options = teamsSearch\n        .filter(\n          team => !selectedTeams.some(selectedTeam => selectedTeam.slug === team.slug)\n        )\n        .map((team, index) => ({\n          index,\n          value: team.slug,\n          searchKey: team.slug,\n          label: <DropdownTeamBadge avatarSize={18} team={team} />,\n        }));\n    }\n\n    return (\n      <DropdownAutoComplete\n        items={options}\n        busyItemsStillVisible={this.state.loading}\n        onChange={this.handleQueryUpdate}\n        onSelect={this.handleAddTeam}\n        emptyMessage={t('No teams')}\n        menuHeader={menuHeader}\n        disabled={isDisabled}\n        alignMenu=\"right\"\n      >\n        {({isOpen}) => (\n          <DropdownButton\n            aria-label={t('Add Team')}\n            isOpen={isOpen}\n            size=\"xsmall\"\n            disabled={isDisabled}\n          >\n            {t('Add Team')}\n          </DropdownButton>\n        )}\n      </DropdownAutoComplete>\n    );\n  }\n\n  renderBody() {\n    const {organization, selectedTeams, disabled, confirmLastTeamRemoveMessage} =\n      this.props;\n\n    if (selectedTeams.length === 0) {\n      return <EmptyMessage>{t('No Teams assigned')}</EmptyMessage>;\n    }\n    const confirmMessage =\n      selectedTeams.length === 1 && confirmLastTeamRemoveMessage\n        ? confirmLastTeamRemoveMessage\n        : null;\n\n    return selectedTeams.map(team => (\n      <TeamRow\n        key={team.slug}\n        orgId={organization.slug}\n        team={team}\n        onRemove={this.handleRemove}\n        disabled={disabled}\n        confirmMessage={confirmMessage}\n      />\n    ));\n  }\n\n  render() {\n    return (\n      <Panel>\n        <PanelHeader hasButtons>\n          {t('Team')}\n          {this.renderTeamAddDropDown()}\n        </PanelHeader>\n\n        <PanelBody>{this.renderBody()}</PanelBody>\n      </Panel>\n    );\n  }\n}\n\ntype TeamRowProps = {\n  orgId: string;\n  team: Team;\n  onRemove: Props['onRemoveTeam'];\n  disabled: boolean;\n  confirmMessage: string | null;\n};\n\nconst TeamRow = ({orgId, team, onRemove, disabled, confirmMessage}: TeamRowProps) => (\n  <TeamPanelItem>\n    <StyledLink to={`/settings/${orgId}/teams/${team.slug}/`}>\n      <TeamBadge team={team} />\n    </StyledLink>\n    <Confirm\n      message={confirmMessage}\n      bypass={!confirmMessage}\n      onConfirm={() => onRemove(team.slug)}\n      disabled={disabled}\n    >\n      <Button\n        size=\"xsmall\"\n        icon={<IconSubtract isCircled size=\"xs\" />}\n        disabled={disabled}\n      >\n        {t('Remove')}\n      </Button>\n    </Confirm>\n  </TeamPanelItem>\n);\n\nconst DropdownTeamBadge = styled(TeamBadge)`\n  font-weight: normal;\n  font-size: ${p => p.theme.fontSizeMedium};\n  text-transform: none;\n`;\n\nconst TeamPanelItem = styled(PanelItem)`\n  padding: ${space(2)};\n  align-items: center;\n`;\n\nconst StyledLink = styled(Link)`\n  flex: 1;\n  margin-right: ${space(1)};\n`;\n\nexport default withApi(TeamSelect);\n"],"sourceRoot":""}